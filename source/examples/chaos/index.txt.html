<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >index</title
    ><link href="../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../index.txt.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><div id="chaos-2010"
    ><h1
      >Chaos 2010</h1
      ><p
      >Inspired by an old Spectrum game called <a href="http://en.wikipedia.org/wiki/Chaos_(video_game)"
	>Chaos</a
	>.</p
      ><p
      >The idea is to keep all the data in the database, and use constraints, transactions and stored procedures to keep things consistent and enforce the rules. Another goal is to have the source read like a rules reference as much as possible.</p
      ><p
      >The transformed versions are an attempt to show the sql as it goes into the database after being processed with the extension system. The transformation system works fine - the original sources here are transformed into normal sql, loaded into a database which then passes all the tests for the project.</p
      ><p
      >The transformations are effected by the function in this file: <a href="Database/HsSqlPpp/Chaos/ChaosExtensions.lhs.html"
	>ChaosExtensions</a
	> which in turn also uses most of the other extensions in this folder: <a href="website/source/examples/extensions/Database/HsSqlPpp/Extensions/"
	>Extensions</a
	></p
      ><p
      >The presentation here is slightly flakey in places. It attempts to take the final sql post transform, and merge in the original sql source statement by statement so you can see what's happening in the transform process, and it also shows some limited annotations from type checking.</p
      ><p
      >The files are listed in order.</p
      ><div id="some-boilerplate"
      ><h2
	>some boilerplate</h2
	><ul
	><li
	  ><a href="sql/chaos/server/Metadata.sql.html"
	    >Metadata</a
	    > - <a href="sql/chaos/server/Metadata.sql.tr.html"
	    >Transformed Metadata</a
	    ></li
	  ></ul
	></div
      ><div id="read-only-data"
      ><h2
	>read only data</h2
	><p
	>These define all the constant data which doesn't change either during a game or from one game to the next. These are the piece prototypes, and the spells.</p
	><ul
	><li
	  ><a href="sql/chaos/server/PiecePrototypes.sql.html"
	    >PiecePrototypes</a
	    > - <a href="sql/chaos/server/PiecePrototypes.sql.tr.html"
	    >Transformed PiecePrototypes</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/Spells.sql.html"
	    >Spells</a
	    > - <a href="sql/chaos/server/Spells.sql.tr.html"
	    >Transformed Spells</a
	    ></li
	  ></ul
	></div
      ><div id="game-data"
      ><h2
	>Game data</h2
	><p
	>This is the data which describes a individual game. The game data includes the turn sequence stuff also.</p
	><ul
	><li
	  ><a href="sql/chaos/server/GlobalData.sql.html"
	    >GlobalData</a
	    > - <a href="sql/chaos/server/GlobalData.sql.tr.html"
	    >Transformed GlobalData</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/Wizards.sql.html"
	    >Wizards</a
	    > - <a href="sql/chaos/server/Wizards.sql.tr.html"
	    >Transformed Wizards</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/Pieces.sql.html"
	    >Pieces</a
	    > - <a href="sql/chaos/server/Pieces.sql.tr.html"
	    >Transformed Pieces</a
	    ></li
	  ></ul
	></div
      ><div id="turn-sequence"
      ><h2
	>turn sequence</h2
	><p
	>This desribes what point in the game we're at. The turn sequence is slightly involved. Roughly. each wizard chooses a spell in turn, then each casts the spell in turn, then each wizard moves all his pieces in turn.</p
	><ul
	><li
	  ><a href="sql/chaos/server/TurnSequence.sql.html"
	    >TurnSequence</a
	    > - <a href="sql/chaos/server/TurnSequence.sql.tr.html"
	    >Transformed TurnSequence</a
	    ></li
	  ></ul
	></div
      ><div id="actions"
      ><h2
	>actions</h2
	><p
	>All the updates to the database use stored procedures (called actions in the code). Some are the turn sequence module, the rest are here.</p
	><p
	>Code to help with testing actions:</p
	><ul
	><li
	  ><a href="sql/chaos/server/actions/TestSupport.sql.html"
	    >TestSupport</a
	    > - <a href="sql/chaos/server/actions/TestSupport.sql.tr.html"
	    >Transformed TestSupport</a
	    ></li
	  ></ul
	><p
	>In addition to all the constraints, all the actions have precondition checks, which also double as guidance to the ui to what actions are possible to call at a given time.</p
	><ul
	><li
	  ><a href="sql/chaos/server/actions/SquaresValid.sql.html"
	    >SquaresValid</a
	    > - <a href="sql/chaos/server/actions/SquaresValid.sql.tr.html"
	    >Transformed SquaresValid</a
	    ></li
	  ></ul
	><p
	>Next phase:</p
	><ul
	><li
	  ><a href="sql/chaos/server/actions/NextPhase.sql.html"
	    >NextPhase</a
	    > - <a href="sql/chaos/server/actions/NextPhase.sql.tr.html"
	    >Transformed NextPhase</a
	    ></li
	  ></ul
	><p
	>Actions for each phase:</p
	><ul
	><li
	  ><a href="sql/chaos/server/actions/SpellChoice.sql.html"
	    >SpellChoice</a
	    > - <a href="sql/chaos/server/actions/SpellChoice.sql.tr.html"
	    >Transformed SpellChoice</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/SpellCast.sql.html"
	    >SpellCast</a
	    > - <a href="sql/chaos/server/actions/SpellCast.sql.tr.html"
	    >Transformed SpellCast</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/MovePhase.sql.html"
	    >MovePhase</a
	    > - <a href="sql/chaos/server/actions/MovePhase.sql.tr.html"
	    >Transformed MovePhase</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/Autonomous.sql.html"
	    >Autonomous</a
	    > - <a href="sql/chaos/server/actions/Autonomous.sql.tr.html"
	    >Transformed Autonomous</a
	    ></li
	  ></ul
	><p
	>Some helpers for adding, changing and removing pieces:</p
	><ul
	><li
	  ><a href="sql/chaos/server/actions/PieceChanges.sql.html"
	    >PieceChanges</a
	    > - <a href="sql/chaos/server/actions/PieceChanges.sql.tr.html"
	    >Transformed PieceChanges</a
	    ></li
	  ></ul
	><p
	>A (partial) log of what actions have been run. Bit of a poor man's temporal data.</p
	><ul
	><li
	  ><a href="sql/chaos/server/actions/History.sql.html"
	    >History</a
	    > - <a href="sql/chaos/server/actions/History.sql.tr.html"
	    >Transformed History</a
	    ></li
	  ></ul
	></div
      ><div id="new-game"
      ><h2
	>new game</h2
	><p
	>The code to setup/reset the database for a new game:</p
	><ul
	><li
	  ><a href="sql/chaos/server/NewGame.sql.html"
	    >NewGame</a
	    > - <a href="sql/chaos/server/NewGame.sql.tr.html"
	    >Transformed NewGame</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/TestBoards.sql.html"
	    >TestBoards</a
	    > - <a href="sql/chaos/server/TestBoards.sql.tr.html"
	    >Transformed TestBoards</a
	    ></li
	  ></ul
	></div
      ><div id="ai"
      ><h2
	>ai</h2
	><p
	>The code to implement the ai for the computer controlled wizards (in sql? Call the men in white coats).</p
	><ul
	><li
	  ><a href="sql/chaos/server/AI.sql.html"
	    >AI</a
	    > - <a href="sql/chaos/server/AI.sql.tr.html"
	    >Transformed AI</a
	    ></li
	  ></ul
	></div
      ><div id="client-support"
      ><h2
	>client support</h2
	><p
	>the rough original plan was to store the ui state in the database as well, but I don't think this is working too well. Maybe a system where the relevant tables and functions are autogenerated from the ui descriptions in Haskell? Anyway - this is the old cruft pre removal. There is quite a lot of important ui logic in here still.</p
	><p
	>lists the sprites, this is the stuff that works quite well since we use foreign keys to tighten things up:</p
	><ul
	><li
	  ><a href="sql/chaos/client/Sprites.sql.html"
	    >Sprites</a
	    > - <a href="sql/chaos/client/Sprites.sql.tr.html"
	    >Transformed Sprites</a
	    ></li
	  ></ul
	><p
	>additional ui only information for each wizard, e.g. sprite, colour</p
	><ul
	><li
	  ><a href="sql/chaos/client/WizardDisplayInfo.sql.html"
	    >WizardDisplayInfo</a
	    > - <a href="sql/chaos/client/WizardDisplayInfo.sql.tr.html"
	    >Transformed WizardDisplayInfo</a
	    ></li
	  ></ul
	><p
	>A load of really half baked views and table to support a dodgy effects system, this is the most bizarre bit and will definitely mostly be going soon:</p
	><ul
	><li
	  ><a href="sql/chaos/client/BoardWidget.sql.html"
	    >BoardWidget</a
	    > - <a href="sql/chaos/client/BoardWidget.sql.tr.html"
	    >Transformed BoardWidget</a
	    ></li
	  ></ul
	><p
	>Actually, this is pretty half baked too, an attempt to pack a load of information about the spells available to a wizard on screen:</p
	><ul
	><li
	  ><a href="sql/chaos/client/SpellBookWidget.sql.html"
	    >SpellBookWidget</a
	    > - <a href="sql/chaos/client/SpellBookWidget.sql.tr.html"
	    >Transformed SpellBookWidget</a
	    ></li
	  ></ul
	><p
	>Save the state of the new game widget in the database, this is prime candidate material for auto generated database structure:</p
	><ul
	><li
	  ><a href="sql/chaos/client/NewGameWidget.sql.html"
	    >NewGameWidget</a
	    > - <a href="sql/chaos/client/NewGameWidget.sql.tr.html"
	    >Transformed NewGameWidget</a
	    ></li
	  ></ul
	><p
	>supplement the server actions with a few ui specific bits and pieces. In particular, all the mapping from keys to actions is handled in this code. Probably this is all or mostly going to move to Haskell</p
	><ul
	><li
	  ><a href="sql/chaos/client/ClientActions.sql.html"
	    >ClientActions</a
	    > - <a href="sql/chaos/client/ClientActions.sql.tr.html"
	    >Transformed ClientActions</a
	    ></li
	  ></ul
	><p
	>wrapper around the new game action in the server code which also sets up the client supporting data, e.g. the wizard display info:</p
	><ul
	><li
	  ><a href="sql/chaos/client/ClientNewGame.sql.html"
	    >ClientNewGame</a
	    > - <a href="sql/chaos/client/ClientNewGame.sql.tr.html"
	    >Transformed ClientNewGame</a
	    ></li
	  ></ul
	><p
	>= usage</p
	><p
	>To load the sql straight into postgresql, create a database called chaos. You might need to add plpgsql manually.</p
	><p
	>Then, to load the sql in, use something like:</p
	><div class='sh'><pre class="sourceCode">time ghc -XDeriveDataTypeable -DPOSTGRES -cpp -pgmPcpphs -optP--cpp -idevel<span class="Symbol">:</span>src<span class="Symbol">:</span>examples<span class="Symbol">/</span>chaos<span class="Symbol">:</span>examples<span class="Symbol">/</span>extensions<span class="Symbol">/:</span>examples<span class="Symbol">/</span>util<span class="Symbol">/:</span>tests<span class="Symbol">/</span> --make examples<span class="Symbol">/</span>chaos<span class="Symbol">/</span>Chaos2010<span class="Symbol">.</span>lhs <span class="Symbol">&amp;&amp;</span> time examples<span class="Symbol">/</span>chaos<span class="Symbol">/</span>Chaos2010 reset</pre></div><p
	>Using -Odph on my machine changes the runtime for the reset from ~7.5 seconds to ~5 seconds.</p
	><p
	>To output the transformed sql to a file and load using psql, sometimes easier to work out sql errors:</p
	><div class='sh'><pre class="sourceCode">time ghc -XDeriveDataTypeable -DPOSTGRES -cpp -pgmPcpphs -optP--cpp -idevel<span class="Symbol">:</span>src<span class="Symbol">:</span>examples<span class="Symbol">/</span>chaos<span class="Symbol">:</span>examples<span class="Symbol">/</span>extensions<span class="Symbol">/:</span>examples<span class="Symbol">/</span>util<span class="Symbol">/:</span>tests<span class="Symbol">/</span> --make examples<span class="Symbol">/</span>chaos<span class="Symbol">/</span>Chaos2010<span class="Symbol">.</span>lhs <span class="Symbol">&amp;&amp;</span> time examples<span class="Symbol">/</span>chaos<span class="Symbol">/</span>Chaos2010 reset <span class="Symbol">&amp;&amp;</span> time examples<span class="Symbol">/</span>chaos<span class="Symbol">/</span>Chaos2010 sql <span class="Symbol">&gt;</span> chaos1<span class="Symbol">.</span>sql <span class="Symbol">&amp;&amp;</span> time examples<span class="Symbol">/</span>chaos<span class="Symbol">/</span>Chaos2010 clear <span class="Symbol">&amp;&amp;</span> time psql chaos -q --<span class="Keyword">set</span> <span class="Variable">ON_ERROR_STOP</span><span class="Symbol">=</span>on --<span class="Variable">file</span><span class="Symbol">=</span>chaos1<span class="Symbol">.</span>sql</pre></div><ul
	><li
	  ><a href="Chaos2010.lhs.html"
	    >Chaos2010.lhs</a
	    ></li
	  ><li
	  ><a href="Database/HsSqlPpp/Chaos/ChaosExtensions.lhs.html"
	    >Database/HsSqlPpp/Chaos/ChaosExtensions.lhs</a
	    ></li
	  ><li
	  ><a href="Database/HsSqlPpp/Chaos/ChaosFiles.lhs.html"
	    >Database/HsSqlPpp/Chaos/ChaosFiles.lhs</a
	    ></li
	  ><li
	  ><a href="sql/chaos/client/BoardWidget.sql.html"
	    >sql/chaos/client/BoardWidget.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/client/ClientActions.sql.html"
	    >sql/chaos/client/ClientActions.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/client/ClientNewGame.sql.html"
	    >sql/chaos/client/ClientNewGame.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/client/NewGameWidget.sql.html"
	    >sql/chaos/client/NewGameWidget.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/client/SpellBookWidget.sql.html"
	    >sql/chaos/client/SpellBookWidget.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/client/Sprites.sql.html"
	    >sql/chaos/client/Sprites.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/client/WizardDisplayInfo.sql.html"
	    >sql/chaos/client/WizardDisplayInfo.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/AI.sql.html"
	    >sql/chaos/server/AI.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/GlobalData.sql.html"
	    >sql/chaos/server/GlobalData.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/Metadata.sql.html"
	    >sql/chaos/server/Metadata.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/NewGame.sql.html"
	    >sql/chaos/server/NewGame.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/PiecePrototypes.sql.html"
	    >sql/chaos/server/PiecePrototypes.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/Pieces.sql.html"
	    >sql/chaos/server/Pieces.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/Spells.sql.html"
	    >sql/chaos/server/Spells.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/TestBoards.sql.html"
	    >sql/chaos/server/TestBoards.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/TurnSequence.sql.html"
	    >sql/chaos/server/TurnSequence.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/Wizards.sql.html"
	    >sql/chaos/server/Wizards.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/Autonomous.sql.html"
	    >sql/chaos/server/actions/Autonomous.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/History.sql.html"
	    >sql/chaos/server/actions/History.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/MovePhase.sql.html"
	    >sql/chaos/server/actions/MovePhase.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/NextPhase.sql.html"
	    >sql/chaos/server/actions/NextPhase.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/PieceChanges.sql.html"
	    >sql/chaos/server/actions/PieceChanges.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/SpellCast.sql.html"
	    >sql/chaos/server/actions/SpellCast.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/SpellChoice.sql.html"
	    >sql/chaos/server/actions/SpellChoice.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/SquaresValid.sql.html"
	    >sql/chaos/server/actions/SquaresValid.sql</a
	    ></li
	  ><li
	  ><a href="sql/chaos/server/actions/TestSupport.sql.html"
	    >sql/chaos/server/actions/TestSupport.sql</a
	    ></li
	  ></ul
	></div
      ></div
    ><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/29/11 20:06:46, hssqlppp-0.3.0</div
    ></body
  ></html
>
