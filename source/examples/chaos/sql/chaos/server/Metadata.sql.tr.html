<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >Metadata.sql transformed</title
    ><link href="../../../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../../../index.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><div class='SqlPostgresql'><div class='UnusedSql'><pre class="sourceCode"><span class="Comment">-- replaced sql ------------------------</span>
<span class="Comment">/*</span>

<span class="Comment">Metadata</span>
<span class="Comment">========</span>

<span class="Comment">base relvar tags</span>
<span class="Comment">---------------</span>

<span class="Comment">This stuff was mainly used to produce some half-baked documentation/</span>
<span class="Comment">diagrams of the database. Needs overhauling, but is waiting for the</span>
<span class="Comment">module system to develop a bit.</span>

<span class="Comment">*/</span>
<span class="Keyword">select</span> <span class="VarId">module</span><span class="Symbol">(</span><span class="Char">'Chaos.Server.Metadata'</span><span class="Symbol">);</span></pre></div></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*[CatCreateTable &quot;modules&quot; [(&quot;module_name&quot;,ScalarType &quot;text&quot;),(&quot;module_order&quot;,ScalarType &quot;int4&quot;)] [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;),(&quot;cmax&quot;,ScalarType &quot;cid&quot;),(&quot;xmax&quot;,ScalarType &quot;xid&quot;),(&quot;cmin&quot;,ScalarType &quot;cid&quot;),(&quot;xmin&quot;,ScalarType &quot;xid&quot;),(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">modules</span> <span class="Symbol">(</span>
  <span class="VarId">module_name</span> <span class="Type">text</span><span class="Symbol">,</span>
  <span class="VarId">module_order</span> <span class="VarId">serial</span>
<span class="Symbol">);</span>

<span class="Comment">/*[CatCreateTable &quot;all_module_objects&quot; [(&quot;object_name&quot;,ScalarType &quot;text&quot;),(&quot;object_type&quot;,ScalarType &quot;text&quot;),(&quot;module_name&quot;,ScalarType &quot;text&quot;)] [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;),(&quot;cmax&quot;,ScalarType &quot;cid&quot;),(&quot;xmax&quot;,ScalarType &quot;xid&quot;),(&quot;cmin&quot;,ScalarType &quot;cid&quot;),(&quot;xmin&quot;,ScalarType &quot;xid&quot;),(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span>
  <span class="VarId">object_name</span> <span class="Type">text</span><span class="Symbol">,</span>
  <span class="VarId">object_type</span> <span class="Type">text</span><span class="Symbol">,</span>
  <span class="VarId">module_name</span> <span class="VarId">text</span>
<span class="Symbol">);</span>

<span class="Comment">/*[CatCreateTable &quot;system_implementation_objects&quot; [(&quot;object_name&quot;,ScalarType &quot;text&quot;),(&quot;object_type&quot;,ScalarType &quot;text&quot;)] [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;),(&quot;cmax&quot;,ScalarType &quot;cid&quot;),(&quot;xmax&quot;,ScalarType &quot;xid&quot;),(&quot;cmin&quot;,ScalarType &quot;cid&quot;),(&quot;xmin&quot;,ScalarType &quot;xid&quot;),(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">system_implementation_objects</span> <span class="Symbol">(</span>
  <span class="VarId">object_name</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">object_type</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">check</span> <span class="Symbol">(</span><span class="VarId">object_type</span> <span class="VarId">in</span> <span class="Symbol">(</span><span class="Char">'scalar'</span><span class="Symbol">,</span><span class="Char">'base_relvar'</span><span class="Symbol">,</span><span class="Char">'operator'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'trigger'</span><span class="Symbol">,</span><span class="Char">'database_constraint'</span><span class="Symbol">))</span>
<span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'system_implementation_objects'</span><span class="Symbol">,</span><span class="Char">'table'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">system_implementation_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'system_implementation_objects'</span><span class="Symbol">,</span><span class="Char">'base_relvar'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;base_relvars&quot; [(&quot;relvar_name&quot;,ScalarType &quot;name&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">base_relvars</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">relname</span> <span class="Keyword">as</span> <span class="VarId">relvar_name</span>
    <span class="Keyword">from</span> <span class="VarId">pg_class</span>
    <span class="Keyword">where</span> <span class="Symbol">((</span><span class="VarId">relnamespace</span> <span class="Symbol">=</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">oid</span>
                              <span class="Keyword">from</span> <span class="VarId">pg_namespace</span>
                              <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">nspname</span> <span class="Symbol">=</span> <span class="Char">'public'</span><span class="Symbol">)))</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">relkind</span> <span class="Symbol">=</span> <span class="Char">'r'</span><span class="Symbol">));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'base_relvars'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;base_relvar_attributes&quot; [(&quot;attribute_name&quot;,ScalarType &quot;name&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">base_relvar_attributes</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">attname</span> <span class="Keyword">as</span> <span class="VarId">attribute_name</span><span class="Symbol">,</span><span class="VarId">typname</span> <span class="Keyword">as</span> <span class="VarId">type_name</span><span class="Symbol">,</span><span class="VarId">relname</span> <span class="Keyword">as</span> <span class="VarId">relvar_name</span>
    <span class="Keyword">from</span> <span class="Symbol">(((</span><span class="VarId">pg_attribute</span>
            <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">pg_class</span> <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">attrelid</span> <span class="Symbol">=</span> <span class="VarId">pg_class</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">))</span>
           <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">pg_type</span> <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">atttypid</span> <span class="Symbol">=</span> <span class="VarId">pg_type</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">))</span>
          <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">base_relvars</span> <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">relname</span> <span class="Symbol">=</span> <span class="VarId">base_relvars</span><span class="Symbol">.</span><span class="VarId">relvar_name</span><span class="Symbol">))</span>
    <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">attnum</span> <span class="Symbol">&gt;=</span> <span class="Number">1</span><span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'base_relvar_attributes'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;scalars&quot; []]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">scalars</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="Keyword">distinct</span> <span class="VarId">type_name</span> <span class="Keyword">as</span> <span class="VarId">scalar_name</span>
    <span class="Keyword">from</span> <span class="VarId">base_relvar_attributes</span><span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'scalars'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;base_relvar_keys&quot; [(&quot;constraint_name&quot;,ScalarType &quot;name&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">base_relvar_keys</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">conname</span> <span class="Keyword">as</span> <span class="VarId">constraint_name</span><span class="Symbol">,</span><span class="VarId">relvar_name</span>
    <span class="Keyword">from</span> <span class="Symbol">(</span><span class="VarId">pg_constraint</span>
          <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">oid</span> <span class="Keyword">as</span> <span class="VarId">conrelid</span><span class="Symbol">,</span><span class="VarId">relname</span> <span class="Keyword">as</span> <span class="VarId">relvar_name</span>
                                <span class="Keyword">from</span> <span class="VarId">pg_class</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">b</span><span class="Symbol">)</span>
    <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">contype</span> <span class="VarId">in</span> <span class="Symbol">(</span><span class="Char">'p'</span><span class="Symbol">,</span><span class="Char">'u'</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">connamespace</span> <span class="Symbol">=</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">oid</span>
                                                       <span class="Keyword">from</span> <span class="VarId">pg_namespace</span>
                                                       <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">nspname</span> <span class="Symbol">=</span> <span class="Char">'public'</span><span class="Symbol">))));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'base_relvar_keys'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;base_relvar_key_attributes&quot; [(&quot;constraint_name&quot;,ScalarType &quot;name&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">base_relvar_key_attributes</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">constraint_name</span><span class="Symbol">,</span><span class="VarId">attribute_name</span>
    <span class="Keyword">from</span> <span class="Symbol">(((</span><span class="Keyword">select</span> <span class="VarId">conname</span> <span class="Keyword">as</span> <span class="VarId">constraint_name</span><span class="Symbol">,</span><span class="VarId">conrelid</span><span class="Symbol">,</span><span class="VarId">unnest</span><span class="Symbol">(</span><span class="VarId">conkey</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">attnum</span>
              <span class="Keyword">from</span> <span class="VarId">pg_constraint</span>
              <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">contype</span> <span class="VarId">in</span> <span class="Symbol">(</span><span class="Char">'p'</span><span class="Symbol">,</span><span class="Char">'u'</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">connamespace</span> <span class="Symbol">=</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">oid</span>
                                                                 <span class="Keyword">from</span> <span class="VarId">pg_namespace</span>
                                                                 <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">nspname</span> <span class="Symbol">=</span> <span class="Char">'public'</span><span class="Symbol">)))))</span> <span class="Keyword">as</span> <span class="VarId">a</span>
           <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">oid</span> <span class="Keyword">as</span> <span class="VarId">conrelid</span><span class="Symbol">,</span><span class="VarId">relname</span> <span class="Keyword">as</span> <span class="VarId">relvar_name</span>
                                 <span class="Keyword">from</span> <span class="VarId">pg_class</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">b</span><span class="Symbol">)</span>
          <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">attrelid</span> <span class="Keyword">as</span> <span class="VarId">conrelid</span><span class="Symbol">,</span><span class="VarId">attname</span> <span class="Keyword">as</span> <span class="VarId">attribute_name</span><span class="Symbol">,</span><span class="VarId">attnum</span>
                                <span class="Keyword">from</span> <span class="VarId">pg_attribute</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">c</span><span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'base_relvar_key_attributes'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;operators&quot; [(&quot;operator_name&quot;,ScalarType &quot;name&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">operators</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">proname</span> <span class="Keyword">as</span> <span class="VarId">operator_name</span>
    <span class="Keyword">from</span> <span class="VarId">pg_proc</span>
    <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">pronamespace</span> <span class="Symbol">=</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">oid</span>
                             <span class="Keyword">from</span> <span class="VarId">pg_namespace</span>
                             <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">nspname</span> <span class="Symbol">=</span> <span class="Char">'public'</span><span class="Symbol">)));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'operators'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;operator_source&quot; [(&quot;operator_name&quot;,ScalarType &quot;name&quot;),(&quot;source&quot;,ScalarType &quot;text&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">operator_source</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">proname</span> <span class="Keyword">as</span> <span class="VarId">operator_name</span><span class="Symbol">,</span><span class="VarId">prosrc</span> <span class="Keyword">as</span> <span class="VarId">source</span>
    <span class="Keyword">from</span> <span class="VarId">pg_proc</span>
    <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">pronamespace</span> <span class="Symbol">=</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">oid</span>
                             <span class="Keyword">from</span> <span class="VarId">pg_namespace</span>
                             <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">nspname</span> <span class="Symbol">=</span> <span class="Char">'public'</span><span class="Symbol">)));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'operator_source'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;triggers&quot; [(&quot;trigger_name&quot;,ScalarType &quot;name&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">triggers</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">relname</span> <span class="Keyword">as</span> <span class="VarId">relvar_name</span><span class="Symbol">,</span><span class="VarId">tgname</span> <span class="Keyword">as</span> <span class="VarId">trigger_name</span><span class="Symbol">,</span><span class="VarId">proname</span> <span class="Keyword">as</span> <span class="VarId">operator_name</span>
    <span class="Keyword">from</span> <span class="Symbol">(((</span><span class="VarId">pg_trigger</span>
            <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">pg_class</span> <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">tgrelid</span> <span class="Symbol">=</span> <span class="VarId">pg_class</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">))</span>
           <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">pg_proc</span> <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">tgfoid</span> <span class="Symbol">=</span> <span class="VarId">pg_proc</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">))</span>
          <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">base_relvars</span> <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">relname</span> <span class="Symbol">=</span> <span class="VarId">base_relvars</span><span class="Symbol">.</span><span class="VarId">relvar_name</span><span class="Symbol">))</span>
    <span class="Keyword">where</span> <span class="Symbol">(</span><span class="Keyword">not</span> <span class="Symbol">(</span><span class="VarId">tgisconstraint</span><span class="Symbol">));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'triggers'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;views&quot; [(&quot;view_name&quot;,ScalarType &quot;name&quot;),(&quot;definition&quot;,ScalarType &quot;text&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">views</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">viewname</span> <span class="Keyword">as</span> <span class="VarId">view_name</span><span class="Symbol">,</span><span class="VarId">definition</span>
    <span class="Keyword">from</span> <span class="VarId">pg_views</span>
    <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">schemaname</span> <span class="Symbol">=</span> <span class="Char">'public'</span><span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'views'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;view_attributes&quot; [(&quot;attribute_name&quot;,ScalarType &quot;name&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">view_attributes</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">attname</span> <span class="Keyword">as</span> <span class="VarId">attribute_name</span><span class="Symbol">,</span><span class="VarId">typname</span> <span class="Keyword">as</span> <span class="VarId">type_name</span><span class="Symbol">,</span><span class="VarId">relname</span> <span class="Keyword">as</span> <span class="VarId">relvar_name</span>
    <span class="Keyword">from</span> <span class="Symbol">(((</span><span class="VarId">pg_attribute</span>
            <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">pg_class</span> <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">attrelid</span> <span class="Symbol">=</span> <span class="VarId">pg_class</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">))</span>
           <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">pg_type</span> <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">atttypid</span> <span class="Symbol">=</span> <span class="VarId">pg_type</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">))</span>
          <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">views</span> <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">relname</span> <span class="Symbol">=</span> <span class="VarId">view_name</span><span class="Symbol">))</span>
    <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">attnum</span> <span class="Symbol">&gt;=</span> <span class="Number">1</span><span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'view_attributes'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateTable &quot;database_constraints&quot; [(&quot;constraint_name&quot;,ScalarType &quot;text&quot;),(&quot;expression&quot;,ScalarType &quot;text&quot;)] [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;),(&quot;cmax&quot;,ScalarType &quot;cid&quot;),(&quot;xmax&quot;,ScalarType &quot;xid&quot;),(&quot;cmin&quot;,ScalarType &quot;cid&quot;),(&quot;xmin&quot;,ScalarType &quot;xid&quot;),(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">database_constraints</span> <span class="Symbol">(</span>
  <span class="VarId">constraint_name</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">expression</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'database_constraints'</span><span class="Symbol">,</span><span class="Char">'table'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">all_database_objects</span> <span class="VarId">as</span>
  <span class="Symbol">((((</span><span class="Keyword">select</span> <span class="Char">'scalar'</span> <span class="Keyword">as</span> <span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">scalar_name</span> <span class="Keyword">as</span> <span class="VarId">object_name</span>
        <span class="Keyword">from</span> <span class="VarId">scalars</span>
      <span class="VarId">union</span>
      <span class="Keyword">select</span> <span class="Char">'base_relvar'</span> <span class="Keyword">as</span> <span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">relvar_name</span> <span class="Keyword">as</span> <span class="VarId">object_name</span>
        <span class="Keyword">from</span> <span class="VarId">base_relvars</span><span class="Symbol">)</span>
     <span class="VarId">union</span>
     <span class="Keyword">select</span> <span class="Char">'operator'</span> <span class="Keyword">as</span> <span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">operator_name</span> <span class="Keyword">as</span> <span class="VarId">object_name</span>
       <span class="Keyword">from</span> <span class="VarId">operators</span><span class="Symbol">)</span>
    <span class="VarId">union</span>
    <span class="Keyword">select</span> <span class="Char">'view'</span> <span class="Keyword">as</span> <span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">view_name</span> <span class="Keyword">as</span> <span class="VarId">object_name</span>
      <span class="Keyword">from</span> <span class="VarId">views</span><span class="Symbol">)</span>
   <span class="VarId">union</span>
   <span class="Keyword">select</span> <span class="Char">'trigger'</span> <span class="Keyword">as</span> <span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">trigger_name</span> <span class="Keyword">as</span> <span class="VarId">object_name</span>
     <span class="Keyword">from</span> <span class="VarId">triggers</span><span class="Symbol">)</span>
  <span class="VarId">union</span>
  <span class="Keyword">select</span> <span class="Char">'database_constraint'</span> <span class="Keyword">as</span> <span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">constraint_name</span> <span class="Keyword">as</span> <span class="VarId">object_name</span>
    <span class="Keyword">from</span> <span class="VarId">database_constraints</span><span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'all_database_objects'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">system_implementation_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'all_database_objects'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">public_database_objects</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span>
    <span class="Keyword">from</span> <span class="VarId">all_database_objects</span>
  <span class="VarId">except</span>
  <span class="Keyword">select</span> <span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span>
    <span class="Keyword">from</span> <span class="VarId">system_implementation_objects</span><span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'public_database_objects'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;object_orders&quot; [(&quot;object_type&quot;,ScalarType &quot;text&quot;),(&quot;object_order&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">object_orders</span> <span class="VarId">as</span>
  <span class="Symbol">((((</span><span class="Keyword">select</span> <span class="VarId">cast</span><span class="Symbol">(</span><span class="Char">'scalar'</span> <span class="Keyword">as</span> <span class="Type">text</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">object_type</span><span class="Symbol">,</span><span class="Number">0</span> <span class="Keyword">as</span> <span class="VarId">object_order</span>
      <span class="VarId">union</span>
      <span class="Keyword">select</span> <span class="Char">'database_constraint'</span><span class="Symbol">,</span><span class="Number">1</span><span class="Symbol">)</span>
     <span class="VarId">union</span>
     <span class="Keyword">select</span> <span class="Char">'base_relvar'</span><span class="Symbol">,</span><span class="Number">2</span><span class="Symbol">)</span>
    <span class="VarId">union</span>
    <span class="Keyword">select</span> <span class="Char">'operator'</span><span class="Symbol">,</span><span class="Number">3</span><span class="Symbol">)</span>
   <span class="VarId">union</span>
   <span class="Keyword">select</span> <span class="Char">'view'</span><span class="Symbol">,</span><span class="Number">4</span><span class="Symbol">)</span>
  <span class="VarId">union</span>
  <span class="Keyword">select</span> <span class="Char">'trigger'</span><span class="Symbol">,</span><span class="Number">5</span><span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'object_orders'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'no_module'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">modules</span> <span class="Symbol">(</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'Chaos.Server.Metadata'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">create</span> <span class="Keyword">language</span> <span class="VarId">plpgsql</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='UnusedSql'><pre class="sourceCode"><span class="Comment">-- replaced sql ------------------------</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">base_relvar_metadata</span> <span class="Symbol">(</span>
  <span class="VarId">relvar_name</span> <span class="Type">text</span> <span class="Keyword">unique</span><span class="Symbol">,</span> <span class="Comment">-- references base_relvars, fk to view</span>
  <span class="Keyword">type</span> <span class="Type">text</span> <span class="Keyword">check</span> <span class="Symbol">(</span><span class="Keyword">type</span> <span class="VarId">in</span><span class="Symbol">(</span><span class="Char">'readonly'</span><span class="Symbol">,</span> <span class="Char">'data'</span><span class="Symbol">,</span><span class="Char">'hack'</span><span class="Symbol">))</span>
<span class="Symbol">);</span></pre></div></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*[CatCreateTable &quot;base_relvar_metadata&quot; [(&quot;relvar_name&quot;,ScalarType &quot;text&quot;),(&quot;type&quot;,ScalarType &quot;text&quot;)] [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;),(&quot;cmax&quot;,ScalarType &quot;cid&quot;),(&quot;xmax&quot;,ScalarType &quot;xid&quot;),(&quot;cmin&quot;,ScalarType &quot;cid&quot;),(&quot;xmin&quot;,ScalarType &quot;xid&quot;),(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">base_relvar_metadata</span> <span class="Symbol">(</span>
  <span class="VarId">relvar_name</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">unique</span><span class="Symbol">,</span>
  <span class="Keyword">type</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">check</span> <span class="Symbol">(</span><span class="Keyword">type</span> <span class="VarId">in</span> <span class="Symbol">(</span><span class="Char">'readonly'</span><span class="Symbol">,</span><span class="Char">'data'</span><span class="Symbol">,</span><span class="Char">'hack'</span><span class="Symbol">))</span>
<span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'base_relvar_metadata'</span><span class="Symbol">,</span><span class="Char">'table'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Metadata'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;set_relvar_type&quot; [ScalarType &quot;text&quot;,ScalarType &quot;text&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">set_relvar_type</span><span class="Symbol">(</span><span class="VarId">vname</span> <span class="Type">text</span><span class="Symbol">,</span> <span class="VarId">vtype</span> <span class="Type">text</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">base_relvar_metadata</span> <span class="Symbol">(</span><span class="VarId">relvar_name</span><span class="Symbol">,</span> <span class="Keyword">type</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="VarId">vname</span><span class="Symbol">,</span> <span class="VarId">vtype</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'set_relvar_type'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Metadata'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">select</span> <span class="VarId">set_relvar_type</span><span class="Symbol">(</span><span class="Char">'base_relvar_metadata'</span><span class="Symbol">,</span> <span class="Char">'readonly'</span><span class="Symbol">);</span>

<span class="Comment">/*</span>

<span class="Comment">checking</span>
<span class="Comment">--------</span>

<span class="Comment">This view is only used in the check_code_some_tags function.</span>
<span class="Comment">*/</span>
<span class="Comment">/*</span>
<span class="Comment">disabled</span>

<span class="Comment">used to be used to make sure nothing got missed, which was much harder</span>
<span class="Comment">using pure plpgsql hackery than using the ast queries and transforms.</span>

<span class="Comment">create view chaos_base_relvars as</span>
<span class="Comment">  select object_name,object_type from all_database_objects</span>
<span class="Comment">  where object_type = 'base_relvar'</span>
<span class="Comment">  except</span>
<span class="Comment">        select object_name,object_type from all_module_objects</span>
<span class="Comment">        where module_name = 'catalog' and object_type='base_relvar';</span>
<span class="Comment">*/</span>
<span class="Comment">/*</span>
<span class="Comment">part of the tests, will check all the relvars which aren't defined in</span>
<span class="Comment">system.sql are tagged.</span>
<span class="Comment">*/</span>
<span class="Comment">/*</span>
<span class="Comment">create function check_code_some_tags() returns boolean as $$</span>
<span class="Comment">declare</span>
<span class="Comment">  r record;</span>
<span class="Comment">  success boolean;</span>
<span class="Comment">begin</span>
<span class="Comment">  success := true;</span>
<span class="Comment">  for r in select object_name from chaos_base_relvars</span>
<span class="Comment">    except select relvar_name from base_relvar_metadata loop</span>
<span class="Comment">    success := false;</span>
<span class="Comment">      raise notice</span>
<span class="Comment">        'table % is not tagged with one of readonly, data, hack',</span>
<span class="Comment">        r.object_name;</span>
<span class="Comment">  end loop;</span>
<span class="Comment">  return success;</span>
<span class="Comment">end;</span>
<span class="Comment">$$ language plpgsql volatile;</span>
<span class="Comment">*/</span>
<span class="Comment">/*</span>

<span class="Comment">After we've loaded the sql, we can protect all the readonly relvars</span>
<span class="Comment">from being updated again using transition constraints (see below for</span>
<span class="Comment">how they are implemented). This might catch some programming errors.</span>

<span class="Comment"> */</span>
<span class="Comment">/*</span>

<span class="Comment">This is going to be replaced with an extension</span>

<span class="Comment">create function protect_readonly_relvars() returns void as $$</span>
<span class="Comment">declare</span>
<span class="Comment">  r record;</span>
<span class="Comment">begin</span>
<span class="Comment">  for r in select relvar_name, type</span>
<span class="Comment">           from base_relvar_metadata</span>
<span class="Comment">           where type='readonly' loop</span>
<span class="Comment">    perform create_update_transition_tuple_constraint(</span>
<span class="Comment">      r.relvar_name, r.relvar_name || '_u_readonly', 'false');</span>
<span class="Comment">    perform create_delete_transition_tuple_constraint(</span>
<span class="Comment">      r.relvar_name, r.relvar_name || '_d_readonly', 'false');</span>
<span class="Comment">    perform create_insert_transition_tuple_constraint(</span>
<span class="Comment">      r.relvar_name, r.relvar_name || '_i_readonly', 'false');</span>
<span class="Comment">    -- get module</span>
<span class="Comment">    perform set_module_for_preceding_objects(</span>
<span class="Comment">    (select module_name from module_objects</span>
<span class="Comment">          where object_type = 'base_relvar'</span>
<span class="Comment">            and object_name = r.relvar_name));</span>
<span class="Comment">  end loop;</span>
<span class="Comment">end;</span>
<span class="Comment">$$ language plpgsql volatile;</span>
<span class="Comment">*/</span>

<span class="Comment">/*</span>

<span class="Comment">callback notes</span>
<span class="Comment">--------------</span>

<span class="Comment">add a notify on each table when it is changed. Haven't worked out how</span>
<span class="Comment">to listen from haskell yet so is unused at the moment.</span>

<span class="Comment">needs some thought. the motivation is that the ui display is made up</span>
<span class="Comment">of chunks, each chunk depends on a different query. We can analyze</span>
<span class="Comment">that query, then try to update just that chunk when the relevant data</span>
<span class="Comment">is changed in the database, which used to work roughly in the old</span>
<span class="Comment">ruby gui code.</span>

<span class="Comment">*/</span>
<span class="Comment">/*</span>
<span class="Comment">create function set_notifies_on_all_data_tables() returns void as $$</span>
<span class="Comment">declare</span>
<span class="Comment">  r record;</span>
<span class="Comment">begin</span>
<span class="Comment">  for r in select relvar_name from base_relvar_metadata where type='data'</span>
<span class="Comment">  except</span>
<span class="Comment">  select relvar_name from triggers where trigger_name like '%_changed' loop</span>
<span class="Comment">    perform notify_on_changed(r.relvar_name);</span>
<span class="Comment">  end loop;</span>
<span class="Comment">end;</span>
<span class="Comment">$$ language plpgsql volatile;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">select</span> <span class="VarId">set_relvar_type</span><span class="Symbol">(</span><span class="Char">'base_relvar_metadata'</span><span class="Symbol">,</span><span class="Char">'readonly'</span><span class="Symbol">);</span></pre></div></div><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/31/11 20:00:52, hssqlppp-0.3.0</div
    ></body
  ></html
>
