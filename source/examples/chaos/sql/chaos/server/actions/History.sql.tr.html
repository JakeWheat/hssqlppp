<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >History.sql transformed</title
    ><link href="../../../../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../../../../index.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><div class='SqlPostgresql'><div class='UnusedSql'><pre class="sourceCode"><span class="Comment">-- replaced sql ------------------------</span>
<span class="Comment">/*</span>
<span class="Comment">================================================================================</span>

<span class="Comment">= history</span>
<span class="Comment">save a short description of each action completed during play</span>

<span class="Alert">TODO:</span><span class="Comment"> create a detailed history that allows a game to be replayed</span>
<span class="Comment">then create a view to show the player visible log with some events</span>
<span class="Comment">removed and some combined.</span>
<span class="Comment">*/</span>

<span class="Keyword">select</span> <span class="VarId">module</span><span class="Symbol">(</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">);</span></pre></div></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">modules</span> <span class="Symbol">(</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateDomain (DomainType &quot;history_name_enum&quot;) (ScalarType &quot;text&quot;)]*/</span>
<span class="Keyword">create</span> <span class="Keyword">domain</span> <span class="VarId">history_name_enum</span> <span class="Keyword">as</span> <span class="VarId">text</span>
       <span class="Keyword">check</span> <span class="Symbol">(</span><span class="VarId">value</span> <span class="VarId">in</span> <span class="Symbol">(</span>
                        <span class="Char">'spell_succeeded'</span>
                       <span class="Symbol">,</span><span class="Char">'spell_failed'</span>
                       <span class="Symbol">,</span><span class="Char">'chinned'</span>
                       <span class="Symbol">,</span><span class="Char">'shrugged_off'</span>
                       <span class="Symbol">,</span><span class="Char">'walked'</span>
                       <span class="Symbol">,</span><span class="Char">'fly'</span>
                       <span class="Symbol">,</span><span class="Char">'attack'</span>
                       <span class="Symbol">,</span><span class="Char">'ranged_attack'</span>
                       <span class="Symbol">,</span><span class="Char">'set_imaginary'</span>
                       <span class="Symbol">,</span><span class="Char">'set_real'</span>
                       <span class="Symbol">,</span><span class="Char">'game_won'</span>
                       <span class="Symbol">,</span><span class="Char">'game_drawn'</span>
                       <span class="Symbol">,</span><span class="Char">'spell_skipped'</span>
                       <span class="Symbol">,</span><span class="Char">'new_turn'</span>
                       <span class="Symbol">,</span><span class="Char">'wizard_up'</span>
                       <span class="Symbol">,</span><span class="Char">'choose_spell'</span>
                       <span class="Symbol">,</span><span class="Char">'spread'</span>
                       <span class="Symbol">,</span><span class="Char">'recede'</span>
                       <span class="Symbol">,</span><span class="Char">'disappear'</span>
                       <span class="Symbol">,</span><span class="Char">'new_game'</span>
                       <span class="Symbol">,</span><span class="Char">'attempt_target_spell'</span>
                       <span class="Symbol">));</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'history_name_enum'</span><span class="Symbol">,</span><span class="Char">'domain'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><div class='UnusedSql'><pre class="sourceCode"><span class="Comment">-- replaced sql ------------------------</span>
<span class="Keyword">select</span> <span class="VarId">create6nf</span> <span class="Symbol">(</span>$$

  <span class="VarId">action_history_mr</span> <span class="Symbol">(</span>
    <span class="VarId">id</span> <span class="Type">serial</span> <span class="Keyword">unique</span><span class="Symbol">,</span>
    <span class="VarId">history_name</span> <span class="VarId">history_name_enum</span>
  <span class="Symbol">);</span>

  <span class="VarId">action_history_allegiance</span> <span class="Symbol">:</span> <span class="VarId">action_history_mr</span><span class="Symbol">(</span>
    <span class="VarId">allegiance</span> <span class="VarId">text</span>
  <span class="Symbol">);</span>

  <span class="VarId">action_history_source</span> <span class="Symbol">:</span> <span class="VarId">action_history_allegiance</span> <span class="Symbol">(</span>
    <span class="VarId">x</span> <span class="Type">int</span><span class="Symbol">,</span>
    <span class="VarId">y</span> <span class="VarId">int</span>
  <span class="Symbol">);</span>

  <span class="VarId">action_history_target</span> <span class="Symbol">:</span> <span class="VarId">action_history_source</span> <span class="Symbol">(</span>
    <span class="VarId">tx</span> <span class="Type">int</span><span class="Symbol">,</span>
    <span class="VarId">ty</span> <span class="VarId">int</span>
  <span class="Symbol">);</span>

  <span class="VarId">action_history_piece</span> <span class="Symbol">:</span> <span class="VarId">action_history_allegiance</span> <span class="Symbol">(</span>
    <span class="VarId">ptype</span> <span class="Type">text</span><span class="Symbol">,</span>
    <span class="VarId">tag</span> <span class="VarId">int</span>
  <span class="Symbol">);</span>

  <span class="VarId">action_history_piece_source</span> <span class="Symbol">:</span> <span class="VarId">action_history_piece</span><span class="Symbol">,</span> <span class="VarId">action_history_source</span><span class="Symbol">;</span>

  <span class="VarId">action_history_piece_target</span> <span class="Symbol">:</span> <span class="VarId">action_history_piece</span><span class="Symbol">,</span> <span class="VarId">action_history_target</span><span class="Symbol">;</span>

  <span class="VarId">action_history_spell</span> <span class="Symbol">:</span> <span class="VarId">action_history_allegiance</span> <span class="Symbol">(</span>
    <span class="VarId">spell_name</span> <span class="VarId">text</span>
  <span class="Symbol">);</span>

  <span class="VarId">action_history_spell_source</span> <span class="Symbol">:</span> <span class="VarId">action_history_spell</span><span class="Symbol">,</span> <span class="VarId">action_history_source</span><span class="Symbol">;</span>

  <span class="VarId">action_history_spell_target</span> <span class="Symbol">:</span> <span class="VarId">action_history_spell</span><span class="Symbol">,</span> <span class="VarId">action_history_target</span><span class="Symbol">;</span>

  <span class="VarId">action_history_num_wiz</span> <span class="Symbol">:</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span>
    <span class="VarId">num_wizards</span> <span class="Type">int</span> <span class="VarId">null</span>
  <span class="Symbol">);</span>

  <span class="VarId">action_history_turn_num</span> <span class="Symbol">:</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span>
    <span class="VarId">turn_number</span> <span class="VarId">int</span>
  <span class="Symbol">);</span>

  <span class="VarId">action_history_turn_phase</span> <span class="Symbol">:</span> <span class="VarId">action_history_source</span> <span class="Symbol">(</span>
    <span class="VarId">turn_phase</span> <span class="VarId">turn_phase_enum</span>
  <span class="Symbol">);</span>

$$<span class="Symbol">);</span></pre></div></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*[CatCreateTable &quot;action_history_mr&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;allegiance&quot;,ScalarType &quot;text&quot;),(&quot;x&quot;,ScalarType &quot;int4&quot;),(&quot;y&quot;,ScalarType &quot;int4&quot;),(&quot;tx&quot;,ScalarType &quot;int4&quot;),(&quot;ty&quot;,ScalarType &quot;int4&quot;),(&quot;ptype&quot;,ScalarType &quot;text&quot;),(&quot;tag&quot;,ScalarType &quot;int4&quot;),(&quot;spell_name&quot;,ScalarType &quot;text&quot;),(&quot;num_wizards&quot;,ScalarType &quot;int4&quot;),(&quot;turn_number&quot;,ScalarType &quot;int4&quot;),(&quot;turn_phase&quot;,DomainType &quot;turn_phase_enum&quot;)] [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;),(&quot;cmax&quot;,ScalarType &quot;cid&quot;),(&quot;xmax&quot;,ScalarType &quot;xid&quot;),(&quot;cmin&quot;,ScalarType &quot;cid&quot;),(&quot;xmin&quot;,ScalarType &quot;xid&quot;),(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span>
  <span class="VarId">id</span> <span class="Type">serial</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">unique</span><span class="Symbol">,</span>
  <span class="VarId">history_name</span> <span class="VarId">history_name_enum</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">allegiance</span> <span class="Type">text</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">x</span> <span class="Type">int</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">y</span> <span class="Type">int</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">tx</span> <span class="Type">int</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">ty</span> <span class="Type">int</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">ptype</span> <span class="Type">text</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">tag</span> <span class="Type">int</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">spell_name</span> <span class="Type">text</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">num_wizards</span> <span class="Type">int</span> <span class="Keyword">null</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">turn_number</span> <span class="Type">int</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">turn_phase</span> <span class="VarId">turn_phase_enum</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="Keyword">constraint</span> <span class="VarId">action_history_source_fields</span> <span class="Keyword">check</span> <span class="Symbol">((((</span><span class="VarId">x</span> <span class="VarId">is</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">y</span> <span class="VarId">is</span> <span class="Keyword">null</span><span class="Symbol">))</span> <span class="Keyword">or</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">x</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">y</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">))))),</span>
  <span class="Keyword">constraint</span> <span class="VarId">action_history_target_fields</span> <span class="Keyword">check</span> <span class="Symbol">((((</span><span class="VarId">tx</span> <span class="VarId">is</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">ty</span> <span class="VarId">is</span> <span class="Keyword">null</span><span class="Symbol">))</span> <span class="Keyword">or</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">x</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">y</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">tx</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">ty</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">))))))),</span>
  <span class="Keyword">constraint</span> <span class="VarId">action_history_piece_fields</span> <span class="Keyword">check</span> <span class="Symbol">((((</span><span class="VarId">ptype</span> <span class="VarId">is</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">tag</span> <span class="VarId">is</span> <span class="Keyword">null</span><span class="Symbol">))</span> <span class="Keyword">or</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">ptype</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">tag</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">))))),</span>
  <span class="Keyword">constraint</span> <span class="VarId">action_history_spell_fields</span> <span class="Keyword">check</span> <span class="Symbol">(((</span><span class="VarId">spell_name</span> <span class="VarId">is</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">or</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">spell_name</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)))),</span>
  <span class="Keyword">constraint</span> <span class="VarId">action_history_turn_phase_fields</span> <span class="Keyword">check</span> <span class="Symbol">(((</span><span class="VarId">turn_phase</span> <span class="VarId">is</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">or</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">x</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">y</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">turn_phase</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">))))))</span>
<span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_mr'</span><span class="Symbol">,</span><span class="Char">'table'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_mr_base&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_mr_base</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span><span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_mr_base'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_allegiance&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;allegiance&quot;,ScalarType &quot;text&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_allegiance</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">allegiance</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_allegiance'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_source&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;allegiance&quot;,ScalarType &quot;text&quot;),(&quot;x&quot;,ScalarType &quot;int4&quot;),(&quot;y&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_source</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">x</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_source'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_target&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;allegiance&quot;,ScalarType &quot;text&quot;),(&quot;x&quot;,ScalarType &quot;int4&quot;),(&quot;y&quot;,ScalarType &quot;int4&quot;),(&quot;tx&quot;,ScalarType &quot;int4&quot;),(&quot;ty&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_target</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span><span class="Symbol">,</span><span class="VarId">tx</span><span class="Symbol">,</span><span class="VarId">ty</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">x</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">tx</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_target'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_piece&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;allegiance&quot;,ScalarType &quot;text&quot;),(&quot;ptype&quot;,ScalarType &quot;text&quot;),(&quot;tag&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_piece</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">tag</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">ptype</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_piece'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_piece_source&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;allegiance&quot;,ScalarType &quot;text&quot;),(&quot;ptype&quot;,ScalarType &quot;text&quot;),(&quot;tag&quot;,ScalarType &quot;int4&quot;),(&quot;x&quot;,ScalarType &quot;int4&quot;),(&quot;y&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_piece_source</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">ptype</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">x</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_piece_source'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_piece_target&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;allegiance&quot;,ScalarType &quot;text&quot;),(&quot;ptype&quot;,ScalarType &quot;text&quot;),(&quot;tag&quot;,ScalarType &quot;int4&quot;),(&quot;x&quot;,ScalarType &quot;int4&quot;),(&quot;y&quot;,ScalarType &quot;int4&quot;),(&quot;tx&quot;,ScalarType &quot;int4&quot;),(&quot;ty&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_piece_target</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span><span class="Symbol">,</span><span class="VarId">tx</span><span class="Symbol">,</span><span class="VarId">ty</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">ptype</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">x</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">tx</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">))));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_piece_target'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_spell&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;allegiance&quot;,ScalarType &quot;text&quot;),(&quot;spell_name&quot;,ScalarType &quot;text&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_spell</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">spell_name</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">spell_name</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_spell'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_spell_source&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;allegiance&quot;,ScalarType &quot;text&quot;),(&quot;spell_name&quot;,ScalarType &quot;text&quot;),(&quot;x&quot;,ScalarType &quot;int4&quot;),(&quot;y&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_spell_source</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">spell_name</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">spell_name</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">x</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_spell_source'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_spell_target&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;allegiance&quot;,ScalarType &quot;text&quot;),(&quot;spell_name&quot;,ScalarType &quot;text&quot;),(&quot;x&quot;,ScalarType &quot;int4&quot;),(&quot;y&quot;,ScalarType &quot;int4&quot;),(&quot;tx&quot;,ScalarType &quot;int4&quot;),(&quot;ty&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_spell_target</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">spell_name</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span><span class="Symbol">,</span><span class="VarId">tx</span><span class="Symbol">,</span><span class="VarId">ty</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">spell_name</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">x</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">tx</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">))));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_spell_target'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_num_wiz&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;num_wizards&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_num_wiz</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">num_wizards</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">num_wizards</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_num_wiz'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_turn_num&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;turn_number&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_turn_num</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">turn_number</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">turn_number</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_turn_num'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateView &quot;action_history_turn_phase&quot; [(&quot;id&quot;,ScalarType &quot;int4&quot;),(&quot;history_name&quot;,DomainType &quot;history_name_enum&quot;),(&quot;allegiance&quot;,ScalarType &quot;text&quot;),(&quot;x&quot;,ScalarType &quot;int4&quot;),(&quot;y&quot;,ScalarType &quot;int4&quot;),(&quot;turn_phase&quot;,DomainType &quot;turn_phase_enum&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">action_history_turn_phase</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">id</span><span class="Symbol">,</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span><span class="Symbol">,</span><span class="VarId">turn_phase</span>
    <span class="Keyword">from</span> <span class="VarId">action_history_mr</span>
    <span class="Keyword">where</span> <span class="Symbol">((</span><span class="VarId">allegiance</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">((</span><span class="VarId">x</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)</span> <span class="Keyword">and</span> <span class="Symbol">(</span><span class="VarId">turn_phase</span> <span class="VarId">is</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">)));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_history_turn_phase'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">select</span> <span class="VarId">set_relvar_type</span><span class="Symbol">(</span><span class="Char">'action_history_mr'</span><span class="Symbol">,</span> <span class="Char">'data'</span><span class="Symbol">);</span>

<span class="Comment">--Turns</span></pre></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;get_current_wizard_pos&quot; [] (NamedCompositeType &quot;pos&quot;) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">get_current_wizard_pos</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="VarId">pos</span> <span class="Keyword">as</span> $$
  <span class="Keyword">select</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">current_wizard_table</span>
    <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">pieces</span>
      <span class="Keyword">on</span> <span class="VarId">ptype</span> <span class="Symbol">=</span> <span class="Char">'wizard'</span> <span class="Keyword">and</span> <span class="VarId">allegiance</span> <span class="Symbol">=</span> <span class="VarId">current_wizard</span>
$$ <span class="Keyword">language</span> <span class="VarId">sql</span> <span class="Keyword">stable</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'get_current_wizard_pos'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_new_turn&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_new_turn</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">turn_number</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'new_turn'</span><span class="Symbol">,</span> <span class="VarId">get_turn_number</span><span class="Symbol">());</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_new_turn'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_wizard_up&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_wizard_up</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="VarId">w</span> <span class="Symbol">:=</span> <span class="VarId">get_current_wizard_pos</span><span class="Symbol">();</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">turn_phase</span><span class="Symbol">,</span> <span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'wizard_up'</span><span class="Symbol">,</span> <span class="VarId">get_current_wizard</span><span class="Symbol">(),</span> <span class="VarId">get_turn_phase</span><span class="Symbol">(),</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_wizard_up'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_new_game&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_new_game</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">num_wizards</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'new_game'</span><span class="Symbol">,</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">count</span><span class="Symbol">(</span><span class="Number">1</span><span class="Symbol">)</span> <span class="Keyword">from</span> <span class="VarId">wizards</span><span class="Symbol">));</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_new_game'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_game_won&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_game_won</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="VarId">w</span> <span class="Symbol">:=</span> <span class="VarId">get_current_wizard_pos</span><span class="Symbol">();</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'game_won'</span><span class="Symbol">,</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">allegiance</span>
                         <span class="Keyword">from</span> <span class="VarId">pieces</span>
                         <span class="Keyword">where</span> <span class="VarId">ptype</span><span class="Symbol">=</span><span class="Char">'wizard'</span><span class="Symbol">),</span>
                         <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_game_won'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_game_drawn&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_game_drawn</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'game_drawn'</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>

<span class="Comment">--Choosing</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_game_drawn'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_choose_spell&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_choose_spell</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="VarId">w</span> <span class="Symbol">:=</span> <span class="VarId">get_current_wizard_pos</span><span class="Symbol">();</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">spell_name</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'choose_spell'</span><span class="Symbol">,</span> <span class="VarId">get_current_wizard</span><span class="Symbol">(),</span> <span class="VarId">get_current_wizard_spell</span><span class="Symbol">(),</span>
            <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_choose_spell'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_set_imaginary&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_set_imaginary</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'set_imaginary'</span><span class="Symbol">,</span> <span class="VarId">get_current_wizard</span><span class="Symbol">());</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_set_imaginary'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_set_real&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_set_real</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'set_real'</span><span class="Symbol">,</span> <span class="VarId">get_current_wizard</span><span class="Symbol">());</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>

<span class="Comment">--Casting</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_set_real'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_attempt_target_spell&quot; [ScalarType &quot;int4&quot;,ScalarType &quot;int4&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_attempt_target_spell</span><span class="Symbol">(</span><span class="VarId">px</span> <span class="Type">int</span><span class="Symbol">,</span> <span class="VarId">py</span> <span class="Type">int</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">w</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span>
    <span class="Keyword">where</span> <span class="VarId">allegiance</span><span class="Symbol">=</span><span class="VarId">get_current_wizard</span><span class="Symbol">()</span>
      <span class="Keyword">and</span> <span class="VarId">ptype</span> <span class="Symbol">=</span> <span class="Char">'wizard'</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">,</span> <span class="VarId">tx</span><span class="Symbol">,</span> <span class="VarId">ty</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'attempt_target_spell'</span><span class="Symbol">,</span> <span class="VarId">get_current_wizard</span><span class="Symbol">(),</span>
            <span class="VarId">get_current_wizard_spell</span><span class="Symbol">(),</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">,</span> <span class="VarId">px</span><span class="Symbol">,</span> <span class="VarId">py</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_attempt_target_spell'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_attempt_activate_spell&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_attempt_activate_spell</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">w</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span>
    <span class="Keyword">where</span> <span class="VarId">allegiance</span><span class="Symbol">=</span><span class="VarId">get_current_wizard</span><span class="Symbol">()</span>
      <span class="Keyword">and</span> <span class="VarId">ptype</span> <span class="Symbol">=</span> <span class="Char">'wizard'</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'attempt_target_spell'</span><span class="Symbol">,</span> <span class="VarId">get_current_wizard</span><span class="Symbol">(),</span>
            <span class="VarId">get_current_wizard_spell</span><span class="Symbol">(),</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_attempt_activate_spell'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_spell_succeeded&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_spell_succeeded</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">spell_name</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'spell_succeeded'</span><span class="Symbol">,</span> <span class="VarId">get_current_wizard</span><span class="Symbol">(),</span> <span class="VarId">get_current_wizard_spell</span><span class="Symbol">());</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_spell_succeeded'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_spell_failed&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_spell_failed</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">spell_name</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'spell_failed'</span><span class="Symbol">,</span> <span class="VarId">get_current_wizard</span><span class="Symbol">(),</span> <span class="VarId">get_current_wizard_spell</span><span class="Symbol">());</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_spell_failed'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_spell_skipped&quot; [] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_spell_skipped</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">spell_name</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'spell_skipped'</span><span class="Symbol">,</span> <span class="VarId">get_current_wizard</span><span class="Symbol">(),</span> <span class="VarId">get_current_wizard_spell</span><span class="Symbol">());</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>

<span class="Comment">--chinned and shrugged off</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_spell_skipped'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_chinned&quot; [NamedCompositeType &quot;piece_key&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_chinned</span><span class="Symbol">(</span><span class="VarId">k</span> <span class="VarId">piece_key</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">w</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span> <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">k</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'chinned'</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>

<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_chinned'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_shrugged_off&quot; [NamedCompositeType &quot;piece_key&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_shrugged_off</span><span class="Symbol">(</span><span class="VarId">k</span> <span class="VarId">piece_key</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">w</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span> <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">k</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'shrugged_off'</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>

<span class="Comment">--Autonomous</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_shrugged_off'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_receive_spell&quot; [ScalarType &quot;text&quot;,ScalarType &quot;text&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_receive_spell</span><span class="Symbol">(</span><span class="VarId">pwizard_name</span> <span class="Type">text</span><span class="Symbol">,</span> <span class="VarId">pspell_name</span> <span class="Type">text</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">w</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span>
    <span class="Keyword">where</span> <span class="VarId">allegiance</span><span class="Symbol">=</span><span class="VarId">pwizard_name</span>
      <span class="Keyword">and</span> <span class="VarId">ptype</span> <span class="Symbol">=</span> <span class="Char">'wizard'</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'choose_spell'</span><span class="Symbol">,</span> <span class="VarId">pwizard_name</span><span class="Symbol">,</span> <span class="VarId">pspell_name</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_receive_spell'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_spread&quot; [NamedCompositeType &quot;piece_key&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_spread</span><span class="Symbol">(</span><span class="VarId">k</span> <span class="VarId">piece_key</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">w</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span> <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">k</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'spread'</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_spread'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_recede&quot; [NamedCompositeType &quot;piece_key&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_recede</span><span class="Symbol">(</span><span class="VarId">k</span> <span class="VarId">piece_key</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">w</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span> <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">k</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'recede'</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_recede'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_disappear&quot; [NamedCompositeType &quot;piece_key&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_disappear</span><span class="Symbol">(</span><span class="VarId">k</span> <span class="VarId">piece_key</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">w</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span> <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">k</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'disappear'</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>


<span class="Comment">--Move</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_disappear'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_walked&quot; [ScalarType &quot;int4&quot;,ScalarType &quot;int4&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_walked</span><span class="Symbol">(</span><span class="VarId">sx</span> <span class="Type">int</span><span class="Symbol">,</span> <span class="VarId">sy</span> <span class="Type">int</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
  <span class="VarId">k</span> <span class="VarId">piece_key</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">k</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span> <span class="Keyword">from</span> <span class="VarId">selected_piece</span><span class="Symbol">;</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">w</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span> <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">k</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">,</span> <span class="VarId">tx</span><span class="Symbol">,</span> <span class="VarId">ty</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'walked'</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">,</span> <span class="VarId">sx</span><span class="Symbol">,</span> <span class="VarId">sy</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_walked'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_fly&quot; [ScalarType &quot;int4&quot;,ScalarType &quot;int4&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_fly</span><span class="Symbol">(</span><span class="VarId">sx</span> <span class="Type">int</span><span class="Symbol">,</span> <span class="VarId">sy</span> <span class="Type">int</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">w</span> <span class="VarId">pos</span><span class="Symbol">;</span>
  <span class="VarId">k</span> <span class="VarId">piece_key</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">k</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span> <span class="Keyword">from</span> <span class="VarId">selected_piece</span><span class="Symbol">;</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">w</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span> <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">k</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span> <span class="VarId">y</span><span class="Symbol">,</span> <span class="VarId">tx</span><span class="Symbol">,</span> <span class="VarId">ty</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'fly'</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">k</span><span class="Symbol">.</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">w</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">,</span> <span class="VarId">sx</span><span class="Symbol">,</span> <span class="VarId">sy</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_fly'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;add_history_attack&quot; [NamedCompositeType &quot;piece_key&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_attack</span><span class="Symbol">(</span><span class="VarId">t</span> <span class="VarId">piece_key</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">sp</span> <span class="VarId">record</span><span class="Symbol">;</span>
  <span class="VarId">tp</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">sp</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">selected_piece</span>
    <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">pieces</span><span class="Symbol">;</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">tp</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span> <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">t</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span><span class="Symbol">,</span><span class="VarId">tx</span><span class="Symbol">,</span><span class="VarId">ty</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'attack'</span><span class="Symbol">,</span> <span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">,</span> <span class="VarId">tp</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">tp</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_attack'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_ranged_attack</span><span class="Symbol">(</span><span class="VarId">t</span> <span class="VarId">piece_key</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">sp</span> <span class="VarId">record</span><span class="Symbol">;</span>
  <span class="VarId">tp</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">sp</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">selected_piece</span>
    <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">pieces</span><span class="Symbol">;</span>
  <span class="Keyword">select</span> <span class="Keyword">into</span> <span class="VarId">tp</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">from</span> <span class="VarId">pieces</span> <span class="Keyword">where</span> <span class="Symbol">(</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">t</span><span class="Symbol">;</span>
  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span> <span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span><span class="Symbol">,</span><span class="VarId">tx</span><span class="Symbol">,</span><span class="VarId">ty</span><span class="Symbol">)</span>
    <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Char">'ranged_attack'</span><span class="Symbol">,</span> <span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">allegiance</span><span class="Symbol">,</span> <span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">tag</span><span class="Symbol">,</span> <span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">,</span> <span class="VarId">tp</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">tp</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>


<span class="Comment">/*</span>

<span class="Comment">create a view to hide the details which players shouldn't be able to</span>
<span class="Comment">see - this is the view that the ui should use:</span>
<span class="Comment">hide set real, imaginary</span>
<span class="Comment">hide spell received in tree</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*[CatCreateFunction FunName &quot;add_history_ranged_attack&quot; [NamedCompositeType &quot;piece_key&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">add_history_ranged_attack</span> <span class="Symbol">(</span><span class="VarId">t</span> <span class="VarId">piece_key</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">sp</span> <span class="VarId">record</span><span class="Symbol">;</span>
  <span class="VarId">tp</span> <span class="VarId">pos</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">into</span> <span class="VarId">sp</span>
    <span class="Keyword">from</span> <span class="Symbol">(</span><span class="VarId">selected_piece</span>
          <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">pieces</span><span class="Symbol">);</span>

  <span class="Keyword">select</span> <span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span> <span class="Keyword">into</span> <span class="VarId">tp</span>
    <span class="Keyword">from</span> <span class="VarId">pieces</span>
    <span class="Keyword">where</span> <span class="Symbol">(</span><span class="Keyword">row</span><span class="Symbol">(</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">t</span><span class="Symbol">);</span>

  <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">action_history_mr</span> <span class="Symbol">(</span><span class="VarId">history_name</span><span class="Symbol">,</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">y</span><span class="Symbol">,</span><span class="VarId">tx</span><span class="Symbol">,</span><span class="VarId">ty</span><span class="Symbol">)</span>
  <span class="VarId">values</span>
    <span class="Symbol">(</span><span class="Char">'ranged_attack'</span><span class="Symbol">,</span><span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">allegiance</span><span class="Symbol">,</span><span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">tag</span><span class="Symbol">,</span><span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">sp</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">,</span><span class="VarId">tp</span><span class="Symbol">.</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">tp</span><span class="Symbol">.</span><span class="VarId">y</span><span class="Symbol">)</span>
  <span class="Symbol">;</span>

<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'add_history_ranged_attack'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Server.Actions.History'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/31/11 20:00:52, hssqlppp-0.3.0</div
    ></body
  ></html
>
