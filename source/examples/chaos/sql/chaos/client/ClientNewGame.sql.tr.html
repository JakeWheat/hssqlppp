<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >ClientNewGame.sql transformed</title
    ><link href="../../../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../../../index.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><div class='SqlPostgresql'><div class='UnusedSql'><pre class="sourceCode"><span class="Comment">-- replaced sql ------------------------</span>
<span class="Comment">/*</span>

<span class="Comment">================================================================================</span>

<span class="Comment">== new game action</span>
<span class="Comment">*/</span>

<span class="Keyword">select</span> <span class="VarId">module</span><span class="Symbol">(</span><span class="Char">'Chaos.Client.ClientNewGame'</span><span class="Symbol">);</span>

<span class="Comment">/*create table action_client_new_game_argument (</span>
<span class="Comment">  place int unique,</span>
<span class="Comment">  wizard_name text unique,</span>
<span class="Comment">  sprite text unique references sprites,</span>
<span class="Comment">  colour text unique, --references colours(name),</span>
<span class="Comment">  computer_controlled boolean</span>
<span class="Comment">);</span>
<span class="Comment">select set_relvar_type('action_client_new_game_argument', 'stack');</span>

<span class="Comment">select create_assertion('action_client_new_game_place_valid',</span>
<span class="Comment">'(select count(*) from action_client_new_game_argument</span>
<span class="Comment">  where place &gt;=</span>
<span class="Comment">  (select count(*) from action_client_new_game_argument)) = 0');*/</span></pre></div></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">modules</span> <span class="Symbol">(</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'Chaos.Client.ClientNewGame'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><div class='UnusedSql'><pre class="sourceCode"><span class="Comment">-- replaced sql ------------------------</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">client_new_game_t</span> <span class="Symbol">(</span>
  <span class="VarId">place</span> <span class="Type">int</span><span class="Symbol">,</span>
  <span class="VarId">wizard_name</span> <span class="Type">text</span><span class="Symbol">,</span>
  <span class="VarId">sprite</span> <span class="Type">text</span><span class="Symbol">,</span>
  <span class="VarId">colour</span> <span class="Type">text</span><span class="Symbol">,</span>
  <span class="VarId">computer_controlled</span> <span class="VarId">boolean</span>
<span class="Symbol">);</span>

<span class="Comment">--this calls server new game</span></pre></div></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*[CatCreateTable &quot;client_new_game_t&quot; [(&quot;place&quot;,ScalarType &quot;int4&quot;),(&quot;wizard_name&quot;,ScalarType &quot;text&quot;),(&quot;sprite&quot;,ScalarType &quot;text&quot;),(&quot;colour&quot;,ScalarType &quot;text&quot;),(&quot;computer_controlled&quot;,ScalarType &quot;bool&quot;)] [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;),(&quot;cmax&quot;,ScalarType &quot;cid&quot;),(&quot;xmax&quot;,ScalarType &quot;xid&quot;),(&quot;cmin&quot;,ScalarType &quot;cid&quot;),(&quot;xmin&quot;,ScalarType &quot;xid&quot;),(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">client_new_game_t</span> <span class="Symbol">(</span>
  <span class="VarId">place</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">wizard_name</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">sprite</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">colour</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
  <span class="VarId">computer_controlled</span> <span class="VarId">boolean</span> <span class="Keyword">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'client_new_game_t'</span><span class="Symbol">,</span><span class="Char">'table'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.ClientNewGame'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">action_client_new_game</span><span class="Symbol">(</span><span class="VarId">a</span> <span class="VarId">client_new_game_t</span> <span class="Symbol">[])</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Comment">--assert: argument has between 2 and 8 active wizards</span>
  <span class="Comment">--delete from action_new_game_argument;</span>
  <span class="Comment">--delete from init_wizard_display_info_argument;</span>
  <span class="Comment">-- clear data tables</span>
  <span class="Keyword">delete</span> <span class="Keyword">from</span> <span class="VarId">cursor_position</span><span class="Symbol">;</span>
  <span class="Keyword">delete</span> <span class="Keyword">from</span> <span class="VarId">wizard_display_info</span><span class="Symbol">;</span>

  <span class="Comment">--delete from last_history_effect_id_table;</span>
  <span class="Comment">--insert into last_history_effect_id_table values (-1);</span>
  <span class="Comment">--delete from board_square_effects;</span>
  <span class="Comment">--delete from board_beam_effects;</span>
  <span class="Comment">--delete from board_sound_effects;</span>
  <span class="Comment">--delete from current_effects;</span>

  <span class="Keyword">perform</span> <span class="VarId">action_new_game</span><span class="Symbol">(</span>
          <span class="Symbol">(</span><span class="VarId">with</span>
            <span class="VarId">s</span> <span class="VarId">as</span>
              <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">place</span><span class="Symbol">,</span><span class="VarId">wizard_name</span><span class="Symbol">,</span> <span class="VarId">computer_controlled</span>
               <span class="Keyword">from</span> <span class="VarId">unnest</span><span class="Symbol">(</span><span class="VarId">a</span><span class="Symbol">))</span>
           <span class="Keyword">select</span> <span class="VarId">array_agg</span><span class="Symbol">((</span><span class="VarId">place</span><span class="Symbol">,</span><span class="VarId">wizard_name</span><span class="Symbol">,</span><span class="VarId">computer_controlled</span><span class="Symbol">)::</span><span class="VarId">new_game_t</span><span class="Symbol">)</span>
             <span class="Keyword">from</span> <span class="VarId">s</span><span class="Symbol">));</span>

  <span class="Comment">--wizard display_info</span>
  <span class="Comment">/*delete from init_wizard_display_info_argument;</span>
<span class="Comment">  insert into init_wizard_display_info_argument</span>
<span class="Comment">      (wizard_name, sprite, colour)</span>
<span class="Comment">    select wizard_name, sprite, colour</span>
<span class="Comment">    from unnest(a);*/</span>
  <span class="Keyword">perform</span> <span class="VarId">init_wizard_display_info</span><span class="Symbol">(</span>
    <span class="Symbol">(</span><span class="Keyword">with</span> <span class="VarId">s</span> <span class="Keyword">as</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">wizard_name</span><span class="Symbol">,</span><span class="VarId">sprite</span> <span class="Keyword">as</span> <span class="VarId">default_sprite</span><span class="Symbol">,</span><span class="VarId">colour</span> <span class="Keyword">from</span> <span class="VarId">unnest</span><span class="Symbol">(</span><span class="VarId">a</span><span class="Symbol">))</span>
     <span class="Keyword">select</span> <span class="VarId">array_agg</span><span class="Symbol">((</span><span class="VarId">wizard_name</span><span class="Symbol">,</span><span class="VarId">default_sprite</span><span class="Symbol">,</span><span class="VarId">colour</span><span class="Symbol">)::</span><span class="VarId">wizard_display_info</span><span class="Symbol">)</span>
     <span class="Keyword">from</span> <span class="VarId">s</span><span class="Symbol">));</span>

  <span class="Keyword">if</span> <span class="Keyword">not</span> <span class="Keyword">exists</span><span class="Symbol">(</span><span class="Keyword">select</span> <span class="Number">1</span> <span class="Keyword">from</span> <span class="VarId">spell_book_show_all_table</span><span class="Symbol">)</span> <span class="VarId">then</span>
    <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">spell_book_show_all_table</span> <span class="Keyword">values</span> <span class="Symbol">(</span><span class="VarId">false</span><span class="Symbol">);</span>
  <span class="Keyword">end</span> <span class="Keyword">if</span><span class="Symbol">;</span>

  <span class="Comment">--perform update_board_sprites_cache();</span>
  <span class="Comment">--perform check_for_effects();</span>
  <span class="Keyword">perform</span> <span class="VarId">init_cursor_position</span><span class="Symbol">();</span>
<span class="VarId">end</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>

<span class="Comment">/*</span>
<span class="Comment">select protect_readonly_relvars();</span>
<span class="Comment">select set_notifies_on_all_data_tables();</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*[CatCreateFunction FunName &quot;action_client_new_game&quot; [ArrayType (NamedCompositeType &quot;client_new_game_t&quot;)] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">action_client_new_game</span> <span class="Symbol">(</span><span class="VarId">a</span> <span class="VarId">client_new_game_t</span><span class="Symbol">[])</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">delete</span> <span class="Keyword">from</span> <span class="VarId">cursor_position</span>
  <span class="Symbol">;</span>

  <span class="Keyword">delete</span> <span class="Keyword">from</span> <span class="VarId">wizard_display_info</span>
  <span class="Symbol">;</span>

  <span class="Keyword">perform</span> <span class="VarId">action_new_game</span><span class="Symbol">((</span><span class="VarId">with</span>
                             <span class="VarId">s</span> <span class="Keyword">as</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">place</span><span class="Symbol">,</span><span class="VarId">wizard_name</span><span class="Symbol">,</span><span class="VarId">computer_controlled</span>
                                     <span class="Keyword">from</span> <span class="VarId">unnest</span><span class="Symbol">(</span><span class="VarId">a</span><span class="Symbol">))</span>
                           <span class="Keyword">select</span> <span class="VarId">array_agg</span><span class="Symbol">(</span><span class="VarId">cast</span><span class="Symbol">(</span><span class="Keyword">row</span><span class="Symbol">(</span><span class="VarId">place</span><span class="Symbol">,</span><span class="VarId">wizard_name</span><span class="Symbol">,</span><span class="VarId">computer_controlled</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">new_game_t</span><span class="Symbol">))</span>
                             <span class="Keyword">from</span> <span class="VarId">s</span><span class="Symbol">));</span>

  <span class="Keyword">perform</span> <span class="VarId">init_wizard_display_info</span><span class="Symbol">((</span><span class="VarId">with</span>
                                      <span class="VarId">s</span> <span class="Keyword">as</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">wizard_name</span><span class="Symbol">,</span><span class="VarId">sprite</span> <span class="Keyword">as</span> <span class="VarId">default_sprite</span><span class="Symbol">,</span><span class="VarId">colour</span>
                                              <span class="Keyword">from</span> <span class="VarId">unnest</span><span class="Symbol">(</span><span class="VarId">a</span><span class="Symbol">))</span>
                                    <span class="Keyword">select</span> <span class="VarId">array_agg</span><span class="Symbol">(</span><span class="VarId">cast</span><span class="Symbol">(</span><span class="Keyword">row</span><span class="Symbol">(</span><span class="VarId">wizard_name</span><span class="Symbol">,</span><span class="VarId">default_sprite</span><span class="Symbol">,</span><span class="VarId">colour</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">wizard_display_info</span><span class="Symbol">))</span>
                                      <span class="Keyword">from</span> <span class="VarId">s</span><span class="Symbol">));</span>

  <span class="Keyword">if</span> <span class="Symbol">(</span><span class="Keyword">not</span> <span class="Symbol">(</span><span class="Keyword">exists</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="Number">1</span>
                     <span class="Keyword">from</span> <span class="VarId">spell_book_show_all_table</span><span class="Symbol">)))</span> <span class="VarId">then</span>
       <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">spell_book_show_all_table</span>
       <span class="VarId">values</span>
         <span class="Symbol">(</span><span class="VarId">false</span><span class="Symbol">)</span>
       <span class="Symbol">;</span>

  <span class="Keyword">end</span> <span class="Keyword">if</span><span class="Symbol">;</span>

  <span class="Keyword">perform</span> <span class="VarId">init_cursor_position</span><span class="Symbol">();</span>

<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_client_new_game'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.ClientNewGame'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/31/11 20:00:52, hssqlppp-0.3.0</div
    ></body
  ></html
>
