<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >NewGameWidget</title
    ><link href="../../../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../../../index.txt.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><div id="section"
    ><h1
      >/*</h1
      ><p
      >= new game widget</p
      ><p
      >Starting new game involves the following choices: number of wizards (2-8) computer wizards same ai same stats as player for each wizard: name text - autogenerated, can be changed computer_controlled bool sprite and colour displayed but cannot currently be changed</p
      ><p
      >to add AI level for each computer controlled wizard change playing area size, square or hexagon tiles */</p
      ><div class='sourceCode'><div class='literate'><div class='sql'><pre class="sourceCode">
select module('Chaos.Client.NewGameWidget');

</pre></div></div></div><p
      >/* == data */</p
      ><div class='sourceCode'><div class='literate'><div class='sql'><pre class="sourceCode">

create domain new_wizard_state as text
  check (value in ('human', 'computer', 'none'));

create table new_game_widget_state (
  line int unique,
  wizard_name text unique,
  sprite text unique references sprites,
  colour text unique,
  state new_wizard_state
);
select set_relvar_type('new_game_widget_state', 'data');
select create_assertion('new_game_widget_state_line_valid',
' not exists(select 1 from new_game_widget_state
  where line &gt;= 8)');

</pre></div></div></div><p
      >/* == helpers */</p
      ><div class='sourceCode'><div class='literate'><div class='sql'><pre class="sourceCode">

create function extract_wizard_state(state text) returns boolean as $$
declare
  ret boolean;
begin
  if state = 'human' then
    ret = false;
  elseif state = 'computer' then
    ret = true;
  else
    raise exception
      'argument must be human or computer, called with %', state;
  end if;
  return ret;
end
$$ language plpgsql immutable;

create function action_reset_new_game_widget_state() returns void as $$
begin
    delete from new_game_widget_state;
    insert into new_game_widget_state
      (line, wizard_name, sprite, colour, state) values
      (0, 'Buddha', 'wizard0', 'blue', 'human'),
      (1, 'Kong Fuzi', 'wizard1', 'purple', 'computer'),
      (2, 'Laozi', 'wizard2', 'cyan', 'computer'),
      (3, 'Moshe', 'wizard3', 'yellow', 'computer'),
      (4, 'Muhammad', 'wizard4', 'green', 'computer'),
      (5, 'Shiva', 'wizard5', 'red', 'computer'),
      (6, 'Yeshua', 'wizard6', 'white', 'computer'),
      (7, 'Zarathushthra', 'wizard7', 'orange', 'computer');
end
$$ language plpgsql volatile;

</pre></div></div></div><p
      >/* == actions */</p
      ><div class='sourceCode'><div class='literate'><div class='sql'><pre class="sourceCode">

create function action_client_new_game_using_new_game_widget_state()
  returns void as $$
begin
  </pre></div></div></div><p
      >/<em
	>delete from action_client_new_game_argument; insert into action_client_new_game_argument (place, wizard_name, sprite, colour, computer_controlled) select line, wizard_name, sprite, colour, case when state = 'computer' then true else false end from new_game_widget_state where state != 'none';</em
	>/</p
      ><div class='sourceCode'><div class='literate'><div class='sql'><pre class="sourceCode">

  perform action_client_new_game(
    (select array_agg((line,wizard_name,sprite,colour,
                      case when state = 'computer' then true
                        else false end)::client_new_game_t)
     from new_game_widget_state));
end
$$ language plpgsql volatile;

</pre></div></div></div><p
      >/*</p
      ><p
      >================================================================================</p
      ><p
      >= info widget (split?)</p
      ><p
      >turn phase spell, cursor info &amp; highlight key, cursor &amp; selected piece info</p
      ><p
      >================================================================================</p
      ><p
      >= planned widget notes:</p
      ><p
      >== help widget === controls === tutorials/ examples === rules reference == spell info, monster info - reference widget == wizard army widget == versioning access widget == action history widget == game manager widget == power/ debugger widget */</p
      ></div
    ><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/29/11 20:06:46, hssqlppp-0.3.0</div
    ></body
  ></html
>
