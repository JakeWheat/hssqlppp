<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >NewGameWidget</title
    ><link href="../../../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../../../index.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><div id="section"
    ><h1
      >/*</h1
      ><p
      >= new game widget</p
      ><p
      >Starting new game involves the following choices: number of wizards (2-8) computer wizards same ai same stats as player for each wizard: name text - autogenerated, can be changed computer_controlled bool sprite and colour displayed but cannot currently be changed</p
      ><p
      >to add AI level for each computer controlled wizard change playing area size, square or hexagon tiles */</p
      ><div class='sourceCode'><div class='literate'><div class='sql'><pre class="sourceCode">
<span class="Keyword">select</span> <span class="VarId">module</span><span class="Symbol">(</span><span class="Char">'Chaos.Client.NewGameWidget'</span><span class="Symbol">);</span>

</pre></div></div></div><p
      >/* == data */</p
      ><div class='sourceCode'><div class='literate'><div class='sql'><pre class="sourceCode">

<span class="Keyword">create</span> <span class="Keyword">domain</span> <span class="VarId">new_wizard_state</span> <span class="Keyword">as</span> <span class="VarId">text</span>
  <span class="Keyword">check</span> <span class="Symbol">(</span><span class="VarId">value</span> <span class="VarId">in</span> <span class="Symbol">(</span><span class="Char">'human'</span><span class="Symbol">,</span> <span class="Char">'computer'</span><span class="Symbol">,</span> <span class="Char">'none'</span><span class="Symbol">));</span>

<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">new_game_widget_state</span> <span class="Symbol">(</span>
  <span class="VarId">line</span> <span class="Type">int</span> <span class="Keyword">unique</span><span class="Symbol">,</span>
  <span class="VarId">wizard_name</span> <span class="Type">text</span> <span class="Keyword">unique</span><span class="Symbol">,</span>
  <span class="VarId">sprite</span> <span class="Type">text</span> <span class="Keyword">unique</span> <span class="Keyword">references</span> <span class="VarId">sprites</span><span class="Symbol">,</span>
  <span class="VarId">colour</span> <span class="Type">text</span> <span class="Keyword">unique</span><span class="Symbol">,</span>
  <span class="VarId">state</span> <span class="VarId">new_wizard_state</span>
<span class="Symbol">);</span>
<span class="Keyword">select</span> <span class="VarId">set_relvar_type</span><span class="Symbol">(</span><span class="Char">'new_game_widget_state'</span><span class="Symbol">,</span> <span class="Char">'data'</span><span class="Symbol">);</span>
<span class="Keyword">select</span> <span class="VarId">create_assertion</span><span class="Symbol">(</span><span class="Char">'new_game_widget_state_line_valid'</span><span class="Symbol">,</span>
' <span class="Keyword">not</span> <span class="Keyword">exists</span><span class="Symbol">(</span><span class="Keyword">select</span> <span class="Number">1</span> <span class="Keyword">from</span> <span class="VarId">new_game_widget_state</span>
  <span class="Keyword">where</span> <span class="VarId">line</span> <span class="Symbol">&gt;=</span> <span class="Number">8</span><span class="Symbol">)</span>'<span class="Symbol">);</span>

</pre></div></div></div><p
      >/* == helpers */</p
      ><div class='sourceCode'><div class='literate'><div class='sql'><pre class="sourceCode">

<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">extract_wizard_state</span><span class="Symbol">(</span><span class="VarId">state</span> <span class="Type">text</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="VarId">boolean</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">ret</span> <span class="VarId">boolean</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Keyword">if</span> <span class="VarId">state</span> <span class="Symbol">=</span> <span class="Char">'human'</span> <span class="VarId">then</span>
    <span class="VarId">ret</span> <span class="Symbol">=</span> <span class="VarId">false</span><span class="Symbol">;</span>
  <span class="Keyword">elseif</span> <span class="VarId">state</span> <span class="Symbol">=</span> <span class="Char">'computer'</span> <span class="VarId">then</span>
    <span class="VarId">ret</span> <span class="Symbol">=</span> <span class="VarId">true</span><span class="Symbol">;</span>
  <span class="VarId">else</span>
    <span class="Keyword">raise</span> <span class="VarId">exception</span>
      <span class="Char">'argument must be human or computer, called with %'</span><span class="Symbol">,</span> <span class="VarId">state</span><span class="Symbol">;</span>
  <span class="Keyword">end</span> <span class="Keyword">if</span><span class="Symbol">;</span>
  <span class="VarId">return</span> <span class="VarId">ret</span><span class="Symbol">;</span>
<span class="VarId">end</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">immutable</span><span class="Symbol">;</span>

<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">action_reset_new_game_widget_state</span><span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
    <span class="Keyword">delete</span> <span class="Keyword">from</span> <span class="VarId">new_game_widget_state</span><span class="Symbol">;</span>
    <span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">new_game_widget_state</span>
      <span class="Symbol">(</span><span class="VarId">line</span><span class="Symbol">,</span> <span class="VarId">wizard_name</span><span class="Symbol">,</span> <span class="VarId">sprite</span><span class="Symbol">,</span> <span class="VarId">colour</span><span class="Symbol">,</span> <span class="VarId">state</span><span class="Symbol">)</span> <span class="VarId">values</span>
      <span class="Symbol">(</span><span class="Number">0</span><span class="Symbol">,</span> <span class="Char">'Buddha'</span><span class="Symbol">,</span> <span class="Char">'wizard0'</span><span class="Symbol">,</span> <span class="Char">'blue'</span><span class="Symbol">,</span> <span class="Char">'human'</span><span class="Symbol">),</span>
      <span class="Symbol">(</span><span class="Number">1</span><span class="Symbol">,</span> <span class="Char">'Kong Fuzi'</span><span class="Symbol">,</span> <span class="Char">'wizard1'</span><span class="Symbol">,</span> <span class="Char">'purple'</span><span class="Symbol">,</span> <span class="Char">'computer'</span><span class="Symbol">),</span>
      <span class="Symbol">(</span><span class="Number">2</span><span class="Symbol">,</span> <span class="Char">'Laozi'</span><span class="Symbol">,</span> <span class="Char">'wizard2'</span><span class="Symbol">,</span> <span class="Char">'cyan'</span><span class="Symbol">,</span> <span class="Char">'computer'</span><span class="Symbol">),</span>
      <span class="Symbol">(</span><span class="Number">3</span><span class="Symbol">,</span> <span class="Char">'Moshe'</span><span class="Symbol">,</span> <span class="Char">'wizard3'</span><span class="Symbol">,</span> <span class="Char">'yellow'</span><span class="Symbol">,</span> <span class="Char">'computer'</span><span class="Symbol">),</span>
      <span class="Symbol">(</span><span class="Number">4</span><span class="Symbol">,</span> <span class="Char">'Muhammad'</span><span class="Symbol">,</span> <span class="Char">'wizard4'</span><span class="Symbol">,</span> <span class="Char">'green'</span><span class="Symbol">,</span> <span class="Char">'computer'</span><span class="Symbol">),</span>
      <span class="Symbol">(</span><span class="Number">5</span><span class="Symbol">,</span> <span class="Char">'Shiva'</span><span class="Symbol">,</span> <span class="Char">'wizard5'</span><span class="Symbol">,</span> <span class="Char">'red'</span><span class="Symbol">,</span> <span class="Char">'computer'</span><span class="Symbol">),</span>
      <span class="Symbol">(</span><span class="Number">6</span><span class="Symbol">,</span> <span class="Char">'Yeshua'</span><span class="Symbol">,</span> <span class="Char">'wizard6'</span><span class="Symbol">,</span> <span class="Char">'white'</span><span class="Symbol">,</span> <span class="Char">'computer'</span><span class="Symbol">),</span>
      <span class="Symbol">(</span><span class="Number">7</span><span class="Symbol">,</span> <span class="Char">'Zarathushthra'</span><span class="Symbol">,</span> <span class="Char">'wizard7'</span><span class="Symbol">,</span> <span class="Char">'orange'</span><span class="Symbol">,</span> <span class="Char">'computer'</span><span class="Symbol">);</span>
<span class="VarId">end</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>

</pre></div></div></div><p
      >/* == actions */</p
      ><div class='sourceCode'><div class='literate'><div class='sql'><pre class="sourceCode">

<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">action_client_new_game_using_new_game_widget_state</span><span class="Symbol">()</span>
  <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  </pre></div></div></div><p
      >/<em
	>delete from action_client_new_game_argument; insert into action_client_new_game_argument (place, wizard_name, sprite, colour, computer_controlled) select line, wizard_name, sprite, colour, case when state = 'computer' then true else false end from new_game_widget_state where state != 'none';</em
	>/</p
      ><div class='sourceCode'><div class='literate'><div class='sql'><pre class="sourceCode">

  <span class="Keyword">perform</span> <span class="VarId">action_client_new_game</span><span class="Symbol">(</span>
    <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">array_agg</span><span class="Symbol">((</span><span class="VarId">line</span><span class="Symbol">,</span><span class="VarId">wizard_name</span><span class="Symbol">,</span><span class="VarId">sprite</span><span class="Symbol">,</span><span class="VarId">colour</span><span class="Symbol">,</span>
                      <span class="Keyword">case</span> <span class="Keyword">when</span> <span class="VarId">state</span> <span class="Symbol">=</span> <span class="Char">'computer'</span> <span class="Keyword">then</span> <span class="VarId">true</span>
                        <span class="Keyword">else</span> <span class="VarId">false</span> <span class="Keyword">end</span><span class="Symbol">)::</span><span class="VarId">client_new_game_t</span><span class="Symbol">)</span>
     <span class="Keyword">from</span> <span class="VarId">new_game_widget_state</span><span class="Symbol">));</span>
<span class="VarId">end</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>

</pre></div></div></div><p
      >/*</p
      ><p
      >================================================================================</p
      ><p
      >= info widget (split?)</p
      ><p
      >turn phase spell, cursor info &amp; highlight key, cursor &amp; selected piece info</p
      ><p
      >================================================================================</p
      ><p
      >= planned widget notes:</p
      ><p
      >== help widget === controls === tutorials/ examples === rules reference == spell info, monster info - reference widget == wizard army widget == versioning access widget == action history widget == game manager widget == power/ debugger widget */</p
      ></div
    ><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/31/11 20:00:52, hssqlppp-0.3.0</div
    ></body
  ></html
>
