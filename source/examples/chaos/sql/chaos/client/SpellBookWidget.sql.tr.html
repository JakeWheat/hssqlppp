<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >SpellBookWidget.sql transformed</title
    ><link href="../../../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../../../index.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><div class='SqlPostgresql'><div class='UnusedSql'><pre class="sourceCode"><span class="Comment">-- replaced sql ------------------------</span>
<span class="Comment">/*</span>
<span class="Comment">================================================================================</span>

<span class="Comment">= spell book widget</span>

<span class="Comment">order the spells:</span>
<span class="Comment">wizard, attack, object, misc, monster</span>
<span class="Comment">law spells, then neutral, then chaos,</span>
<span class="Comment">highest to lowest base chance,</span>
<span class="Comment">alpha by spell name</span>

<span class="Comment">this is a proper mess</span>

<span class="Comment">== sprites</span>
<span class="Comment">*/</span>
<span class="Keyword">select</span> <span class="VarId">module</span><span class="Symbol">(</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">);</span></pre></div></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">modules</span> <span class="Symbol">(</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><div class='UnusedSql'><pre class="sourceCode"><span class="Comment">-- replaced sql ------------------------</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">spell_sprites</span> <span class="Symbol">(</span>
  <span class="VarId">spell_name</span> <span class="Type">text</span> <span class="Keyword">unique</span> <span class="Keyword">references</span> <span class="VarId">spells_mr</span><span class="Symbol">,</span>
  <span class="VarId">sprite</span> <span class="Type">text</span> <span class="Keyword">references</span> <span class="VarId">sprites</span>
<span class="Symbol">);</span></pre></div></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*[CatCreateTable &quot;spell_sprites&quot; [(&quot;spell_name&quot;,ScalarType &quot;text&quot;),(&quot;sprite&quot;,ScalarType &quot;text&quot;)] [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;),(&quot;cmax&quot;,ScalarType &quot;cid&quot;),(&quot;xmax&quot;,ScalarType &quot;xid&quot;),(&quot;cmin&quot;,ScalarType &quot;cid&quot;),(&quot;xmin&quot;,ScalarType &quot;xid&quot;),(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">spell_sprites</span> <span class="Symbol">(</span>
  <span class="VarId">spell_name</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">unique</span> <span class="Keyword">references</span> <span class="VarId">spells_mr</span> <span class="Keyword">on</span> <span class="Keyword">delete</span> <span class="Keyword">cascade</span> <span class="Keyword">on</span> <span class="Keyword">update</span> <span class="Keyword">cascade</span><span class="Symbol">,</span>
  <span class="VarId">sprite</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">references</span> <span class="VarId">sprites</span> <span class="Keyword">on</span> <span class="Keyword">delete</span> <span class="Keyword">cascade</span> <span class="Keyword">on</span> <span class="Keyword">update</span> <span class="VarId">cascade</span>
<span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'spell_sprites'</span><span class="Symbol">,</span><span class="Char">'table'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">select</span> <span class="VarId">set_relvar_type</span><span class="Symbol">(</span><span class="Char">'spell_sprites'</span><span class="Symbol">,</span> <span class="Char">'readonly'</span><span class="Symbol">);</span></pre></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">copy</span> <span class="VarId">spell_sprites</span><span class="Symbol">(</span><span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="VarId">sprite</span><span class="Symbol">)</span> <span class="Keyword">from</span> <span class="Keyword">stdin</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="VarId">magic_wood</span>	<span class="VarId">magic_tree</span>
<span class="VarId">shadow_wood</span>	<span class="VarId">shadow_tree</span>
<span class="VarId">magic_fire</span>	<span class="VarId">magic_fire</span>
<span class="VarId">gooey_blob</span>	<span class="VarId">gooey_blob</span>
<span class="VarId">wall</span>	<span class="VarId">wall</span>
<span class="VarId">magic_castle</span>	<span class="VarId">magic_castle</span>
<span class="VarId">dark_citadel</span>	<span class="VarId">dark_citadel</span>
<span class="VarId">magic_bolt</span>	<span class="VarId">magic_bolt</span>
<span class="VarId">lightning</span>	<span class="VarId">lightning</span>
<span class="VarId">vengeance</span>	<span class="VarId">vengeance</span>
<span class="VarId">justice</span>	<span class="VarId">justice</span>
<span class="VarId">dark_power</span>	<span class="VarId">dark_power</span>
<span class="VarId">decree</span>	<span class="VarId">decree</span>
<span class="VarId">magic_armour</span>	<span class="VarId">wizard_magic_armour</span>
<span class="VarId">magic_shield</span>	<span class="VarId">wizard_magic_shield</span>
<span class="VarId">magic_knife</span>	<span class="VarId">wizard_magic_knife</span>
<span class="VarId">magic_sword</span>	<span class="VarId">wizard_magic_sword</span>
<span class="VarId">magic_bow</span>	<span class="VarId">wizard_magic_bow</span>
<span class="VarId">magic_wings</span>	<span class="VarId">wizard_magic_wings</span>
<span class="VarId">law</span>	<span class="VarId">law</span>
<span class="VarId">large_law</span>	<span class="VarId">large_law</span>
<span class="VarId">chaos</span>	<span class="VarId">chaos</span>
<span class="VarId">large_chaos</span>	<span class="VarId">large_chaos</span>
<span class="VarId">raise_dead</span>	<span class="VarId">raise_dead</span>
<span class="VarId">subversion</span>	<span class="VarId">subversion</span>
<span class="VarId">turmoil</span>	<span class="VarId">turmoil</span>
<span class="VarId">disbelieve</span>	<span class="VarId">disbelieve</span>
<span class="VarId">eagle</span>	<span class="VarId">eagle</span>
<span class="VarId">elf</span>	<span class="VarId">elf</span>
<span class="VarId">faun</span>	<span class="VarId">faun</span>
<span class="VarId">ghost</span>	<span class="VarId">ghost</span>
<span class="VarId">giant</span>	<span class="VarId">giant</span>
<span class="VarId">giant_rat</span>	<span class="VarId">giant_rat</span>
<span class="VarId">goblin</span>	<span class="VarId">goblin</span>
<span class="VarId">golden_dragon</span>	<span class="VarId">golden_dragon</span>
<span class="VarId">gorilla</span>	<span class="VarId">gorilla</span>
<span class="VarId">green_dragon</span>	<span class="VarId">green_dragon</span>
<span class="VarId">gryphon</span>	<span class="VarId">gryphon</span>
<span class="VarId">harpy</span>	<span class="VarId">harpy</span>
<span class="VarId">horse</span>	<span class="VarId">horse</span>
<span class="VarId">hydra</span>	<span class="VarId">hydra</span>
<span class="VarId">king_cobra</span>	<span class="VarId">king_cobra</span>
<span class="VarId">lion</span>	<span class="VarId">lion</span>
<span class="VarId">manticore</span>	<span class="VarId">manticore</span>
<span class="VarId">ogre</span>	<span class="VarId">ogre</span>
<span class="VarId">orc</span>	<span class="VarId">orc</span>
<span class="VarId">pegasus</span>	<span class="VarId">pegasus</span>
<span class="VarId">red_dragon</span>	<span class="VarId">red_dragon</span>
<span class="VarId">skeleton</span>	<span class="VarId">skeleton</span>
<span class="VarId">spectre</span>	<span class="VarId">spectre</span>
<span class="VarId">unicorn</span>	<span class="VarId">unicorn</span>
<span class="VarId">vampire</span>	<span class="VarId">vampire</span>
<span class="VarId">wraith</span>	<span class="VarId">wraith</span>
<span class="VarId">zombie</span>	<span class="VarId">zombie</span>
<span class="VarId">shadow_form</span>	<span class="VarId">chaos</span>
\<span class="Symbol">.</span>

<span class="Comment">/*</span>
<span class="Comment">== show all setting</span>
<span class="Comment">*/</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="VarId">magic_wood</span>	<span class="VarId">magic_tree</span>
<span class="VarId">shadow_wood</span>	<span class="VarId">shadow_tree</span>
<span class="VarId">magic_fire</span>	<span class="VarId">magic_fire</span>
<span class="VarId">gooey_blob</span>	<span class="VarId">gooey_blob</span>
<span class="VarId">wall</span>	<span class="VarId">wall</span>
<span class="VarId">magic_castle</span>	<span class="VarId">magic_castle</span>
<span class="VarId">dark_citadel</span>	<span class="VarId">dark_citadel</span>
<span class="VarId">magic_bolt</span>	<span class="VarId">magic_bolt</span>
<span class="VarId">lightning</span>	<span class="VarId">lightning</span>
<span class="VarId">vengeance</span>	<span class="VarId">vengeance</span>
<span class="VarId">justice</span>	<span class="VarId">justice</span>
<span class="VarId">dark_power</span>	<span class="VarId">dark_power</span>
<span class="VarId">decree</span>	<span class="VarId">decree</span>
<span class="VarId">magic_armour</span>	<span class="VarId">wizard_magic_armour</span>
<span class="VarId">magic_shield</span>	<span class="VarId">wizard_magic_shield</span>
<span class="VarId">magic_knife</span>	<span class="VarId">wizard_magic_knife</span>
<span class="VarId">magic_sword</span>	<span class="VarId">wizard_magic_sword</span>
<span class="VarId">magic_bow</span>	<span class="VarId">wizard_magic_bow</span>
<span class="VarId">magic_wings</span>	<span class="VarId">wizard_magic_wings</span>
<span class="VarId">law</span>	<span class="VarId">law</span>
<span class="VarId">large_law</span>	<span class="VarId">large_law</span>
<span class="VarId">chaos</span>	<span class="VarId">chaos</span>
<span class="VarId">large_chaos</span>	<span class="VarId">large_chaos</span>
<span class="VarId">raise_dead</span>	<span class="VarId">raise_dead</span>
<span class="VarId">subversion</span>	<span class="VarId">subversion</span>
<span class="VarId">turmoil</span>	<span class="VarId">turmoil</span>
<span class="VarId">disbelieve</span>	<span class="VarId">disbelieve</span>
<span class="VarId">eagle</span>	<span class="VarId">eagle</span>
<span class="VarId">elf</span>	<span class="VarId">elf</span>
<span class="VarId">faun</span>	<span class="VarId">faun</span>
<span class="VarId">ghost</span>	<span class="VarId">ghost</span>
<span class="VarId">giant</span>	<span class="VarId">giant</span>
<span class="VarId">giant_rat</span>	<span class="VarId">giant_rat</span>
<span class="VarId">goblin</span>	<span class="VarId">goblin</span>
<span class="VarId">golden_dragon</span>	<span class="VarId">golden_dragon</span>
<span class="VarId">gorilla</span>	<span class="VarId">gorilla</span>
<span class="VarId">green_dragon</span>	<span class="VarId">green_dragon</span>
<span class="VarId">gryphon</span>	<span class="VarId">gryphon</span>
<span class="VarId">harpy</span>	<span class="VarId">harpy</span>
<span class="VarId">horse</span>	<span class="VarId">horse</span>
<span class="VarId">hydra</span>	<span class="VarId">hydra</span>
<span class="VarId">king_cobra</span>	<span class="VarId">king_cobra</span>
<span class="VarId">lion</span>	<span class="VarId">lion</span>
<span class="VarId">manticore</span>	<span class="VarId">manticore</span>
<span class="VarId">ogre</span>	<span class="VarId">ogre</span>
<span class="VarId">orc</span>	<span class="VarId">orc</span>
<span class="VarId">pegasus</span>	<span class="VarId">pegasus</span>
<span class="VarId">red_dragon</span>	<span class="VarId">red_dragon</span>
<span class="VarId">skeleton</span>	<span class="VarId">skeleton</span>
<span class="VarId">spectre</span>	<span class="VarId">spectre</span>
<span class="VarId">unicorn</span>	<span class="VarId">unicorn</span>
<span class="VarId">vampire</span>	<span class="VarId">vampire</span>
<span class="VarId">wraith</span>	<span class="VarId">wraith</span>
<span class="VarId">zombie</span>	<span class="VarId">zombie</span>
<span class="VarId">shadow_form</span>	<span class="VarId">chaos</span>
\<span class="Symbol">.</span></pre></div></div><div class='SqlPostgresql'><div class='UnusedSql'><pre class="sourceCode"><span class="Comment">-- replaced sql ------------------------</span>
<span class="Keyword">select</span> <span class="VarId">create_var</span><span class="Symbol">(</span><span class="Char">'spell_book_show_all'</span><span class="Symbol">,</span> <span class="Char">'boolean'</span><span class="Symbol">);</span></pre></div></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*[CatCreateTable &quot;spell_book_show_all_table&quot; [(&quot;spell_book_show_all&quot;,ScalarType &quot;bool&quot;)] [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;),(&quot;cmax&quot;,ScalarType &quot;cid&quot;),(&quot;xmax&quot;,ScalarType &quot;xid&quot;),(&quot;cmin&quot;,ScalarType &quot;cid&quot;),(&quot;xmin&quot;,ScalarType &quot;xid&quot;),(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">spell_book_show_all_table</span> <span class="Symbol">(</span>
  <span class="VarId">spell_book_show_all</span> <span class="VarId">boolean</span> <span class="Keyword">primary</span> <span class="VarId">key</span>
<span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'spell_book_show_all_table'</span><span class="Symbol">,</span><span class="Char">'table'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateFunction FunName &quot;get_spell_book_show_all&quot; [] (ScalarType &quot;bool&quot;) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">get_spell_book_show_all</span> <span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="VarId">boolean</span> <span class="Keyword">as</span> $$
  <span class="Keyword">select</span> <span class="Symbol">*</span>
    <span class="Keyword">from</span> <span class="VarId">spell_book_show_all_table</span><span class="Symbol">;</span>

$$ <span class="Keyword">language</span> <span class="VarId">sql</span> <span class="Keyword">stable</span><span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'get_spell_book_show_all'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateFunction FunName &quot;check_con_spell_book_show_all_table_01_tuple&quot; [] (ScalarType &quot;bool&quot;) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">check_con_spell_book_show_all_table_01_tuple</span> <span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Type">bool</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="VarId">return</span> <span class="Symbol">((</span><span class="Keyword">select</span> <span class="VarId">count</span><span class="Symbol">(*)</span>
             <span class="Keyword">from</span> <span class="VarId">spell_book_show_all_table</span><span class="Symbol">)</span> <span class="Symbol">&lt;=</span> <span class="Number">1</span><span class="Symbol">);</span>

<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">stable</span><span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'check_con_spell_book_show_all_table_01_tuple'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Comment">/*[CatCreateFunction FunName &quot;spell_book_show_all_table_constraint_trigger_operator&quot; [] (Pseudo Trigger) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">spell_book_show_all_table_constraint_trigger_operator</span> <span class="Symbol">()</span> <span class="Keyword">returns</span> <span class="Keyword">trigger</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">if</span> <span class="Symbol">(</span><span class="Keyword">not</span> <span class="Symbol">(</span><span class="VarId">check_con_spell_book_show_all_table_01_tuple</span><span class="Symbol">()))</span> <span class="VarId">then</span>
       <span class="Keyword">raise</span> <span class="Keyword">exception</span> <span class="Char">'update violates database constraint spell_book_show_all_table_01_tuple'</span><span class="Symbol">;</span>

  <span class="Keyword">end</span> <span class="Keyword">if</span><span class="Symbol">;</span>

  <span class="VarId">return</span> <span class="VarId">OLD</span><span class="Symbol">;</span>

<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">stable</span><span class="Symbol">;</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'spell_book_show_all_table_constraint_trigger_operator'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>

<span class="Keyword">create</span> <span class="Keyword">trigger</span> <span class="VarId">spell_book_show_all_table_constraint_trigger</span> <span class="Keyword">after</span> <span class="Keyword">insert</span> <span class="Keyword">or</span> <span class="Keyword">update</span> <span class="Keyword">or</span> <span class="Keyword">delete</span> <span class="Keyword">on</span> <span class="VarId">spell_book_show_all_table</span> <span class="Keyword">for</span> <span class="Keyword">statement</span> <span class="Keyword">execute</span> <span class="VarId">procedure</span> <span class="VarId">spell_book_show_all_table_constraint_trigger_operator</span><span class="Symbol">();</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'spell_book_show_all_table_constraint_trigger'</span><span class="Symbol">,</span><span class="Char">'trigger'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">select</span> <span class="VarId">set_relvar_type</span><span class="Symbol">(</span><span class="Char">'spell_book_show_all_table'</span><span class="Symbol">,</span> <span class="Char">'data'</span><span class="Symbol">);</span></pre></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;action_spell_book_show_all_update&quot; [ScalarType &quot;bool&quot;] (Pseudo Void) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">action_spell_book_show_all_update</span><span class="Symbol">(</span><span class="VarId">v</span> <span class="VarId">boolean</span><span class="Symbol">)</span>
  <span class="Keyword">returns</span> <span class="Type">void</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">update</span> <span class="VarId">spell_book_show_all_table</span> <span class="Keyword">set</span> <span class="VarId">spell_book_show_all</span><span class="Symbol">=</span><span class="VarId">v</span><span class="Symbol">;</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">volatile</span><span class="Symbol">;</span>


<span class="Comment">/*</span>
<span class="Comment">=== internals</span>
<span class="Comment">==== ordering</span>
<span class="Comment">order the spells by spell category</span>
<span class="Comment">*/</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'action_spell_book_show_all_update'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateView &quot;section_orderv&quot; [(&quot;section_order&quot;,ScalarType &quot;int4&quot;),(&quot;spell_category&quot;,UnknownType)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">section_orderv</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="Number">1</span> <span class="Keyword">as</span> <span class="VarId">section_order</span><span class="Symbol">,</span> <span class="Char">'wizard'</span> <span class="Keyword">as</span> <span class="VarId">spell_category</span>
    <span class="Keyword">union</span> <span class="VarId">all</span>
  <span class="Keyword">select</span> <span class="Number">2</span> <span class="Keyword">as</span> <span class="VarId">section_order</span><span class="Symbol">,</span> <span class="Char">'attacking'</span> <span class="Keyword">as</span> <span class="VarId">spell_category</span>
    <span class="Keyword">union</span> <span class="VarId">all</span>
  <span class="Keyword">select</span> <span class="Number">3</span> <span class="Keyword">as</span> <span class="VarId">section_order</span><span class="Symbol">,</span> <span class="Char">'object'</span> <span class="Keyword">as</span> <span class="VarId">spell_category</span>
    <span class="Keyword">union</span> <span class="VarId">all</span>
  <span class="Keyword">select</span> <span class="Number">4</span> <span class="Keyword">as</span> <span class="VarId">section_order</span><span class="Symbol">,</span> <span class="Char">'miscellaneous'</span> <span class="Keyword">as</span> <span class="VarId">spell_category</span>
    <span class="Keyword">union</span> <span class="VarId">all</span>
  <span class="Keyword">select</span> <span class="Number">5</span> <span class="Keyword">as</span> <span class="VarId">section_order</span><span class="Symbol">,</span> <span class="Char">'monster'</span> <span class="Keyword">as</span> <span class="VarId">spell_category</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'section_orderv'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateView &quot;spells_with_order&quot; [(&quot;spell_name&quot;,ScalarType &quot;text&quot;),(&quot;base_chance&quot;,ScalarType &quot;int4&quot;),(&quot;alignment&quot;,ScalarType &quot;int4&quot;),(&quot;spell_category&quot;,DomainType &quot;spell_category&quot;),(&quot;description&quot;,ScalarType &quot;text&quot;),(&quot;alignment_order&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">spells_with_order</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="Symbol">*,</span> <span class="VarId">case</span>
          <span class="Keyword">when</span> <span class="VarId">alignment</span> <span class="Symbol">&gt;</span> <span class="Number">0</span> <span class="Keyword">then</span> <span class="Number">0</span>
              <span class="Keyword">when</span> <span class="VarId">alignment</span> <span class="Symbol">=</span> <span class="Number">0</span> <span class="Keyword">then</span> <span class="Number">1</span>
        <span class="Keyword">when</span> <span class="VarId">alignment</span> <span class="Symbol">&lt;</span> <span class="Number">0</span> <span class="Keyword">then</span> <span class="Number">2</span>
      <span class="Keyword">end</span> <span class="Keyword">as</span> <span class="VarId">alignment_order</span>
  <span class="Keyword">from</span> <span class="VarId">spells_mr_base</span> <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">section_orderv</span><span class="Symbol">;</span>
<span class="Comment">/*</span>
<span class="Comment">==== spell counts</span>
<span class="Comment">*/</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'spells_with_order'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateView &quot;current_wizard_spell_counts&quot; [(&quot;spell_name&quot;,ScalarType &quot;text&quot;),(&quot;count&quot;,ScalarType &quot;int8&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">current_wizard_spell_counts</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="Number">0</span> <span class="Keyword">as</span> <span class="VarId">count</span> <span class="VarId">from</span>
    <span class="Symbol">(</span><span class="Keyword">select</span> <span class="VarId">spell_name</span> <span class="Keyword">from</span> <span class="VarId">spells_mr</span> <span class="VarId">except</span>
     <span class="Keyword">select</span> <span class="VarId">spell_name</span> <span class="Keyword">from</span> <span class="VarId">spell_books</span>
       <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">current_wizard_table</span>
       <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">wizard_name</span> <span class="Symbol">=</span> <span class="VarId">current_wizard</span><span class="Symbol">))</span> <span class="Keyword">as</span> <span class="VarId">a</span>
 <span class="Keyword">union</span> <span class="VarId">all</span>
  <span class="Keyword">select</span> <span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="VarId">count</span><span class="Symbol">(</span><span class="VarId">spell_name</span><span class="Symbol">)</span>
  <span class="Keyword">from</span> <span class="VarId">spell_books</span>
  <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">current_wizard_table</span>
    <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">wizard_name</span> <span class="Symbol">=</span> <span class="VarId">current_wizard</span><span class="Symbol">)</span>
  <span class="Keyword">group</span> <span class="Keyword">by</span> <span class="VarId">spell_name</span><span class="Symbol">;</span>

<span class="Comment">--create a string to represent the number of copies of each spell</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'current_wizard_spell_counts'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;count_icons&quot; [ScalarType &quot;int4&quot;] (ScalarType &quot;text&quot;) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">count_icons</span><span class="Symbol">(</span><span class="Type">int</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">text</span> <span class="Keyword">as</span> $$
  <span class="Keyword">select</span> <span class="VarId">repeat</span><span class="Symbol">(</span><span class="Char">'#'</span><span class="Symbol">,</span> $<span class="Number">1</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">result</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">sql</span> <span class="Keyword">immutable</span><span class="Symbol">;</span>

<span class="Comment">--create a string to represent the alignment of each spell</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'count_icons'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;align_icons&quot; [ScalarType &quot;int4&quot;] (ScalarType &quot;text&quot;) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">align_icons</span><span class="Symbol">(</span><span class="Type">int</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">text</span> <span class="Keyword">as</span> $$
  <span class="Keyword">select</span> <span class="VarId">case</span>
    <span class="Keyword">when</span> $<span class="Number">1</span> <span class="Symbol">&lt;</span> <span class="Number">0</span> <span class="Keyword">then</span>  <span class="VarId">repeat</span><span class="Symbol">(</span><span class="Char">'*'</span><span class="Symbol">,</span> <span class="Symbol">-</span>$<span class="Number">1</span><span class="Symbol">)</span>
    <span class="Keyword">when</span> $<span class="Number">1</span> <span class="Symbol">&gt;</span> <span class="Number">0</span> <span class="Keyword">then</span>  <span class="VarId">repeat</span><span class="Symbol">(</span><span class="Char">'+'</span><span class="Symbol">,</span> $<span class="Number">1</span><span class="Symbol">)</span>
    <span class="Keyword">else</span> <span class="Char">'-'</span>
  <span class="Keyword">end</span> <span class="Keyword">as</span> <span class="VarId">result</span>
$$ <span class="Keyword">language</span> <span class="VarId">sql</span> <span class="Keyword">immutable</span><span class="Symbol">;</span>
<span class="Comment">/*</span>
<span class="Comment">==== colours</span>
<span class="Comment">colour each spell according to the probability of casting success</span>
<span class="Comment">*/</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'align_icons'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;chance_colour&quot; [ScalarType &quot;int4&quot;] (ScalarType &quot;text&quot;) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">chance_colour</span><span class="Symbol">(</span><span class="VarId">chance</span> <span class="Type">int</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">text</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="VarId">return</span> <span class="VarId">case</span>
    <span class="Keyword">when</span> <span class="VarId">chance</span> <span class="Symbol">=</span> <span class="Number">0</span> <span class="Keyword">then</span> <span class="Char">'grey'</span>
    <span class="Keyword">when</span> <span class="VarId">chance</span> <span class="Keyword">between</span> <span class="Number">1</span> <span class="Keyword">and</span> <span class="Number">20</span> <span class="Keyword">then</span> <span class="Char">'red'</span>
    <span class="Keyword">when</span> <span class="VarId">chance</span> <span class="Keyword">between</span> <span class="Number">21</span> <span class="Keyword">and</span> <span class="Number">40</span> <span class="Keyword">then</span> <span class="Char">'purple'</span>
    <span class="Keyword">when</span> <span class="VarId">chance</span> <span class="Keyword">between</span> <span class="Number">41</span> <span class="Keyword">and</span> <span class="Number">60</span> <span class="Keyword">then</span> <span class="Char">'green'</span>
    <span class="Keyword">when</span> <span class="VarId">chance</span> <span class="Keyword">between</span> <span class="Number">61</span> <span class="Keyword">and</span> <span class="Number">80</span> <span class="Keyword">then</span> <span class="Char">'cyan'</span>
    <span class="Keyword">when</span> <span class="VarId">chance</span> <span class="Keyword">between</span> <span class="Number">81</span> <span class="Keyword">and</span> <span class="Number">99</span> <span class="Keyword">then</span> <span class="Char">'yellow'</span>
    <span class="Keyword">when</span> <span class="VarId">chance</span> <span class="Symbol">=</span> <span class="Number">100</span> <span class="Keyword">then</span> <span class="Char">'white'</span>
    <span class="Keyword">else</span> <span class="Char">'blue'</span>
  <span class="Keyword">end</span><span class="Symbol">;</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">immutable</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'chance_colour'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateView &quot;spell_colours&quot; [(&quot;spell_name&quot;,ScalarType &quot;text&quot;),(&quot;colour&quot;,ScalarType &quot;text&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">spell_colours</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="VarId">chance_colour</span><span class="Symbol">(</span><span class="VarId">chance</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">colour</span>
    <span class="Keyword">from</span> <span class="VarId">spell_cast_chance</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'spell_colours'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;spell_colour&quot; [ScalarType &quot;text&quot;,ScalarType &quot;int4&quot;] (ScalarType &quot;text&quot;) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">spell_colour</span><span class="Symbol">(</span><span class="VarId">vspell</span> <span class="Type">text</span><span class="Symbol">,</span> <span class="VarId">vcount</span> <span class="Type">int</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">text</span> <span class="Keyword">as</span> $$
<span class="VarId">declare</span>
  <span class="VarId">colour</span> <span class="Type">text</span><span class="Symbol">;</span>
<span class="VarId">begin</span>
  <span class="Comment">--if spell is current wizard's selected spell then highlight it</span>
  <span class="Comment">--if spell count is 0 or we aren't in choose phase then colour is grey</span>
  <span class="Comment">--else colour spell according to casting chance</span>
  <span class="Keyword">if</span> <span class="Symbol">(</span><span class="Keyword">exists</span> <span class="Symbol">(</span><span class="Keyword">select</span> <span class="Number">1</span> <span class="Keyword">from</span> <span class="VarId">wizard_spell_choices</span>
             <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">current_wizard_table</span>
        <span class="Keyword">on</span> <span class="VarId">wizard_name</span> <span class="Symbol">=</span> <span class="VarId">current_wizard</span>
        <span class="Keyword">where</span> <span class="VarId">spell_name</span> <span class="Symbol">=</span> <span class="VarId">vspell</span><span class="Symbol">))</span> <span class="VarId">then</span>
    <span class="VarId">colour</span> <span class="Symbol">:=</span> <span class="Char">'inverse-'</span> <span class="Symbol">||</span> <span class="VarId">chance_colour</span><span class="Symbol">(</span><span class="VarId">spell_cast_chance</span><span class="Symbol">(</span><span class="VarId">vspell</span><span class="Symbol">));</span>
  <span class="Keyword">elseif</span> <span class="Symbol">(</span><span class="VarId">vcount</span> <span class="Symbol">=</span> <span class="Number">0</span> <span class="Keyword">or</span> <span class="VarId">get_turn_phase</span><span class="Symbol">()</span> <span class="Symbol">!=</span> <span class="Char">'choose'</span><span class="Symbol">)</span> <span class="VarId">then</span>
    <span class="VarId">colour</span> <span class="Symbol">:=</span> <span class="Char">'grey'</span><span class="Symbol">;</span>
  <span class="VarId">else</span>
    <span class="VarId">colour</span> <span class="Symbol">:=</span> <span class="VarId">chance_colour</span><span class="Symbol">(</span><span class="VarId">spell_cast_chance</span><span class="Symbol">(</span><span class="VarId">vspell</span><span class="Symbol">));</span>
  <span class="Keyword">end</span> <span class="Keyword">if</span><span class="Symbol">;</span>
  <span class="VarId">return</span> <span class="VarId">coalesce</span><span class="Symbol">(</span><span class="VarId">colour</span><span class="Symbol">,</span> <span class="Char">'blue'</span><span class="Symbol">);</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">stable</span><span class="Symbol">;</span>

<span class="Comment">-- format function for alignment</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'spell_colour'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateFunction FunName &quot;format_alignment&quot; [ScalarType &quot;int4&quot;] (ScalarType &quot;text&quot;) False]*/</span>
<span class="Keyword">create</span> <span class="Keyword">function</span> <span class="VarId">format_alignment</span><span class="Symbol">(</span><span class="VarId">alignment</span> <span class="Type">int</span><span class="Symbol">)</span> <span class="Keyword">returns</span> <span class="Type">text</span> <span class="Keyword">as</span> $$
<span class="VarId">begin</span>
  <span class="Keyword">if</span> <span class="Symbol">(</span><span class="VarId">alignment</span> <span class="Symbol">&lt;</span> <span class="Number">0</span><span class="Symbol">)</span> <span class="VarId">then</span>
    <span class="VarId">return</span> <span class="Char">'chaos-'</span> <span class="Symbol">||</span> <span class="VarId">cast</span><span class="Symbol">(</span>@ <span class="VarId">alignment</span> <span class="Keyword">as</span> <span class="Type">text</span><span class="Symbol">);</span>
  <span class="Keyword">elseif</span> <span class="Symbol">(</span><span class="VarId">alignment</span> <span class="Symbol">&gt;</span> <span class="Number">0</span><span class="Symbol">)</span> <span class="VarId">then</span>
    <span class="VarId">return</span> <span class="Char">'law-'</span> <span class="Symbol">||</span> <span class="VarId">cast</span><span class="Symbol">(</span><span class="VarId">alignment</span> <span class="Keyword">as</span> <span class="Type">text</span><span class="Symbol">);</span>
  <span class="VarId">else</span>
    <span class="VarId">return</span> <span class="Char">'neutral'</span><span class="Symbol">;</span>
  <span class="Keyword">end</span> <span class="Keyword">if</span><span class="Symbol">;</span>
<span class="Keyword">end</span><span class="Symbol">;</span>
$$ <span class="Keyword">language</span> <span class="VarId">plpgsql</span> <span class="Keyword">immutable</span><span class="Symbol">;</span>
<span class="Comment">/*</span>
<span class="Comment">== spell choice controls</span>
<span class="Comment">*/</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'format_alignment'</span><span class="Symbol">,</span><span class="Char">'function'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><div class='UnusedSql'><pre class="sourceCode"><span class="Comment">-- replaced sql ------------------------</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">spell_keys</span> <span class="Symbol">(</span>
  <span class="VarId">spell_name</span> <span class="Type">text</span> <span class="Keyword">unique</span> <span class="Keyword">references</span> <span class="VarId">spells_mr</span><span class="Symbol">,</span>
  <span class="Keyword">key</span> <span class="Type">text</span> <span class="VarId">unique</span>
<span class="Symbol">);</span></pre></div></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*[CatCreateTable &quot;spell_keys&quot; [(&quot;spell_name&quot;,ScalarType &quot;text&quot;),(&quot;key&quot;,ScalarType &quot;text&quot;)] [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;),(&quot;cmax&quot;,ScalarType &quot;cid&quot;),(&quot;xmax&quot;,ScalarType &quot;xid&quot;),(&quot;cmin&quot;,ScalarType &quot;cid&quot;),(&quot;xmin&quot;,ScalarType &quot;xid&quot;),(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">spell_keys</span> <span class="Symbol">(</span>
  <span class="VarId">spell_name</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">unique</span> <span class="Keyword">references</span> <span class="VarId">spells_mr</span> <span class="Keyword">on</span> <span class="Keyword">delete</span> <span class="Keyword">cascade</span> <span class="Keyword">on</span> <span class="Keyword">update</span> <span class="Keyword">cascade</span><span class="Symbol">,</span>
  <span class="Keyword">key</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="VarId">unique</span>
<span class="Symbol">);</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'spell_keys'</span><span class="Symbol">,</span><span class="Char">'table'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">select</span> <span class="VarId">set_relvar_type</span><span class="Symbol">(</span><span class="Char">'spell_keys'</span><span class="Symbol">,</span> <span class="Char">'readonly'</span><span class="Symbol">);</span></pre></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">copy</span> <span class="VarId">spell_keys</span> <span class="Symbol">(</span><span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="Keyword">key</span><span class="Symbol">)</span> <span class="Keyword">from</span> <span class="Keyword">stdin</span><span class="Symbol">;</span></pre></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="VarId">magic_knife</span>	<span class="Number">1</span>
<span class="VarId">magic_shield</span>	<span class="Number">2</span>
<span class="VarId">magic_armour</span>	<span class="Number">3</span>
<span class="VarId">magic_bow</span>	<span class="Number">4</span>
<span class="VarId">magic_sword</span>	<span class="Number">5</span>
<span class="VarId">shadow_form</span>	<span class="Number">6</span>
<span class="VarId">magic_wings</span>	<span class="Number">7</span>
<span class="VarId">decree</span>	<span class="VarId">A</span>
<span class="VarId">justice</span>	<span class="VarId">B</span>
<span class="VarId">lightning</span>	<span class="VarId">C</span>
<span class="VarId">magic_bolt</span>	<span class="VarId">D</span>
<span class="VarId">vengeance</span>	<span class="VarId">E</span>
<span class="VarId">dark_power</span>	<span class="VarId">F</span>
<span class="VarId">magic_wood</span>	<span class="VarId">G</span>
<span class="VarId">magic_castle</span>	<span class="VarId">H</span>
<span class="VarId">wall</span>	<span class="VarId">I</span>
<span class="VarId">gooey_blob</span>	<span class="VarId">J</span>
<span class="VarId">magic_fire</span>	<span class="VarId">K</span>
<span class="VarId">dark_citadel</span>	<span class="VarId">L</span>
<span class="VarId">shadow_wood</span>	<span class="VarId">M</span>
<span class="VarId">law</span>	<span class="VarId">O</span>
<span class="VarId">large_law</span>	<span class="VarId">P</span>
<span class="VarId">disbelieve</span>	<span class="VarId">Q</span>
<span class="VarId">subversion</span>	<span class="VarId">R</span>
<span class="VarId">turmoil</span>	<span class="VarId">S</span>
<span class="VarId">chaos</span>	<span class="VarId">T</span>
<span class="VarId">large_chaos</span>	<span class="VarId">U</span>
<span class="VarId">raise_dead</span>	<span class="VarId">V</span>
<span class="VarId">horse</span>	<span class="VarId">a</span>
<span class="VarId">king_cobra</span>	<span class="VarId">b</span>
<span class="VarId">eagle</span>	<span class="VarId">c</span>
<span class="VarId">elf</span>	<span class="VarId">d</span>
<span class="VarId">unicorn</span>	<span class="VarId">e</span>
<span class="VarId">gryphon</span>	<span class="VarId">f</span>
<span class="VarId">lion</span>	<span class="VarId">g</span>
<span class="VarId">pegasus</span>	<span class="VarId">h</span>
<span class="VarId">giant</span>	<span class="VarId">i</span>
<span class="VarId">golden_dragon</span>	<span class="VarId">j</span>
<span class="VarId">giant_rat</span>	<span class="VarId">k</span>
<span class="VarId">gorilla</span>	<span class="VarId">l</span>
<span class="VarId">goblin</span>	<span class="VarId">m</span>
<span class="VarId">orc</span>	<span class="VarId">o</span>
<span class="VarId">zombie</span>	<span class="VarId">p</span>
<span class="VarId">faun</span>	<span class="VarId">q</span>
<span class="VarId">ogre</span>	<span class="VarId">r</span>
<span class="VarId">skeleton</span>	<span class="VarId">s</span>
<span class="VarId">harpy</span>	<span class="VarId">t</span>
<span class="VarId">spectre</span>	<span class="VarId">u</span>
<span class="VarId">ghost</span>	<span class="VarId">v</span>
<span class="VarId">hydra</span>	<span class="VarId">w</span>
<span class="VarId">manticore</span>	<span class="VarId">x</span>
<span class="VarId">wraith</span>	<span class="VarId">z</span>
<span class="VarId">vampire</span>	<span class="VarId">W</span>
<span class="VarId">green_dragon</span>	<span class="VarId">X</span>
<span class="VarId">red_dragon</span>	<span class="VarId">Z</span>
\<span class="Symbol">.</span>

<span class="Comment">/*</span>
<span class="Comment">== stuff</span>
<span class="Comment">*/</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="VarId">magic_knife</span>	<span class="Number">1</span>
<span class="VarId">magic_shield</span>	<span class="Number">2</span>
<span class="VarId">magic_armour</span>	<span class="Number">3</span>
<span class="VarId">magic_bow</span>	<span class="Number">4</span>
<span class="VarId">magic_sword</span>	<span class="Number">5</span>
<span class="VarId">shadow_form</span>	<span class="Number">6</span>
<span class="VarId">magic_wings</span>	<span class="Number">7</span>
<span class="VarId">decree</span>	<span class="VarId">A</span>
<span class="VarId">justice</span>	<span class="VarId">B</span>
<span class="VarId">lightning</span>	<span class="VarId">C</span>
<span class="VarId">magic_bolt</span>	<span class="VarId">D</span>
<span class="VarId">vengeance</span>	<span class="VarId">E</span>
<span class="VarId">dark_power</span>	<span class="VarId">F</span>
<span class="VarId">magic_wood</span>	<span class="VarId">G</span>
<span class="VarId">magic_castle</span>	<span class="VarId">H</span>
<span class="VarId">wall</span>	<span class="VarId">I</span>
<span class="VarId">gooey_blob</span>	<span class="VarId">J</span>
<span class="VarId">magic_fire</span>	<span class="VarId">K</span>
<span class="VarId">dark_citadel</span>	<span class="VarId">L</span>
<span class="VarId">shadow_wood</span>	<span class="VarId">M</span>
<span class="VarId">law</span>	<span class="VarId">O</span>
<span class="VarId">large_law</span>	<span class="VarId">P</span>
<span class="VarId">disbelieve</span>	<span class="VarId">Q</span>
<span class="VarId">subversion</span>	<span class="VarId">R</span>
<span class="VarId">turmoil</span>	<span class="VarId">S</span>
<span class="VarId">chaos</span>	<span class="VarId">T</span>
<span class="VarId">large_chaos</span>	<span class="VarId">U</span>
<span class="VarId">raise_dead</span>	<span class="VarId">V</span>
<span class="VarId">horse</span>	<span class="VarId">a</span>
<span class="VarId">king_cobra</span>	<span class="VarId">b</span>
<span class="VarId">eagle</span>	<span class="VarId">c</span>
<span class="VarId">elf</span>	<span class="VarId">d</span>
<span class="VarId">unicorn</span>	<span class="VarId">e</span>
<span class="VarId">gryphon</span>	<span class="VarId">f</span>
<span class="VarId">lion</span>	<span class="VarId">g</span>
<span class="VarId">pegasus</span>	<span class="VarId">h</span>
<span class="VarId">giant</span>	<span class="VarId">i</span>
<span class="VarId">golden_dragon</span>	<span class="VarId">j</span>
<span class="VarId">giant_rat</span>	<span class="VarId">k</span>
<span class="VarId">gorilla</span>	<span class="VarId">l</span>
<span class="VarId">goblin</span>	<span class="VarId">m</span>
<span class="VarId">orc</span>	<span class="VarId">o</span>
<span class="VarId">zombie</span>	<span class="VarId">p</span>
<span class="VarId">faun</span>	<span class="VarId">q</span>
<span class="VarId">ogre</span>	<span class="VarId">r</span>
<span class="VarId">skeleton</span>	<span class="VarId">s</span>
<span class="VarId">harpy</span>	<span class="VarId">t</span>
<span class="VarId">spectre</span>	<span class="VarId">u</span>
<span class="VarId">ghost</span>	<span class="VarId">v</span>
<span class="VarId">hydra</span>	<span class="VarId">w</span>
<span class="VarId">manticore</span>	<span class="VarId">x</span>
<span class="VarId">wraith</span>	<span class="VarId">z</span>
<span class="VarId">vampire</span>	<span class="VarId">W</span>
<span class="VarId">green_dragon</span>	<span class="VarId">X</span>
<span class="VarId">red_dragon</span>	<span class="VarId">Z</span>
\<span class="Symbol">.</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateView &quot;spell_book_table&quot; [(&quot;spell_category&quot;,DomainType &quot;spell_category&quot;),(&quot;spell_name&quot;,ScalarType &quot;text&quot;),(&quot;chance&quot;,ScalarType &quot;int4&quot;),(&quot;alignment&quot;,ScalarType &quot;int4&quot;),(&quot;alignment_string&quot;,ScalarType &quot;text&quot;),(&quot;alignment_order&quot;,ScalarType &quot;int4&quot;),(&quot;base_chance&quot;,ScalarType &quot;int4&quot;),(&quot;count_icons&quot;,ScalarType &quot;text&quot;),(&quot;align_icons&quot;,ScalarType &quot;text&quot;),(&quot;colour&quot;,ScalarType &quot;text&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">spell_book_table</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">spell_category</span><span class="Symbol">,</span> <span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="VarId">count</span><span class="Symbol">,</span>
    <span class="VarId">spell_cast_chance</span><span class="Symbol">(</span><span class="VarId">spell_name</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">chance</span><span class="Symbol">,</span>
    <span class="VarId">alignment</span><span class="Symbol">,</span> <span class="VarId">format_alignment</span><span class="Symbol">(</span><span class="VarId">alignment</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">alignment_string</span><span class="Symbol">,</span>
    <span class="Keyword">key</span><span class="Symbol">,</span> <span class="VarId">sprite</span><span class="Symbol">,</span> <span class="VarId">section_order</span><span class="Symbol">,</span> <span class="VarId">alignment_order</span><span class="Symbol">,</span> <span class="VarId">base_chance</span><span class="Symbol">,</span>
    <span class="VarId">count_icons</span><span class="Symbol">(</span><span class="VarId">count</span><span class="Symbol">::</span><span class="Type">int</span><span class="Symbol">),</span> <span class="VarId">align_icons</span><span class="Symbol">(</span><span class="VarId">alignment</span><span class="Symbol">::</span><span class="Type">int</span><span class="Symbol">),</span>
    <span class="VarId">spell_colour</span><span class="Symbol">(</span><span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="VarId">count</span><span class="Symbol">::</span><span class="Type">int</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">colour</span>
  <span class="Keyword">from</span> <span class="VarId">spells_with_order</span>
  <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">current_wizard_spell_counts</span>
  <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">spell_keys</span>
  <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">spell_sprites</span>
  <span class="Keyword">cross</span> <span class="Keyword">join</span> <span class="VarId">spell_book_show_all_table</span>
  <span class="Keyword">where</span> <span class="Keyword">not</span> <span class="Symbol">(</span><span class="VarId">spell_book_show_all</span> <span class="Symbol">=</span> <span class="VarId">false</span> <span class="Keyword">and</span> <span class="VarId">count</span> <span class="Symbol">=</span> <span class="Number">0</span><span class="Symbol">);</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'spell_book_table'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Comment">/*[CatCreateView &quot;spell_details&quot; [(&quot;spell_name&quot;,ScalarType &quot;text&quot;),(&quot;base_chance&quot;,ScalarType &quot;int4&quot;),(&quot;alignment&quot;,ScalarType &quot;int4&quot;),(&quot;spell_category&quot;,DomainType &quot;spell_category&quot;),(&quot;description&quot;,ScalarType &quot;text&quot;),(&quot;range&quot;,ScalarType &quot;int4&quot;),(&quot;numb&quot;,ScalarType &quot;int4&quot;),(&quot;valid_square_category&quot;,DomainType &quot;spell_square_category&quot;),(&quot;ptype&quot;,ScalarType &quot;text&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">spell_details</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="Symbol">*</span> <span class="Keyword">from</span> <span class="VarId">spells_mr</span>
  <span class="Keyword">full</span> <span class="Keyword">outer</span> <span class="Keyword">join</span> <span class="VarId">spell_sprites</span> <span class="Keyword">using</span> <span class="Symbol">(</span><span class="VarId">spell_name</span><span class="Symbol">)</span>
  <span class="Keyword">full</span> <span class="Keyword">outer</span> <span class="Keyword">join</span> <span class="Symbol">(</span>
    <span class="Keyword">select</span> <span class="Comment">/*spell_category,*/</span> <span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="VarId">count</span><span class="Symbol">,</span> <span class="VarId">chance</span><span class="Symbol">,</span>
    <span class="Comment">/*alignment,*/</span> <span class="VarId">alignment_string</span><span class="Symbol">,</span>
    <span class="Keyword">key</span><span class="Symbol">,</span> <span class="Comment">/*sprite,*/</span> <span class="VarId">section_order</span><span class="Symbol">,</span> <span class="VarId">alignment_order</span><span class="Symbol">,</span> <span class="Comment">/*base_chance,*/</span>
    <span class="VarId">count_icons</span><span class="Symbol">,</span> <span class="VarId">align_icons</span><span class="Symbol">,</span>
    <span class="VarId">colour</span>
    <span class="Keyword">from</span> <span class="VarId">spell_book_table</span>
    <span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">balls</span> <span class="Keyword">using</span> <span class="Symbol">(</span><span class="VarId">spell_name</span><span class="Symbol">);</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'spell_details'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">current_wizard_selected_spell_details</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">spell_name</span><span class="Symbol">,</span> <span class="VarId">spell_category</span><span class="Symbol">,</span> <span class="VarId">sprite</span><span class="Symbol">,</span> <span class="VarId">base_chance</span><span class="Symbol">,</span> <span class="VarId">description</span><span class="Symbol">,</span>
    <span class="VarId">numb</span><span class="Symbol">,</span> <span class="Keyword">range</span><span class="Symbol">,</span> <span class="VarId">count</span><span class="Symbol">,</span> <span class="VarId">chance</span><span class="Symbol">,</span> <span class="VarId">alignment_string</span>
  <span class="Keyword">from</span> <span class="VarId">spell_details</span>
  <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">wizard_spell_choices</span></pre></div><div class='SqlPostgresql'><div class='GeneratedSql'><pre class="sourceCode"><span class="Comment">-- generated sql ------------------------</span>
<span class="Comment">/*[CatCreateView &quot;current_wizard_selected_spell_details&quot; [(&quot;spell_name&quot;,ScalarType &quot;text&quot;),(&quot;spell_category&quot;,DomainType &quot;spell_category&quot;),(&quot;base_chance&quot;,ScalarType &quot;int4&quot;),(&quot;description&quot;,ScalarType &quot;text&quot;),(&quot;numb&quot;,ScalarType &quot;int4&quot;),(&quot;range&quot;,ScalarType &quot;int4&quot;)]]*/</span>
<span class="Keyword">create</span> <span class="Keyword">view</span> <span class="VarId">current_wizard_selected_spell_details</span> <span class="VarId">as</span>
  <span class="Keyword">select</span> <span class="VarId">spell_name</span><span class="Symbol">,</span><span class="VarId">spell_category</span><span class="Symbol">,</span><span class="VarId">sprite</span><span class="Symbol">,</span><span class="VarId">base_chance</span><span class="Symbol">,</span><span class="VarId">description</span><span class="Symbol">,</span><span class="VarId">numb</span><span class="Symbol">,</span><span class="Keyword">range</span><span class="Symbol">,</span><span class="VarId">count</span><span class="Symbol">,</span><span class="VarId">chance</span><span class="Symbol">,</span><span class="VarId">alignment_string</span>
    <span class="Keyword">from</span> <span class="Symbol">((</span><span class="VarId">spell_details</span>
           <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">wizard_spell_choices</span><span class="Symbol">)</span>
          <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">current_wizard_table</span> <span class="Keyword">on</span> <span class="Symbol">(</span><span class="VarId">wizard_name</span> <span class="Symbol">=</span> <span class="VarId">current_wizard</span><span class="Symbol">));</span>

<span class="Comment">/*([],[])*/</span>
<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">all_module_objects</span> <span class="Symbol">(</span><span class="VarId">object_name</span><span class="Symbol">,</span><span class="VarId">object_type</span><span class="Symbol">,</span><span class="VarId">module_name</span><span class="Symbol">)</span>
<span class="VarId">values</span>
  <span class="Symbol">(</span><span class="Char">'current_wizard_selected_spell_details'</span><span class="Symbol">,</span><span class="Char">'view'</span><span class="Symbol">,</span><span class="Char">'Chaos.Client.SpellBookWidget'</span><span class="Symbol">)</span>
<span class="Symbol">;</span></pre></div></div><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/31/11 20:00:52, hssqlppp-0.3.0</div
    ></body
  ></html
>
