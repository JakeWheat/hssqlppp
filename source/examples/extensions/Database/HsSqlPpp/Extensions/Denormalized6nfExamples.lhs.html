<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >Denormalized6nfExamples</title
    ><link href="../../../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../../../index.txt.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">{-# LANGUAGE QuasiQuotes, ScopedTypeVariables #-}</span>
<span class="Keyword">module</span> <span class="ConId">Database.HsSqlPpp.Extensions.Denormalized6nfExamples</span>
    <span class="Symbol">(</span><span class="VarId">denormalized6nfExamples</span><span class="Symbol">)</span> <span class="Keyword">where</span>

<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Ast</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Extensions.ExtensionsUtils</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.SqlQuote</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Extensions.Denormalized6nf</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Annotation</span>

<span class="Function">denormalized6nfExamples</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">ExtensionTest</span><span class="Symbol">]</span>
<span class="Function">denormalized6nfExamples</span>  <span class="Symbol">=</span> <span class="Symbol">[</span><span class="VarId">denormalized6nfExample1</span>
                           <span class="Symbol">,</span><span class="VarId">denormalized6nfExample2</span>
                           <span class="Symbol">,</span><span class="VarId">denormalized6nfExample3</span>
                           <span class="Symbol">,</span><span class="VarId">denormalized6nfExample4</span>
                           <span class="Symbol">,</span><span class="VarId">denormalized6nfExample5</span>
                           <span class="Symbol">,</span><span class="VarId">denormalized6nfExample6</span>
                           <span class="Symbol">,</span><span class="VarId">denormalized6nfExample7</span>
                           <span class="Symbol">]</span></pre></div></div></div><p
    >simple example with one 'subclass'</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">denormalized6nfExample1</span> <span class="Symbol">::</span> <span class="ConId">ExtensionTest</span>
<span class="Function">denormalized6nfExample1</span> <span class="Symbol">=</span>
  <span class="ConId">ExtensionTest</span>
    <span class="String">&quot;denormalized6nfExample1&quot;</span>
    <span class="VarId">denormalized6nf</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">select</span> <span class="VarId">create6nf</span><span class="Symbol">($$</span>
        <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span><span class="Symbol">,</span>
          <span class="VarId">ptype2</span> <span class="VarId">text</span>
        <span class="Symbol">);</span>
        <span class="VarId">creatures</span> <span class="Symbol">:</span> <span class="VarId">piece</span> <span class="Symbol">(</span>
          <span class="VarId">speed</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">agility</span> <span class="VarId">int</span>
        <span class="Symbol">);</span>
      <span class="Symbol">$$);</span>
     <span class="Symbol">|]</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">create</span> <span class="VarId">table</span> <span class="VarId">pieces</span> <span class="Symbol">(</span>
        <span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
       <span class="Symbol">,</span><span class="VarId">ptype2</span> <span class="VarId">text</span> <span class="VarId">not</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">speed</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">agility</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">creatures_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
                 <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">))</span>
      <span class="Symbol">);</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">pieces_base</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span> <span class="VarId">ptype2</span> <span class="VarId">from</span> <span class="VarId">pieces</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">creatures</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">ptype2</span><span class="Symbol">,</span><span class="VarId">speed</span><span class="Symbol">,</span><span class="VarId">agility</span> <span class="VarId">from</span> <span class="VarId">pieces</span>
               <span class="Keyword">where</span> <span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
     <span class="Symbol">|]</span></pre></div></div></div><p
    >two unconnected 'subclasses'</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">denormalized6nfExample2</span> <span class="Symbol">::</span> <span class="ConId">ExtensionTest</span>
<span class="Function">denormalized6nfExample2</span> <span class="Symbol">=</span>
  <span class="ConId">ExtensionTest</span>
    <span class="String">&quot;denormalized6nfExample2&quot;</span>
    <span class="VarId">denormalized6nf</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">select</span> <span class="VarId">create6nf</span> <span class="Symbol">($$</span>
        <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
        <span class="Symbol">);</span>
        <span class="VarId">creatures</span> <span class="Symbol">:</span> <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">speed</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">agility</span> <span class="VarId">int</span>
        <span class="Symbol">);</span>
        <span class="VarId">attackers</span> <span class="Symbol">:</span> <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">attack_strength</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">attack_style</span> <span class="VarId">text</span>
        <span class="Symbol">);</span>
        <span class="Comment">-- this provides a name for the view, which we don't generate otherwise</span>
        <span class="VarId">attacking_creatures</span> <span class="Symbol">:</span> <span class="VarId">creatures</span><span class="Symbol">,</span><span class="VarId">attackers</span><span class="Symbol">;</span>
      <span class="Symbol">$$);</span>
     <span class="Symbol">|]</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">create</span> <span class="VarId">table</span> <span class="VarId">pieces</span>
       <span class="Symbol">(</span><span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
       <span class="Symbol">,</span><span class="VarId">speed</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">agility</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">attack_strength</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">attack_style</span> <span class="VarId">text</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">creatures_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
                 <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">))</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">attackers_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">attack_style</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
                 <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">attack_style</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">))</span>
       <span class="Symbol">);</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">pieces_base</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">creatures</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">speed</span><span class="Symbol">,</span><span class="VarId">agility</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">attackers</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">attack_strength</span><span class="Symbol">,</span><span class="VarId">attack_style</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">attacking_creatures</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">speed</span><span class="Symbol">,</span><span class="VarId">agility</span><span class="Symbol">,</span><span class="VarId">attack_strength</span><span class="Symbol">,</span><span class="VarId">attack_style</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span>
                <span class="VarId">and</span> <span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
     <span class="Symbol">|]</span></pre></div></div></div><p
    >one field only check</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">denormalized6nfExample3</span> <span class="Symbol">::</span> <span class="ConId">ExtensionTest</span>
<span class="Function">denormalized6nfExample3</span> <span class="Symbol">=</span>
  <span class="ConId">ExtensionTest</span>
    <span class="String">&quot;denormalized6nfExample3&quot;</span>
    <span class="VarId">denormalized6nf</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">select</span> <span class="VarId">create6nf</span> <span class="Symbol">($$</span>
        <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
        <span class="Symbol">);</span>
        <span class="VarId">creatures</span> <span class="Symbol">:</span> <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">speed</span> <span class="VarId">int</span>
        <span class="Symbol">);</span>
      <span class="Symbol">$$);</span>
     <span class="Symbol">|]</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">create</span> <span class="VarId">table</span> <span class="VarId">pieces</span>
       <span class="Symbol">(</span><span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
       <span class="Symbol">,</span><span class="VarId">speed</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">);</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">pieces_base</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span> <span class="VarId">from</span> <span class="VarId">pieces</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">creatures</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">speed</span> <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
     <span class="Symbol">|]</span></pre></div></div></div><p
    >no combo view check</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">denormalized6nfExample4</span> <span class="Symbol">::</span> <span class="ConId">ExtensionTest</span>
<span class="Function">denormalized6nfExample4</span> <span class="Symbol">=</span>
  <span class="ConId">ExtensionTest</span>
    <span class="String">&quot;denormalized6nfExample4&quot;</span>
    <span class="VarId">denormalized6nf</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">select</span> <span class="VarId">create6nf</span> <span class="Symbol">($$</span>
        <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
        <span class="Symbol">);</span>
        <span class="VarId">creatures</span> <span class="Symbol">:</span> <span class="VarId">pieces</span>  <span class="Symbol">(</span>
          <span class="VarId">speed</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">agility</span> <span class="VarId">int</span>
        <span class="Symbol">);</span>
        <span class="VarId">attackers</span> <span class="Symbol">:</span> <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">attack_strength</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">attack_style</span> <span class="VarId">text</span>
        <span class="Symbol">);</span>
      <span class="Symbol">$$);</span>
     <span class="Symbol">|]</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">create</span> <span class="VarId">table</span> <span class="VarId">pieces</span>
       <span class="Symbol">(</span><span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
       <span class="Symbol">,</span><span class="VarId">speed</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">agility</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">attack_strength</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">attack_style</span> <span class="VarId">text</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">creatures_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
                 <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">))</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">attackers_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">attack_style</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
                 <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">attack_style</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">))</span>
       <span class="Symbol">);</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">pieces_base</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">creatures</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">speed</span><span class="Symbol">,</span><span class="VarId">agility</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">attackers</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">attack_strength</span><span class="Symbol">,</span><span class="VarId">attack_style</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
     <span class="Symbol">|]</span></pre></div></div></div><p
    >two chained 'subclasses'</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">denormalized6nfExample5</span> <span class="Symbol">::</span> <span class="ConId">ExtensionTest</span>
<span class="Function">denormalized6nfExample5</span> <span class="Symbol">=</span>
  <span class="ConId">ExtensionTest</span>
    <span class="String">&quot;denormalized6nfExample5&quot;</span>
    <span class="VarId">denormalized6nf</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">select</span> <span class="VarId">create6nf</span> <span class="Symbol">($$</span>
        <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
        <span class="Symbol">);</span>
        <span class="VarId">creatures</span> <span class="Symbol">:</span> <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">speed</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">agility</span> <span class="VarId">int</span>
        <span class="Symbol">);</span>
        <span class="VarId">attackers</span> <span class="Symbol">:</span> <span class="VarId">creatures</span> <span class="Symbol">(</span>
          <span class="VarId">attack_strength</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">attack_style</span> <span class="VarId">text</span>
        <span class="Symbol">);</span>
      <span class="Symbol">$$);</span>
     <span class="Symbol">|]</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">create</span> <span class="VarId">table</span> <span class="VarId">pieces</span>
       <span class="Symbol">(</span><span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
       <span class="Symbol">,</span><span class="VarId">speed</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">agility</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">attack_strength</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">attack_style</span> <span class="VarId">text</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">creatures_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
                 <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">))</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">attackers_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">attack_style</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
                 <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="Symbol">(</span><span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span>
                     <span class="VarId">and</span> <span class="Symbol">(</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="Symbol">(</span><span class="VarId">attack_style</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">)))))</span>
       <span class="Symbol">);</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">pieces_base</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">creatures</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">speed</span><span class="Symbol">,</span><span class="VarId">agility</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">attackers</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">speed</span><span class="Symbol">,</span><span class="VarId">agility</span><span class="Symbol">,</span>
               <span class="VarId">attack_strength</span><span class="Symbol">,</span><span class="VarId">attack_style</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span>
                <span class="VarId">and</span> <span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
     <span class="Symbol">|]</span></pre></div></div></div><p
    >diamond inheritance</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">denormalized6nfExample6</span> <span class="Symbol">::</span> <span class="ConId">ExtensionTest</span>
<span class="Function">denormalized6nfExample6</span> <span class="Symbol">=</span>
  <span class="ConId">ExtensionTest</span>
    <span class="String">&quot;denormalized6nfExample6&quot;</span>
    <span class="VarId">denormalized6nf</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">select</span> <span class="VarId">create6nf</span> <span class="Symbol">($$</span>
        <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
        <span class="Symbol">);</span>
        <span class="VarId">creatures</span> <span class="Symbol">:</span> <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">speed</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">agility</span> <span class="VarId">int</span>
        <span class="Symbol">);</span>
        <span class="VarId">attackers</span> <span class="Symbol">:</span> <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">attack_strength</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">attack_style</span> <span class="VarId">text</span>
        <span class="Symbol">);</span>
        <span class="VarId">monsters</span> <span class="Symbol">:</span> <span class="VarId">creatures</span><span class="Symbol">,</span> <span class="VarId">attackers</span> <span class="Symbol">(</span>
          <span class="VarId">resistance</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">armour</span> <span class="VarId">int</span>
        <span class="Symbol">);</span>
      <span class="Symbol">$$);</span>
     <span class="Symbol">|]</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">create</span> <span class="VarId">table</span> <span class="VarId">pieces</span>
       <span class="Symbol">(</span><span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
       <span class="Symbol">,</span><span class="VarId">speed</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">agility</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">attack_strength</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">attack_style</span> <span class="VarId">text</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">resistance</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">armour</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">creatures_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
              <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">))</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">attackers_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">attack_style</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
              <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">attack_style</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">))</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">monsters_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">resistance</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">armour</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
              <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="Symbol">(</span><span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span>
                  <span class="VarId">and</span> <span class="Symbol">(</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="Symbol">(</span><span class="VarId">attack_style</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span>
                  <span class="VarId">and</span> <span class="Symbol">(</span><span class="VarId">resistance</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">armour</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">))))))</span>
       <span class="Symbol">);</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">pieces_base</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">creatures</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">speed</span><span class="Symbol">,</span><span class="VarId">agility</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">attackers</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">attack_strength</span><span class="Symbol">,</span><span class="VarId">attack_style</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">monsters</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">speed</span><span class="Symbol">,</span><span class="VarId">agility</span><span class="Symbol">,</span><span class="VarId">attack_strength</span><span class="Symbol">,</span><span class="VarId">attack_style</span><span class="Symbol">,</span>
               <span class="VarId">resistance</span><span class="Symbol">,</span><span class="VarId">armour</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span>
                <span class="VarId">and</span> <span class="Symbol">(</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span>
                <span class="VarId">and</span> <span class="VarId">resistance</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">);</span>
     <span class="Symbol">|]</span></pre></div></div></div><p
    >fdk</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">denormalized6nfExample7</span> <span class="Symbol">::</span> <span class="ConId">ExtensionTest</span>
<span class="Function">denormalized6nfExample7</span> <span class="Symbol">=</span>
  <span class="ConId">ExtensionTest</span>
    <span class="String">&quot;denormalized6nfExample7&quot;</span>
    <span class="VarId">denormalized6nf</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">select</span> <span class="VarId">create6nf</span> <span class="Symbol">($$</span>
        <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
        <span class="Symbol">);</span>
        <span class="VarId">creatures</span> <span class="Symbol">:</span> <span class="VarId">pieces</span> <span class="Symbol">(</span>
          <span class="VarId">speed</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">agility</span> <span class="VarId">int</span>
        <span class="Symbol">);</span>
        <span class="VarId">attackers</span> <span class="Symbol">(</span>
          <span class="VarId">attack_strength</span> <span class="VarId">int</span><span class="Symbol">,</span>
          <span class="VarId">attack_style</span> <span class="VarId">text</span>
        <span class="Symbol">);</span>
        <span class="VarId">mutually_exclusive</span><span class="Symbol">(</span><span class="VarId">attackers</span><span class="Symbol">,</span><span class="VarId">creatures</span><span class="Symbol">);</span>
      <span class="Symbol">$$);</span>
     <span class="Symbol">|]</span>
    <span class="Symbol">[$</span><span class="VarId">sqlStmts</span><span class="Symbol">|</span>
      <span class="VarId">create</span> <span class="VarId">table</span> <span class="VarId">pieces</span>
       <span class="Symbol">(</span><span class="VarId">ptype</span> <span class="VarId">text</span> <span class="VarId">primary</span> <span class="VarId">key</span>
       <span class="Symbol">,</span><span class="VarId">speed</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">agility</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">attack_strength</span> <span class="VarId">int</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">attack_style</span> <span class="VarId">text</span> <span class="VarId">null</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">creatures_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
                 <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">agility</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">))</span>
       <span class="Symbol">,</span><span class="VarId">constraint</span> <span class="VarId">attackers_fields</span>
          <span class="VarId">check</span> <span class="Symbol">((</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">attack_style</span> <span class="VarId">is</span> <span class="VarId">null</span><span class="Symbol">)</span>
                 <span class="VarId">or</span> <span class="Symbol">(</span><span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">and</span> <span class="VarId">attack_style</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">))</span>
       <span class="Symbol">/*,</span><span class="VarId">constraint</span> <span class="VarId">me_pieces_attackers</span>
          <span class="Comment">-- doesn't scale to three mutual exclusives</span>
          <span class="VarId">check</span> <span class="Symbol">(</span><span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="Symbol">&lt;&gt;</span> <span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">)*/</span>
       <span class="Symbol">);</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">pieces_base</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">creatures</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">speed</span><span class="Symbol">,</span><span class="VarId">agility</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">speed</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
      <span class="VarId">create</span> <span class="VarId">view</span> <span class="VarId">attackers</span> <span class="Keyword">as</span>
        <span class="VarId">select</span> <span class="VarId">ptype</span><span class="Symbol">,</span><span class="VarId">attack_strength</span><span class="Symbol">,</span><span class="VarId">attack_style</span>
          <span class="VarId">from</span> <span class="VarId">pieces</span>
          <span class="Keyword">where</span> <span class="VarId">attack_strength</span> <span class="VarId">is</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">;</span>
     <span class="Symbol">|]</span></pre></div></div></div><p
    >todo: no base class, distributed key</p
    ><p
    >todo: test diamond with overlapping fields</p
    ><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/29/11 20:06:46, hssqlppp-0.3.0</div
    ></body
  ></html
>
