<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >HsSqlPppUtil</title
    ><link href="../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../index.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><p
    >Command line access to a bunch of utility functions.</p
    ><p
    >run HsSqlPppUtil.lhs -? to get a list of commands and purpose and usage info</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">{-# LANGUAGE DeriveDataTypeable, ScopedTypeVariables,FlexibleContexts #-}</span>

<span class="Keyword">import</span> <span class="ConId">System.Console.CmdArgs</span>
<span class="Keyword">import</span> <span class="ConId">Control.Monad.Error</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">--import Debug.Trace</span>
<span class="Keyword">import</span> <span class="ConId">Data.Maybe</span>
<span class="Keyword">import</span> <span class="ConId">Data.Generics.Uniplate.Data</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">import</span> <span class="Keyword">qualified</span> <span class="ConId">Language.Haskell.Exts</span> <span class="Keyword">as</span> <span class="ConId">Exts</span>

<span class="Keyword">import</span> <span class="Keyword">qualified</span> <span class="ConId">Database.HsSqlPpp.TypeChecker</span> <span class="Keyword">as</span> <span class="ConId">A</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Annotation</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Ast</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.SqlTypes</span>

<span class="Keyword">import</span> <span class="Keyword">qualified</span> <span class="ConId">Database.HsSqlPpp.Parser</span> <span class="Keyword">as</span> <span class="ConId">P</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Parsing.Lexer</span>

<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.PrettyPrinter</span>

<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Utils.DBUtils</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Utils.PPExpr</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Utils.RoundTripTester</span></pre></div></div></div><hr
     /><div id="command-defs"
    ><h1
      >command defs</h1
      ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">data</span> <span class="ConId">HsSqlPppUtil</span> <span class="Symbol">=</span> <span class="ConId">Lex</span> <span class="Symbol">{</span><span class="VarId">files</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]}</span>
                  <span class="Symbol">|</span> <span class="ConId">Parse</span> <span class="Symbol">{</span><span class="VarId">files</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]}</span>
                  <span class="Symbol">|</span> <span class="ConId">ParseExpression</span> <span class="Symbol">{</span><span class="VarId">files</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]}</span>
                  <span class="Symbol">|</span> <span class="ConId">Ppp</span> <span class="Symbol">{</span><span class="VarId">files</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]}</span>
                  <span class="Symbol">|</span> <span class="ConId">Pppp</span> <span class="Symbol">{</span><span class="VarId">files</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]}</span>
                  <span class="Symbol">|</span> <span class="ConId">TypeCheck</span> <span class="Symbol">{</span><span class="VarId">database</span> <span class="Symbol">::</span> <span class="ConId">String</span>
                              <span class="Symbol">,</span><span class="VarId">files</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]}</span>
                  <span class="Symbol">|</span> <span class="ConId">TypeCheckExpression</span> <span class="Symbol">{</span><span class="VarId">database</span> <span class="Symbol">::</span> <span class="ConId">String</span>
                                        <span class="Symbol">,</span><span class="VarId">files</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]}</span>
                  <span class="Symbol">|</span> <span class="ConId">AllAnnotations</span> <span class="Symbol">{</span><span class="VarId">database</span> <span class="Symbol">::</span> <span class="ConId">String</span>
                                   <span class="Symbol">,</span><span class="VarId">files</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]}</span>
                  <span class="Symbol">|</span> <span class="ConId">Rtt</span> <span class="Symbol">{</span><span class="VarId">database</span> <span class="Symbol">::</span> <span class="ConId">String</span>
                        <span class="Symbol">,</span><span class="VarId">files</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]}</span>
                   <span class="Keyword">deriving</span> <span class="Symbol">(</span><span class="ConId">Show</span><span class="Symbol">,</span> <span class="ConId">Data</span><span class="Symbol">,</span> <span class="ConId">Typeable</span><span class="Symbol">)</span></pre></div></div></div><hr
       /><p
      >hacky thing: to run an ast transform on all sql asts in commands, put it in here</p
      ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">astTransformer</span> <span class="Symbol">::</span> <span class="ConId">Data</span> <span class="VarId">a</span> <span class="Symbol">=&gt;</span> <span class="VarId">a</span> <span class="Symbol">-&gt;</span> <span class="VarId">a</span>
<span class="Function">astTransformer</span> <span class="Symbol">=</span> <span class="VarId">id</span></pre></div></div></div><hr
       /></div
    ><div id="lex"
    ><h1
      >Lex</h1
      ><p
      >lex the files given and output the tokens on separate lines, useful for testing and debugging only</p
      ><div id="example"
      ><h2
	>example</h2
	><p
	>test2.sql:</p
	><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">s</span> <span class="Symbol">(</span>
       <span class="VarId">s_no</span> <span class="Type">int</span> <span class="Keyword">primary</span> <span class="Keyword">key</span><span class="Symbol">,</span>
       <span class="VarId">sname</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">status</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">city</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span></pre></div><div class='sh'><pre class="sourceCode">$ examples<span class="Symbol">/</span>util<span class="Symbol">/</span>HsSqlPppUtil lex test2<span class="Symbol">.</span>sql
lexing test2<span class="Symbol">.</span>sql
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">1</span><span class="Symbol">,</span> column <span class="Number">1</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;create&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">1</span><span class="Symbol">,</span> column <span class="Number">8</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;table&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">1</span><span class="Symbol">,</span> column <span class="Number">14</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;s&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">1</span><span class="Symbol">,</span> column <span class="Number">16</span><span class="Symbol">),</span>SymbolTok <span class="String">&quot;(&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">2</span><span class="Symbol">,</span> column <span class="Number">8</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;s_no&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">2</span><span class="Symbol">,</span> column <span class="Number">13</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;int&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">2</span><span class="Symbol">,</span> column <span class="Number">17</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;primary&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">2</span><span class="Symbol">,</span> column <span class="Number">25</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;key&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">2</span><span class="Symbol">,</span> column <span class="Number">28</span><span class="Symbol">),</span>SymbolTok <span class="String">&quot;,&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">3</span><span class="Symbol">,</span> column <span class="Number">8</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;sname&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">3</span><span class="Symbol">,</span> column <span class="Number">14</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">3</span><span class="Symbol">,</span> column <span class="Number">19</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;not&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">3</span><span class="Symbol">,</span> column <span class="Number">23</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;null&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">3</span><span class="Symbol">,</span> column <span class="Number">27</span><span class="Symbol">),</span>SymbolTok <span class="String">&quot;,&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">4</span><span class="Symbol">,</span> column <span class="Number">8</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;status&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">4</span><span class="Symbol">,</span> column <span class="Number">15</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;int&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">4</span><span class="Symbol">,</span> column <span class="Number">19</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;not&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">4</span><span class="Symbol">,</span> column <span class="Number">23</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;null&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">4</span><span class="Symbol">,</span> column <span class="Number">27</span><span class="Symbol">),</span>SymbolTok <span class="String">&quot;,&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">5</span><span class="Symbol">,</span> column <span class="Number">8</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;city&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">5</span><span class="Symbol">,</span> column <span class="Number">13</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">5</span><span class="Symbol">,</span> column <span class="Number">18</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;not&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">5</span><span class="Symbol">,</span> column <span class="Number">22</span><span class="Symbol">),</span>IdStringTok <span class="String">&quot;null&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">6</span><span class="Symbol">,</span> column <span class="Number">1</span><span class="Symbol">),</span>SymbolTok <span class="String">&quot;)&quot;</span><span class="Symbol">)</span>
<span class="Symbol">(</span><span class="String">&quot;test2.sql&quot;</span> <span class="Symbol">(</span>line <span class="Number">6</span><span class="Symbol">,</span> column <span class="Number">2</span><span class="Symbol">),</span>SymbolTok <span class="String">&quot;;&quot;</span><span class="Symbol">)</span></pre></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">lexA</span> <span class="Symbol">=</span> <span class="VarId">mode</span> <span class="ConId">Lex</span> <span class="Symbol">{</span><span class="VarId">files</span> <span class="Symbol">=</span> <span class="VarId">def</span> <span class="Symbol">&amp;=</span> <span class="VarId">typ</span> <span class="String">&quot;FILES&quot;</span> <span class="Symbol">&amp;</span> <span class="VarId">args</span><span class="Symbol">}</span>
       <span class="Symbol">&amp;=</span> <span class="VarId">text</span> <span class="String">&quot;lex the files given and output the tokens on separate lines&quot;</span>

<span class="Function">lexFiles</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">FilePath</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">lexFiles</span> <span class="VarId">fns</span> <span class="Symbol">=</span> <span class="VarId">mapM_</span> <span class="VarId">doF</span> <span class="VarId">fns</span>
  <span class="Keyword">where</span>
    <span class="VarId">doF</span> <span class="VarId">fn</span> <span class="Symbol">=</span> <span class="VarId">runES</span> <span class="Symbol">$</span> <span class="Keyword">do</span>
               <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">putStrLn</span> <span class="Symbol">(</span><span class="String">&quot;lexing &quot;</span> <span class="Symbol">++</span> <span class="VarId">fn</span><span class="Symbol">)</span>
               <span class="VarId">s</span> <span class="Symbol">&lt;-</span> <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">readInput</span> <span class="VarId">fn</span>
               <span class="VarId">tokens</span> <span class="Symbol">&lt;-</span> <span class="VarId">etsr</span> <span class="Symbol">$</span> <span class="VarId">lexSqlText</span> <span class="VarId">fn</span> <span class="VarId">s</span>
               <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">mapM_</span> <span class="Symbol">(</span><span class="VarId">putStrLn</span> <span class="Symbol">.</span> <span class="VarId">show</span><span class="Symbol">)</span> <span class="VarId">tokens</span></pre></div></div></div><hr
	 /></div
      ></div
    ><div id="parse"
    ><h1
      >Parse</h1
      ><p
      >parse some sql and output the ast</p
      ><div id="examples"
      ><h2
	>examples</h2
	><p
	>test2.sql:</p
	><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">s</span> <span class="Symbol">(</span>
       <span class="VarId">s_no</span> <span class="Type">int</span> <span class="Keyword">primary</span> <span class="Keyword">key</span><span class="Symbol">,</span>
       <span class="VarId">sname</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">status</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">city</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span></pre></div><div class='haskell'><pre class="sourceCode"><span class="Symbol">$</span> <span class="ConId">HsSqlPppUtil</span> <span class="VarId">parse</span> <span class="VarId">test2</span><span class="Symbol">.</span><span class="VarId">sql</span>
<span class="Comment">-- ast of test2.sql</span>
<span class="Symbol">[</span><span class="ConId">CreateTable</span> <span class="ConId">Ann</span> <span class="String">&quot;s&quot;</span>
   <span class="Symbol">[</span><span class="ConId">AttributeDef</span> <span class="ConId">Ann</span> <span class="String">&quot;s_no&quot;</span> <span class="Symbol">(</span><span class="ConId">SimpleTypeName</span> <span class="ConId">Ann</span> <span class="String">&quot;int&quot;</span><span class="Symbol">)</span> <span class="ConId">Nothing</span>
      <span class="Symbol">[</span><span class="ConId">RowPrimaryKeyConstraint</span> <span class="ConId">Ann</span> <span class="String">&quot;&quot;</span><span class="Symbol">],</span>
    <span class="ConId">AttributeDef</span> <span class="ConId">Ann</span> <span class="String">&quot;sname&quot;</span> <span class="Symbol">(</span><span class="ConId">SimpleTypeName</span> <span class="ConId">Ann</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span> <span class="ConId">Nothing</span>
      <span class="Symbol">[</span><span class="ConId">NotNullConstraint</span> <span class="ConId">Ann</span> <span class="String">&quot;&quot;</span><span class="Symbol">],</span>
    <span class="ConId">AttributeDef</span> <span class="ConId">Ann</span> <span class="String">&quot;status&quot;</span> <span class="Symbol">(</span><span class="ConId">SimpleTypeName</span> <span class="ConId">Ann</span> <span class="String">&quot;int&quot;</span><span class="Symbol">)</span> <span class="ConId">Nothing</span>
      <span class="Symbol">[</span><span class="ConId">NotNullConstraint</span> <span class="ConId">Ann</span> <span class="String">&quot;&quot;</span><span class="Symbol">],</span>
    <span class="ConId">AttributeDef</span> <span class="ConId">Ann</span> <span class="String">&quot;city&quot;</span> <span class="Symbol">(</span><span class="ConId">SimpleTypeName</span> <span class="ConId">Ann</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span> <span class="ConId">Nothing</span>
      <span class="Symbol">[</span><span class="ConId">NotNullConstraint</span> <span class="ConId">Ann</span> <span class="String">&quot;&quot;</span><span class="Symbol">]]</span>
   <span class="Symbol">[]]</span></pre></div><p
	>test3.sql:</p
	><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">select</span> <span class="Symbol">*</span> <span class="Keyword">from</span> <span class="VarId">s</span> <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">p</span> <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">sp</span><span class="Symbol">;</span></pre></div><div class='haskell'><pre class="sourceCode"><span class="Symbol">$</span> <span class="ConId">HsSqlPppUtil</span> <span class="VarId">parse</span> <span class="VarId">test3</span><span class="Symbol">.</span><span class="VarId">sql</span>
<span class="Comment">-- ast of test3.sql</span>
<span class="Symbol">[</span><span class="ConId">SelectStatement</span> <span class="ConId">Ann</span>
   <span class="Symbol">(</span><span class="ConId">Select</span> <span class="ConId">Ann</span> <span class="ConId">Dupes</span>
      <span class="Symbol">(</span><span class="ConId">SelectList</span> <span class="ConId">Ann</span> <span class="Symbol">[</span><span class="ConId">SelExp</span> <span class="ConId">Ann</span> <span class="Symbol">(</span><span class="ConId">Identifier</span> <span class="ConId">Ann</span> <span class="String">&quot;*&quot;</span><span class="Symbol">)]</span> <span class="Symbol">[])</span>
      <span class="Symbol">[</span><span class="ConId">JoinedTref</span> <span class="ConId">Ann</span>
         <span class="Symbol">(</span><span class="ConId">JoinedTref</span> <span class="ConId">Ann</span> <span class="Symbol">(</span><span class="ConId">Tref</span> <span class="ConId">Ann</span> <span class="Symbol">(</span><span class="ConId">Identifier</span> <span class="ConId">Ann</span> <span class="String">&quot;s&quot;</span><span class="Symbol">)</span> <span class="ConId">NoAlias</span><span class="Symbol">)</span> <span class="ConId">Natural</span>
            <span class="ConId">Inner</span>
            <span class="Symbol">(</span><span class="ConId">Tref</span> <span class="ConId">Ann</span> <span class="Symbol">(</span><span class="ConId">Identifier</span> <span class="ConId">Ann</span> <span class="String">&quot;p&quot;</span><span class="Symbol">)</span> <span class="ConId">NoAlias</span><span class="Symbol">)</span>
            <span class="ConId">Nothing</span>
            <span class="ConId">NoAlias</span><span class="Symbol">)</span>
         <span class="ConId">Natural</span>
         <span class="ConId">Inner</span>
         <span class="Symbol">(</span><span class="ConId">Tref</span> <span class="ConId">Ann</span> <span class="Symbol">(</span><span class="ConId">Identifier</span> <span class="ConId">Ann</span> <span class="String">&quot;sp&quot;</span><span class="Symbol">)</span> <span class="ConId">NoAlias</span><span class="Symbol">)</span>
         <span class="ConId">Nothing</span>
         <span class="ConId">NoAlias</span><span class="Symbol">]</span>
      <span class="ConId">Nothing</span>
      <span class="Symbol">[]</span>
      <span class="ConId">Nothing</span>
      <span class="Symbol">[]</span>
      <span class="ConId">Nothing</span>
      <span class="ConId">Nothing</span><span class="Symbol">)]</span></pre></div><p
	>test3a.sql</p
	><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">select</span> <span class="Symbol">*</span> <span class="Keyword">from</span> <span class="VarId">s</span> <span class="Keyword">natural</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">p</span> <span class="Keyword">natural</span> <span class="VarId">inners</span> <span class="Keyword">join</span> <span class="VarId">sp</span><span class="Symbol">;</span></pre></div><div class='haskell'><pre class="sourceCode"><span class="Symbol">$</span> <span class="Symbol">./</span><span class="ConId">HsSqlPppUtil</span> <span class="VarId">parse</span> <span class="VarId">test3a</span><span class="Symbol">.</span><span class="VarId">sql</span>
<span class="Comment">-- ast of test3a.sql</span>
<span class="String">&quot;test3a.sql&quot;</span> <span class="Symbol">(</span><span class="VarId">line</span> <span class="Number">1</span><span class="Symbol">,</span> <span class="VarId">column</span> <span class="Number">46</span><span class="Symbol">):</span>
<span class="Function">unexpected</span> <span class="ConId">IdStringTok</span> <span class="String">&quot;inners&quot;</span>
<span class="Function">test3a</span><span class="Symbol">.</span><span class="VarId">sql</span><span class="Symbol">:</span><span class="Number">1</span><span class="Symbol">:</span><span class="Number">46</span><span class="Symbol">:</span>

<span class="ConId">Context</span><span class="Symbol">:</span>
<span class="Function">select</span> <span class="Symbol">*</span> <span class="VarId">from</span> <span class="VarId">s</span> <span class="VarId">natural</span> <span class="VarId">inner</span> <span class="VarId">join</span> <span class="VarId">p</span> <span class="VarId">natural</span> <span class="VarId">inners</span> <span class="VarId">join</span> <span class="VarId">sp</span><span class="Symbol">;</span>
                                             <span class="Symbol">^</span>
<span class="ConId">ERROR</span> <span class="ConId">HERE</span>
</pre></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">parseA</span> <span class="Symbol">=</span> <span class="VarId">mode</span> <span class="Symbol">$</span> <span class="ConId">Parse</span> <span class="Symbol">{</span><span class="VarId">files</span> <span class="Symbol">=</span> <span class="VarId">def</span> <span class="Symbol">&amp;=</span> <span class="VarId">typ</span> <span class="String">&quot;FILES&quot;</span> <span class="Symbol">&amp;</span> <span class="VarId">args</span><span class="Symbol">}</span>
         <span class="Symbol">&amp;=</span> <span class="VarId">text</span> <span class="String">&quot;Parse files and output the asts&quot;</span>

<span class="Function">showAst</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">showAst</span> <span class="Symbol">=</span>
  <span class="VarId">mapM_</span> <span class="VarId">sa</span>
  <span class="Keyword">where</span>
    <span class="VarId">sa</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
    <span class="VarId">sa</span> <span class="VarId">fn</span> <span class="Symbol">=</span> <span class="VarId">runES</span> <span class="Symbol">$</span> <span class="Keyword">do</span>
              <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">putStrLn</span> <span class="Symbol">(</span><span class="String">&quot;-- ast of &quot;</span> <span class="Symbol">++</span> <span class="VarId">fn</span><span class="Symbol">)</span>
              <span class="VarId">s</span> <span class="Symbol">&lt;-</span> <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">readInput</span> <span class="VarId">fn</span>
              <span class="VarId">ast</span> <span class="Symbol">&lt;-</span> <span class="VarId">etsr</span> <span class="Symbol">$</span> <span class="ConId">P.</span><span class="VarId">parseSql</span> <span class="VarId">fn</span> <span class="VarId">s</span>
              <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">putStrLn</span> <span class="Symbol">$</span> <span class="VarId">ppExprNoAnns</span> <span class="Symbol">$</span> <span class="VarId">astTransformer</span> <span class="VarId">ast</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">ppExprNoAnns</span> <span class="Symbol">::</span> <span class="ConId">Show</span> <span class="VarId">a</span> <span class="Symbol">=&gt;</span> <span class="VarId">a</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span>
<span class="Function">ppExprNoAnns</span> <span class="Symbol">=</span> <span class="VarId">ppExprT</span> <span class="VarId">stripA</span>
  <span class="Keyword">where</span>
    <span class="VarId">stripA</span> <span class="Symbol">::</span> <span class="ConId">Exts.Exp</span> <span class="Symbol">-&gt;</span> <span class="ConId">Exts.Exp</span>
    <span class="VarId">stripA</span> <span class="Symbol">=</span> <span class="VarId">transformBi</span> <span class="Symbol">$</span> <span class="Symbol">\</span><span class="VarId">x</span> <span class="Symbol">-&gt;</span>
               <span class="Keyword">case</span> <span class="VarId">x</span> <span class="Keyword">of</span>
                 <span class="Symbol">(</span><span class="ConId">Exts.Paren</span> <span class="Symbol">(</span><span class="ConId">Exts.RecConstr</span> <span class="Symbol">(</span><span class="ConId">Exts.UnQual</span> <span class="Symbol">(</span><span class="ConId">Exts.Ident</span> <span class="String">&quot;Annotation&quot;</span><span class="Symbol">))</span> <span class="VarId">_</span><span class="Symbol">))</span> <span class="Symbol">-&gt;</span>
                          <span class="ConId">Exts.Con</span> <span class="Symbol">$</span> <span class="ConId">Exts.UnQual</span> <span class="Symbol">$</span> <span class="ConId">Exts.Ident</span> <span class="String">&quot;Ann&quot;</span>
                 <span class="VarId">x1</span> <span class="Symbol">-&gt;</span> <span class="VarId">x1</span></pre></div></div></div><hr
	 /></div
      ></div
    ><div id="parseexpression"
    ><h1
      >ParseExpression</h1
      ><p
      >Parse an expression, useful for trying things out.</p
      ><div id="examples-1"
      ><h2
	>examples</h2
	><div class='haskell'><pre class="sourceCode"><span class="Symbol">$</span> <span class="VarId">echo</span> <span class="String">&quot;test(a,v)&quot;</span> <span class="Symbol">|</span> <span class="ConId">HsSqlPppUtil</span> <span class="VarId">parseexpression</span> <span class="Symbol">-</span>
<span class="Comment">-- ast of -</span>
<span class="ConId">FunCall</span> <span class="ConId">Ann</span> <span class="String">&quot;test&quot;</span> <span class="Symbol">[</span><span class="ConId">Identifier</span> <span class="ConId">Ann</span> <span class="String">&quot;a&quot;</span><span class="Symbol">,</span> <span class="ConId">Identifier</span> <span class="ConId">Ann</span> <span class="String">&quot;v&quot;</span><span class="Symbol">]</span></pre></div><div class='haskell'><pre class="sourceCode"><span class="Symbol">$</span> <span class="VarId">echo</span> <span class="String">&quot;1+1+1&quot;</span> <span class="Symbol">|</span> <span class="ConId">HsSqlPppUtil</span> <span class="VarId">parseexpression</span> <span class="Symbol">-</span>
<span class="Comment">-- ast of -</span>
<span class="ConId">FunCall</span> <span class="ConId">Ann</span> <span class="String">&quot;+&quot;</span>
  <span class="Symbol">[</span><span class="ConId">FunCall</span> <span class="ConId">Ann</span> <span class="String">&quot;+&quot;</span> <span class="Symbol">[</span><span class="ConId">IntegerLit</span> <span class="ConId">Ann</span> <span class="Number">1</span><span class="Symbol">,</span> <span class="ConId">IntegerLit</span> <span class="ConId">Ann</span> <span class="Number">1</span><span class="Symbol">],</span>
   <span class="ConId">IntegerLit</span> <span class="ConId">Ann</span> <span class="Number">1</span><span class="Symbol">]</span></pre></div><div class='haskell'><pre class="sourceCode"><span class="Symbol">$</span> <span class="VarId">echo</span> <span class="String">&quot;case 1 when 2 then 3 else 4 end&quot;</span> <span class="Symbol">|</span> <span class="ConId">HsSqlPppUtil</span> <span class="VarId">parseexpression</span> <span class="Symbol">-</span>
<span class="Comment">-- ast of -</span>
<span class="ConId">CaseSimple</span> <span class="ConId">Ann</span> <span class="Symbol">(</span><span class="ConId">IntegerLit</span> <span class="ConId">Ann</span> <span class="Number">1</span><span class="Symbol">)</span>
  <span class="Symbol">[([</span><span class="ConId">IntegerLit</span> <span class="ConId">Ann</span> <span class="Number">2</span><span class="Symbol">],</span> <span class="ConId">IntegerLit</span> <span class="ConId">Ann</span> <span class="Number">3</span><span class="Symbol">)]</span>
  <span class="Symbol">(</span><span class="ConId">Just</span> <span class="Symbol">(</span><span class="ConId">IntegerLit</span> <span class="ConId">Ann</span> <span class="Number">4</span><span class="Symbol">))</span></pre></div><div class='haskell'><pre class="sourceCode"><span class="Symbol">$</span> <span class="VarId">echo</span> <span class="String">&quot;3 = any (array[1,2])&quot;</span> <span class="Symbol">|</span> <span class="ConId">HsSqlPppUtil</span> <span class="VarId">parseexpression</span> <span class="Symbol">-</span>
<span class="Comment">-- ast of -</span>
<span class="ConId">LiftOperator</span> <span class="ConId">Ann</span> <span class="String">&quot;=&quot;</span> <span class="ConId">LiftAny</span>
  <span class="Symbol">[</span><span class="ConId">IntegerLit</span> <span class="ConId">Ann</span> <span class="Number">3</span><span class="Symbol">,</span>
   <span class="ConId">FunCall</span> <span class="ConId">Ann</span> <span class="String">&quot;!arrayctor&quot;</span> <span class="Symbol">[</span><span class="ConId">IntegerLit</span> <span class="ConId">Ann</span> <span class="Number">1</span><span class="Symbol">,</span> <span class="ConId">IntegerLit</span> <span class="ConId">Ann</span> <span class="Number">2</span><span class="Symbol">]]</span></pre></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">parseExpressionA</span> <span class="Symbol">=</span> <span class="VarId">mode</span> <span class="Symbol">$</span> <span class="ConId">ParseExpression</span> <span class="Symbol">{</span><span class="VarId">files</span> <span class="Symbol">=</span> <span class="VarId">def</span> <span class="Symbol">&amp;=</span> <span class="VarId">typ</span> <span class="String">&quot;FILES&quot;</span> <span class="Symbol">&amp;</span> <span class="VarId">args</span><span class="Symbol">}</span>
                   <span class="Symbol">&amp;=</span> <span class="VarId">text</span> <span class="String">&quot;Parse files each containing one expression \
                           \and output the asts&quot;</span>

<span class="Function">parseExpression</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">parseExpression</span> <span class="Symbol">=</span> <span class="VarId">mapM_</span> <span class="VarId">pe</span>
  <span class="Keyword">where</span>
    <span class="VarId">pe</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
    <span class="VarId">pe</span> <span class="VarId">fn</span> <span class="Symbol">=</span> <span class="VarId">runES</span> <span class="Symbol">$</span> <span class="Keyword">do</span>
              <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">putStrLn</span> <span class="Symbol">(</span><span class="String">&quot;-- ast of &quot;</span> <span class="Symbol">++</span> <span class="VarId">fn</span><span class="Symbol">)</span>
              <span class="VarId">s</span> <span class="Symbol">&lt;-</span> <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">readInput</span> <span class="VarId">fn</span>
              <span class="VarId">a</span> <span class="Symbol">&lt;-</span> <span class="VarId">etsr</span> <span class="Symbol">$</span> <span class="ConId">P.</span><span class="VarId">parseExpression</span> <span class="VarId">fn</span> <span class="VarId">s</span>
              <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">putStrLn</span> <span class="Symbol">$</span> <span class="VarId">ppExprNoAnns</span> <span class="Symbol">$</span> <span class="VarId">astTransformer</span> <span class="VarId">a</span></pre></div></div></div><hr
	 /></div
      ></div
    ><div id="ppp"
    ><h1
      >ppp</h1
      ><p
      >Parse then pretty print</p
      ><div id="example-1"
      ><h2
	>example</h2
	><p
	>test4.sql:</p
	><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">s</span> <span class="Symbol">(</span>
       <span class="VarId">s_no</span> <span class="Type">int</span> <span class="Keyword">primary</span> <span class="Keyword">key</span><span class="Symbol">,</span>
       <span class="VarId">sname</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">status</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">city</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span>

<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">p</span> <span class="Symbol">(</span>
       <span class="VarId">p_po</span> <span class="Type">int</span> <span class="Keyword">primary</span> <span class="Keyword">key</span><span class="Symbol">,</span>
       <span class="VarId">pname</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">color</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">weight</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">city</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span>

<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">sp</span> <span class="Symbol">(</span>
       <span class="VarId">s_no</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">references</span> <span class="VarId">s</span><span class="Symbol">,</span>
       <span class="VarId">p_no</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">references</span> <span class="VarId">p</span><span class="Symbol">,</span>
       <span class="VarId">qty</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="Keyword">primary</span> <span class="Keyword">key</span> <span class="Symbol">(</span><span class="VarId">s_no</span><span class="Symbol">,</span><span class="VarId">p_no</span><span class="Symbol">)</span>
<span class="Symbol">);</span>

<span class="Keyword">select</span> <span class="Symbol">*</span> <span class="Keyword">from</span> <span class="VarId">s</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">p</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">sp</span><span class="Symbol">;</span>

<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">s</span> <span class="Symbol">(</span><span class="VarId">s_no</span><span class="Symbol">,</span> <span class="VarId">sname</span><span class="Symbol">,</span> <span class="VarId">status</span><span class="Symbol">,</span> <span class="VarId">city</span><span class="Symbol">)</span> <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Number">1</span><span class="Symbol">,</span> <span class="Char">'name'</span><span class="Symbol">,</span> <span class="Char">'good'</span><span class="Symbol">,</span> <span class="Char">'london'</span><span class="Symbol">);</span></pre></div><div class='haskell'><pre class="sourceCode"><span class="Symbol">$</span> <span class="ConId">HsSqlPppUtil</span> <span class="VarId">ppp</span> <span class="VarId">test4</span><span class="Symbol">.</span><span class="VarId">sql</span>
<span class="Comment">--ppp test4.sql</span>
<span class="Function">create</span> <span class="VarId">table</span> <span class="VarId">s</span> <span class="Symbol">(</span>
  <span class="VarId">s_no</span> <span class="VarId">int</span> <span class="VarId">primary</span> <span class="VarId">key</span><span class="Symbol">,</span>
  <span class="VarId">sname</span> <span class="VarId">text</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">,</span>
  <span class="VarId">status</span> <span class="VarId">int</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">,</span>
  <span class="VarId">city</span> <span class="VarId">text</span> <span class="VarId">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span>

<span class="Function">create</span> <span class="VarId">table</span> <span class="VarId">p</span> <span class="Symbol">(</span>
  <span class="VarId">p_po</span> <span class="VarId">int</span> <span class="VarId">primary</span> <span class="VarId">key</span><span class="Symbol">,</span>
  <span class="VarId">pname</span> <span class="VarId">text</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">,</span>
  <span class="VarId">color</span> <span class="VarId">text</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">,</span>
  <span class="VarId">weight</span> <span class="VarId">int</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">,</span>
  <span class="VarId">city</span> <span class="VarId">text</span> <span class="VarId">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span>

<span class="Function">create</span> <span class="VarId">table</span> <span class="VarId">sp</span> <span class="Symbol">(</span>
  <span class="VarId">s_no</span> <span class="VarId">int</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">references</span> <span class="VarId">s</span> <span class="VarId">on</span> <span class="VarId">delete</span> <span class="VarId">restrict</span> <span class="VarId">on</span> <span class="VarId">update</span> <span class="VarId">restrict</span><span class="Symbol">,</span>
  <span class="VarId">p_no</span> <span class="VarId">int</span> <span class="VarId">not</span> <span class="VarId">null</span> <span class="VarId">references</span> <span class="VarId">p</span> <span class="VarId">on</span> <span class="VarId">delete</span> <span class="VarId">restrict</span> <span class="VarId">on</span> <span class="VarId">update</span> <span class="VarId">restrict</span><span class="Symbol">,</span>
  <span class="VarId">qty</span> <span class="VarId">int</span> <span class="VarId">not</span> <span class="VarId">null</span><span class="Symbol">,</span>
  <span class="VarId">primary</span> <span class="VarId">key</span> <span class="Symbol">(</span><span class="VarId">s_no</span><span class="Symbol">,</span><span class="VarId">p_no</span><span class="Symbol">)</span>
<span class="Symbol">);</span>

<span class="Function">select</span> <span class="Symbol">*</span>
  <span class="VarId">from</span> <span class="Symbol">((</span><span class="VarId">s</span>
         <span class="VarId">inner</span> <span class="VarId">join</span> <span class="VarId">p</span><span class="Symbol">)</span>
        <span class="VarId">inner</span> <span class="VarId">join</span> <span class="VarId">sp</span><span class="Symbol">);</span>

<span class="Function">insert</span> <span class="VarId">into</span> <span class="VarId">s</span> <span class="Symbol">(</span><span class="VarId">s_no</span><span class="Symbol">,</span><span class="VarId">sname</span><span class="Symbol">,</span><span class="VarId">status</span><span class="Symbol">,</span><span class="VarId">city</span><span class="Symbol">)</span>
<span class="Function">values</span>
  <span class="Symbol">(</span><span class="Number">1</span><span class="Symbol">,</span>'<span class="VarId">name'</span><span class="Symbol">,</span>'<span class="VarId">good'</span><span class="Symbol">,</span>'<span class="VarId">london'</span><span class="Symbol">)</span>
<span class="Symbol">;</span>
</pre></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">pppA</span> <span class="Symbol">=</span> <span class="VarId">mode</span> <span class="Symbol">$</span> <span class="ConId">Ppp</span> <span class="Symbol">{</span><span class="VarId">files</span> <span class="Symbol">=</span> <span class="VarId">def</span> <span class="Symbol">&amp;=</span> <span class="VarId">typ</span> <span class="String">&quot;FILES&quot;</span> <span class="Symbol">&amp;</span> <span class="VarId">args</span><span class="Symbol">}</span>
       <span class="Symbol">&amp;=</span> <span class="VarId">text</span> <span class="String">&quot;Parse then pretty print some sql so you can check the result \
               \hasn't mangled the sql, or see the result of the ast \
               \transformer if you've added one.&quot;</span>

<span class="Function">ppp</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span><span class="Symbol">()</span>
<span class="Function">ppp</span> <span class="Symbol">=</span> <span class="VarId">mapM_</span> <span class="VarId">f</span> 
  <span class="Keyword">where</span>
    <span class="VarId">f</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
    <span class="VarId">f</span> <span class="VarId">fn</span> <span class="Symbol">=</span> <span class="VarId">runES</span> <span class="Symbol">$</span> <span class="Keyword">do</span>
             <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">putStrLn</span> <span class="Symbol">$</span> <span class="String">&quot;--ppp &quot;</span> <span class="Symbol">++</span> <span class="VarId">fn</span>
             <span class="VarId">s</span> <span class="Symbol">&lt;-</span> <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">readInput</span> <span class="VarId">fn</span>
             <span class="VarId">a</span> <span class="Symbol">&lt;-</span> <span class="VarId">etsr</span> <span class="Symbol">$</span> <span class="ConId">P.</span><span class="VarId">parseSql</span> <span class="VarId">fn</span> <span class="VarId">s</span>
             <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">putStrLn</span> <span class="Symbol">$</span> <span class="VarId">printSql</span> <span class="Symbol">$</span> <span class="VarId">astTransformer</span> <span class="VarId">a</span></pre></div></div></div><hr
	 /></div
      ></div
    ><div id="pppp"
    ><h1
      >Pppp</h1
      ><p
      >Parse, pretty print and parse, then check two parse trees are same</p
      ><div id="example-2"
      ><h2
	>example</h2
	><div class='sh'><pre class="sourceCode">$ HsSqlPppUtil pppp test4<span class="Symbol">.</span>sql
success</pre></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">ppppA</span> <span class="Symbol">=</span> <span class="VarId">mode</span> <span class="Symbol">$</span> <span class="ConId">Pppp</span> <span class="Symbol">{</span><span class="VarId">files</span> <span class="Symbol">=</span> <span class="VarId">def</span> <span class="Symbol">&amp;=</span> <span class="VarId">typ</span> <span class="String">&quot;FILES&quot;</span> <span class="Symbol">&amp;</span> <span class="VarId">args</span><span class="Symbol">}</span>
        <span class="Symbol">&amp;=</span> <span class="VarId">text</span> <span class="String">&quot;Routine to parse sql from a file, pretty print it \
                \then parse it again and check the post pretty \
                \printing ast is the same as the initial ast&quot;</span>

<span class="Function">testPppp</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">testPppp</span> <span class="Symbol">=</span> <span class="VarId">mapM_</span> <span class="VarId">tp</span>
  <span class="Keyword">where</span>
    <span class="VarId">tp</span> <span class="VarId">fn</span> <span class="Symbol">=</span> <span class="VarId">runES</span> <span class="Symbol">$</span> <span class="Keyword">do</span>
              <span class="VarId">ast1</span> <span class="Symbol">&lt;-</span> <span class="VarId">ps</span> <span class="VarId">fn</span> <span class="Symbol">=&lt;&lt;</span> <span class="Symbol">(</span><span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="VarId">readInput</span> <span class="VarId">fn</span><span class="Symbol">)</span>
              <span class="VarId">ast2</span> <span class="Symbol">&lt;-</span> <span class="VarId">ps</span> <span class="String">&quot;&quot;</span> <span class="Symbol">$</span> <span class="VarId">printSql</span> <span class="VarId">ast1</span> 
              <span class="VarId">liftIO</span> <span class="Symbol">$</span> <span class="Keyword">if</span> <span class="VarId">ast1</span> <span class="Symbol">/=</span> <span class="VarId">ast2</span>
                       <span class="Keyword">then</span> <span class="Keyword">do</span>
                            <span class="VarId">putStrLn</span> <span class="String">&quot;asts are different\n-- original&quot;</span>
                            <span class="VarId">putStrLn</span> <span class="Symbol">$</span> <span class="VarId">ppExprNoAnns</span> <span class="VarId">ast1</span>
                            <span class="VarId">putStrLn</span> <span class="String">&quot;-- ppp'd&quot;</span>
                            <span class="VarId">putStrLn</span> <span class="Symbol">$</span> <span class="VarId">ppExprNoAnns</span> <span class="VarId">ast2</span>
                         <span class="Keyword">else</span> <span class="VarId">putStrLn</span> <span class="String">&quot;success&quot;</span>
    <span class="VarId">ps</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">ErrorT</span> <span class="ConId">String</span> <span class="ConId">IO</span> <span class="Symbol">[</span><span class="ConId">Statement</span><span class="Symbol">]</span>
    <span class="VarId">ps</span> <span class="VarId">fn</span> <span class="VarId">s</span> <span class="Symbol">=</span> <span class="VarId">resetAnnotations</span> <span class="Symbol">`</span><span class="VarId">fmap</span><span class="Symbol">`</span> <span class="Symbol">(</span><span class="VarId">etsr</span> <span class="Symbol">$</span> <span class="ConId">P.</span><span class="VarId">parseSql</span> <span class="VarId">fn</span> <span class="VarId">s</span><span class="Symbol">)</span></pre></div></div></div><hr
	 /></div
      ></div
    ><div id="typecheck"
    ><h1
      >typeCheck</h1
      ><div id="examples-2"
      ><h2
	>examples</h2
	><p
	>test4.sql:</p
	><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">s</span> <span class="Symbol">(</span>
       <span class="VarId">s_no</span> <span class="Type">int</span> <span class="Keyword">primary</span> <span class="Keyword">key</span><span class="Symbol">,</span>
       <span class="VarId">sname</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">status</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">city</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span>

<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">p</span> <span class="Symbol">(</span>
       <span class="VarId">p_po</span> <span class="Type">int</span> <span class="Keyword">primary</span> <span class="Keyword">key</span><span class="Symbol">,</span>
       <span class="VarId">pname</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">color</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">weight</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">city</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span>

<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">sp</span> <span class="Symbol">(</span>
       <span class="VarId">s_no</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">references</span> <span class="VarId">s</span><span class="Symbol">,</span>
       <span class="VarId">p_no</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">references</span> <span class="VarId">p</span><span class="Symbol">,</span>
       <span class="VarId">qty</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="Keyword">primary</span> <span class="Keyword">key</span> <span class="Symbol">(</span><span class="VarId">s_no</span><span class="Symbol">,</span><span class="VarId">p_no</span><span class="Symbol">)</span>
<span class="Symbol">);</span>

<span class="Keyword">select</span> <span class="Symbol">*</span> <span class="Keyword">from</span> <span class="VarId">s</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">p</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">sp</span><span class="Symbol">;</span>

<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">s</span> <span class="Symbol">(</span><span class="VarId">s_no</span><span class="Symbol">,</span> <span class="VarId">sname</span><span class="Symbol">,</span> <span class="VarId">status</span><span class="Symbol">,</span> <span class="VarId">city</span><span class="Symbol">)</span> <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Number">1</span><span class="Symbol">,</span> <span class="Char">'name'</span><span class="Symbol">,</span> <span class="Char">'good'</span><span class="Symbol">,</span> <span class="Char">'london'</span><span class="Symbol">);</span></pre></div><p
	>(no output for success)</p
	><div class='sh'><pre class="sourceCode">$ HsSqlPppUtil typecheck test4<span class="Symbol">.</span>sql
$</pre></div><p
	>test5.sql:</p
	><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">s</span> <span class="Symbol">(</span>
       <span class="VarId">s_no</span> <span class="Type">int</span> <span class="Keyword">primary</span> <span class="Keyword">key</span><span class="Symbol">,</span>
       <span class="VarId">sname</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">status</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">city</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span>

<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">p</span> <span class="Symbol">(</span>
       <span class="VarId">p_po</span> <span class="Type">int</span> <span class="Keyword">primary</span> <span class="Keyword">key</span><span class="Symbol">,</span>
       <span class="VarId">pname</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">color</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">weight</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">city</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span>

<span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">sp</span> <span class="Symbol">(</span>
       <span class="VarId">s_no</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">references</span> <span class="VarId">s</span><span class="Symbol">,</span>
       <span class="VarId">p_no</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span> <span class="Keyword">references</span> <span class="VarId">p</span><span class="Symbol">,</span>
       <span class="VarId">qty</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="Keyword">primary</span> <span class="Keyword">key</span> <span class="Symbol">(</span><span class="VarId">s_no</span><span class="Symbol">,</span><span class="VarId">p_no</span><span class="Symbol">)</span>
<span class="Symbol">);</span>

<span class="Keyword">select</span> <span class="Symbol">*</span> <span class="Keyword">from</span> <span class="VarId">s1</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">p</span> <span class="Keyword">inner</span> <span class="Keyword">join</span> <span class="VarId">sp</span><span class="Symbol">;</span>

<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">s</span> <span class="Symbol">(</span><span class="VarId">s_no</span><span class="Symbol">,</span> <span class="VarId">sname</span><span class="Symbol">,</span> <span class="VarId">status</span><span class="Symbol">,</span> <span class="VarId">cityc</span><span class="Symbol">)</span> <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Number">1</span><span class="Symbol">,</span> <span class="Char">'name'</span><span class="Symbol">,</span> <span class="Char">'good'</span><span class="Symbol">,</span> <span class="Char">'london'</span><span class="Symbol">);</span></pre></div><div class='haskell'><pre class="sourceCode"><span class="Symbol">$</span> <span class="ConId">HsSqlPppUtil</span> <span class="VarId">typecheck</span> <span class="VarId">test5</span><span class="Symbol">.</span><span class="VarId">sql</span>
<span class="Function">test5</span><span class="Symbol">.</span><span class="VarId">sql</span><span class="Symbol">:</span><span class="Number">23</span><span class="Symbol">:</span><span class="Number">15</span><span class="Symbol">:</span>
<span class="Symbol">[</span><span class="ConId">UnrecognisedRelation</span> <span class="String">&quot;s1&quot;</span><span class="Symbol">]</span>
<span class="Function">test5</span><span class="Symbol">.</span><span class="VarId">sql</span><span class="Symbol">:</span><span class="Number">25</span><span class="Symbol">:</span><span class="Number">1</span><span class="Symbol">:</span>
<span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;cityc&quot;</span><span class="Symbol">]</span></pre></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">typeCheckA</span> <span class="Symbol">=</span> <span class="VarId">mode</span> <span class="Symbol">$</span> <span class="ConId">TypeCheck</span> <span class="Symbol">{</span><span class="VarId">database</span> <span class="Symbol">=</span> <span class="VarId">def</span>
                              <span class="Symbol">,</span><span class="VarId">files</span> <span class="Symbol">=</span> <span class="VarId">def</span> <span class="Symbol">&amp;=</span> <span class="VarId">typ</span> <span class="String">&quot;FILES&quot;</span> <span class="Symbol">&amp;</span> <span class="VarId">args</span><span class="Symbol">}</span>
             <span class="Symbol">&amp;=</span> <span class="VarId">text</span> <span class="String">&quot;reads each file, parses, type checks, then outputs \
                     \any type errors&quot;</span>

<span class="Function">typeCheck2</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="ConId">FilePath</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">typeCheck2</span> <span class="VarId">db</span> <span class="VarId">fns</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
  <span class="VarId">cat</span> <span class="Symbol">&lt;-</span> <span class="VarId">either</span> <span class="Symbol">(</span><span class="VarId">error</span> <span class="Symbol">.</span> <span class="VarId">show</span><span class="Symbol">)</span> <span class="VarId">return</span> <span class="Symbol">=&lt;&lt;</span> <span class="VarId">readCatalog</span> <span class="VarId">db</span>
  <span class="VarId">a1</span> <span class="Symbol">&lt;-</span> <span class="VarId">concat</span> <span class="Symbol">`</span><span class="VarId">fmap</span><span class="Symbol">`</span> <span class="VarId">parseInputs</span> <span class="ConId">P.</span><span class="VarId">parseSql</span> <span class="VarId">fns</span>
  <span class="VarId">mapM_</span> <span class="VarId">putStrLn</span> <span class="Symbol">$</span> <span class="VarId">ppTypeErrors</span>
                 <span class="Symbol">$</span> <span class="VarId">getTypeErrors</span>
                 <span class="Symbol">$</span> <span class="VarId">snd</span>
                 <span class="Symbol">$</span> <span class="ConId">A.</span><span class="VarId">typeCheck</span> <span class="VarId">cat</span>
                 <span class="Symbol">$</span> <span class="VarId">astTransformer</span> <span class="VarId">a1</span></pre></div></div></div><hr
	 /></div
      ></div
    ><div id="typecheckexpression"
    ><h1
      >typeCheckExpression</h1
      ><div id="examples-3"
      ><h2
	>examples</h2
	><div class='haskell'><pre class="sourceCode"><span class="Symbol">$</span> <span class="VarId">echo</span> <span class="String">&quot;3 = any (array[1,2])&quot;</span> <span class="Symbol">|</span> <span class="Symbol">./</span><span class="ConId">HsSqlPppUtil</span> <span class="VarId">typecheckexpression</span> <span class="Symbol">-</span>
<span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span></pre></div><div class='sh'><pre class="sourceCode">$ echo <span class="String">&quot;test(3,'stuff'::what)&quot;</span> <span class="Symbol">|</span> <span class="Symbol">./</span>HsSqlPppUtil typecheckexpression -
-<span class="Symbol">:</span><span class="Number">1</span><span class="Symbol">:</span><span class="Number">17</span><span class="Symbol">:</span>
<span class="Symbol">[</span>UnknownTypeName <span class="String">&quot;what&quot;</span><span class="Symbol">]</span>
TypeCheckFailed</pre></div><div class='sh'><pre class="sourceCode">$ echo <span class="String">&quot;test(3,'stuff')&quot;</span> <span class="Symbol">|</span> <span class="Symbol">./</span>HsSqlPppUtil typecheckexpression -
-<span class="Symbol">:</span><span class="Number">1</span><span class="Symbol">:</span><span class="Number">5</span><span class="Symbol">:</span>
<span class="Symbol">[</span>NoMatchingOperator <span class="String">&quot;test&quot;</span> <span class="Symbol">[</span>ScalarType <span class="String">&quot;int4&quot;</span><span class="Symbol">,</span>UnknownType<span class="Symbol">]]</span>
TypeCheckFailed</pre></div><p
	>type checks strings as unknown types, doesn't parse the contents of these yet, works just like postgresql which catches this error only at runtime.</p
	><div class='sh'><pre class="sourceCode">$ echo <span class="String">&quot;array[3,'stuff']&quot;</span> <span class="Symbol">|</span> <span class="Symbol">./</span>HsSqlPppUtil typecheckexpression -
ArrayType <span class="Symbol">(</span>ScalarType <span class="String">&quot;int4&quot;</span><span class="Symbol">)</span></pre></div><div class='sh'><pre class="sourceCode">$ echo <span class="String">&quot;array[3,'stuff'::text]&quot;</span> <span class="Symbol">|</span> <span class="Symbol">./</span>HsSqlPppUtil typecheckexpression -
-<span class="Symbol">:</span><span class="Number">1</span><span class="Symbol">:</span><span class="Number">1</span><span class="Symbol">:</span>
<span class="Symbol">[</span>NoMatchingOperator <span class="String">&quot;!arrayctor&quot;</span> <span class="Symbol">[</span>ScalarType <span class="String">&quot;int4&quot;</span><span class="Symbol">,</span>ScalarType <span class="String">&quot;text&quot;</span><span class="Symbol">]]</span>
TypeCheckFailed</pre></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">typeCheckExpressionA</span> <span class="Symbol">=</span> <span class="VarId">mode</span> <span class="Symbol">$</span> <span class="ConId">TypeCheckExpression</span> <span class="Symbol">{</span><span class="VarId">database</span> <span class="Symbol">=</span> <span class="VarId">def</span>
                              <span class="Symbol">,</span><span class="VarId">files</span> <span class="Symbol">=</span> <span class="VarId">def</span> <span class="Symbol">&amp;=</span> <span class="VarId">typ</span> <span class="String">&quot;FILES&quot;</span> <span class="Symbol">&amp;</span> <span class="VarId">args</span><span class="Symbol">}</span>
     <span class="Symbol">&amp;=</span> <span class="VarId">text</span> <span class="String">&quot;reads each file, parses as expression, \
             \ type checks, then outputs the type or any type errors&quot;</span>

<span class="Function">typeCheckExpression</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="ConId">FilePath</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">typeCheckExpression</span> <span class="VarId">db</span> <span class="VarId">fns</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
  <span class="VarId">cat</span> <span class="Symbol">&lt;-</span> <span class="VarId">either</span> <span class="Symbol">(</span><span class="VarId">error</span> <span class="Symbol">.</span> <span class="VarId">show</span><span class="Symbol">)</span> <span class="VarId">return</span> <span class="Symbol">=&lt;&lt;</span> <span class="VarId">readCatalog</span> <span class="VarId">db</span>
  <span class="VarId">a1</span> <span class="Symbol">&lt;-</span> <span class="VarId">parseInputs</span> <span class="ConId">P.</span><span class="VarId">parseExpression</span> <span class="VarId">fns</span>
  <span class="Keyword">let</span> <span class="VarId">aa1</span> <span class="Symbol">=</span> <span class="VarId">map</span> <span class="Symbol">(</span><span class="ConId">A.</span><span class="VarId">typeCheckExpression</span> <span class="VarId">cat</span> <span class="Symbol">.</span> <span class="VarId">astTransformer</span><span class="Symbol">)</span> <span class="VarId">a1</span>
      <span class="VarId">tes</span> <span class="Symbol">=</span> <span class="VarId">concatMap</span> <span class="VarId">getTypeErrors</span> <span class="VarId">aa1</span>
  <span class="VarId">mapM_</span> <span class="VarId">putStrLn</span> <span class="Symbol">$</span> <span class="VarId">ppTypeErrors</span> <span class="VarId">tes</span></pre></div></div></div><hr
	 /></div
      ></div
    ><div id="allannotations"
    ><h1
      >allAnnotations</h1
      ><div id="example-3"
      ><h2
	>example</h2
	><p
	>test6.sql:</p
	><div class='SqlPostgresql'><pre class="sourceCode"><span class="Keyword">create</span> <span class="Keyword">table</span> <span class="VarId">s</span> <span class="Symbol">(</span>
       <span class="VarId">s_no</span> <span class="Type">int</span> <span class="Keyword">primary</span> <span class="Keyword">key</span><span class="Symbol">,</span>
       <span class="VarId">sname</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">status</span> <span class="Type">int</span> <span class="Keyword">not</span> <span class="Keyword">null</span><span class="Symbol">,</span>
       <span class="VarId">city</span> <span class="Type">text</span> <span class="Keyword">not</span> <span class="VarId">null</span>
<span class="Symbol">);</span>

<span class="Keyword">select</span> <span class="Symbol">*</span> <span class="Keyword">from</span> <span class="VarId">s</span><span class="Symbol">;</span>

<span class="Keyword">insert</span> <span class="Keyword">into</span> <span class="VarId">s</span> <span class="Symbol">(</span><span class="VarId">s_no</span><span class="Symbol">,</span> <span class="VarId">sname</span><span class="Symbol">,</span> <span class="VarId">status</span><span class="Symbol">,</span> <span class="VarId">city</span><span class="Symbol">)</span> <span class="Keyword">values</span> <span class="Symbol">(</span><span class="Number">1</span><span class="Symbol">,</span> <span class="Char">'name'</span><span class="Symbol">,</span> <span class="Char">'good'</span><span class="Symbol">,</span> <span class="Char">'london'</span><span class="Symbol">);</span></pre></div><div class='haskell'><pre class="sourceCode"><span class="Symbol">$</span> <span class="ConId">HsSqlPppUtil</span> <span class="VarId">allannotations</span> <span class="VarId">test6</span><span class="Symbol">.</span><span class="VarId">sql</span>
<span class="Symbol">[</span><span class="ConId">CreateTable</span>
   <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">1</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">),</span>
               <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="ConId">Pseudo</span> <span class="ConId">Void</span><span class="Symbol">),</span> <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
               <span class="VarId">catUpd</span> <span class="Symbol">=</span>
                 <span class="Symbol">[</span><span class="ConId">CatCreateTable</span> <span class="String">&quot;s&quot;</span>
                    <span class="Symbol">[(</span><span class="String">&quot;s_no&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;sname&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">),</span>
                     <span class="Symbol">(</span><span class="String">&quot;status&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;city&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]</span>
                    <span class="Symbol">[(</span><span class="String">&quot;tableoid&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;oid&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;cmax&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;cid&quot;</span><span class="Symbol">),</span>
                     <span class="Symbol">(</span><span class="String">&quot;xmax&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;xid&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;cmin&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;cid&quot;</span><span class="Symbol">),</span>
                     <span class="Symbol">(</span><span class="String">&quot;xmin&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;xid&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;ctid&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;tid&quot;</span><span class="Symbol">)]],</span>
               <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
   <span class="String">&quot;s&quot;</span>
   <span class="Symbol">[</span><span class="ConId">AttributeDef</span>
      <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">2</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
      <span class="String">&quot;s_no&quot;</span>
      <span class="Symbol">(</span><span class="ConId">SimpleTypeName</span>
         <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">2</span><span class="Symbol">,</span> <span class="Number">13</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
         <span class="String">&quot;int&quot;</span><span class="Symbol">)</span>
      <span class="ConId">Nothing</span>
      <span class="Symbol">[</span><span class="ConId">RowPrimaryKeyConstraint</span>
         <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">2</span><span class="Symbol">,</span> <span class="Number">17</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
         <span class="String">&quot;&quot;</span><span class="Symbol">],</span>
    <span class="ConId">AttributeDef</span>
      <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">3</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
      <span class="String">&quot;sname&quot;</span>
      <span class="Symbol">(</span><span class="ConId">SimpleTypeName</span>
         <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">3</span><span class="Symbol">,</span> <span class="Number">14</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
         <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
      <span class="ConId">Nothing</span>
      <span class="Symbol">[</span><span class="ConId">NotNullConstraint</span>
         <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">3</span><span class="Symbol">,</span> <span class="Number">19</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
         <span class="String">&quot;&quot;</span><span class="Symbol">],</span>
    <span class="ConId">AttributeDef</span>
      <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">4</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
      <span class="String">&quot;status&quot;</span>
      <span class="Symbol">(</span><span class="ConId">SimpleTypeName</span>
         <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">4</span><span class="Symbol">,</span> <span class="Number">15</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
         <span class="String">&quot;int&quot;</span><span class="Symbol">)</span>
      <span class="ConId">Nothing</span>
      <span class="Symbol">[</span><span class="ConId">NotNullConstraint</span>
         <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">4</span><span class="Symbol">,</span> <span class="Number">19</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
         <span class="String">&quot;&quot;</span><span class="Symbol">],</span>
    <span class="ConId">AttributeDef</span>
      <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">5</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
      <span class="String">&quot;city&quot;</span>
      <span class="Symbol">(</span><span class="ConId">SimpleTypeName</span>
         <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">5</span><span class="Symbol">,</span> <span class="Number">13</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
         <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
      <span class="ConId">Nothing</span>
      <span class="Symbol">[</span><span class="ConId">NotNullConstraint</span>
         <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">5</span><span class="Symbol">,</span> <span class="Number">18</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
         <span class="String">&quot;&quot;</span><span class="Symbol">]]</span>
   <span class="Symbol">[],</span>
 <span class="ConId">SelectStatement</span>
   <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">,</span> <span class="Number">1</span><span class="Symbol">),</span>
               <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="ConId">Pseudo</span> <span class="ConId">Void</span><span class="Symbol">),</span> <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span>
               <span class="VarId">stType</span> <span class="Symbol">=</span>
                 <span class="ConId">Just</span>
                   <span class="Symbol">([],</span>
                    <span class="Symbol">[(</span><span class="String">&quot;s_no&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;sname&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">),</span>
                     <span class="Symbol">(</span><span class="String">&quot;status&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;city&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]),</span>
               <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
   <span class="Symbol">(</span><span class="ConId">Select</span>
      <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">,</span> <span class="Number">1</span><span class="Symbol">),</span>
                  <span class="VarId">atype</span> <span class="Symbol">=</span>
                    <span class="ConId">Just</span>
                      <span class="Symbol">(</span><span class="ConId">SetOfType</span>
                         <span class="Symbol">(</span><span class="ConId">CompositeType</span>
                            <span class="Symbol">[(</span><span class="String">&quot;s_no&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;sname&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">),</span>
                             <span class="Symbol">(</span><span class="String">&quot;status&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;city&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])),</span>
                  <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
      <span class="ConId">Dupes</span>
      <span class="Symbol">(</span><span class="ConId">SelectList</span>
         <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
         <span class="Symbol">[</span><span class="ConId">SelExp</span>
            <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                        <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                        <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
            <span class="Symbol">(</span><span class="ConId">Identifier</span>
               <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">),</span>
                           <span class="VarId">atype</span> <span class="Symbol">=</span>
                             <span class="ConId">Just</span>
                               <span class="Symbol">(</span><span class="ConId">CompositeType</span>
                                  <span class="Symbol">[(</span><span class="String">&quot;s_no&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;sname&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">),</span>
                                   <span class="Symbol">(</span><span class="String">&quot;status&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;city&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]),</span>
                           <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                           <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
               <span class="String">&quot;*&quot;</span><span class="Symbol">)]</span>
         <span class="Symbol">[])</span>
      <span class="Symbol">[</span><span class="ConId">Tref</span>
         <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">,</span> <span class="Number">15</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                     <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
         <span class="Symbol">(</span><span class="ConId">Identifier</span>
            <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">8</span><span class="Symbol">,</span> <span class="Number">15</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                        <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                        <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
            <span class="String">&quot;s&quot;</span><span class="Symbol">)</span>
         <span class="ConId">NoAlias</span><span class="Symbol">]</span>
      <span class="ConId">Nothing</span>
      <span class="Symbol">[]</span>
      <span class="ConId">Nothing</span>
      <span class="Symbol">[]</span>
      <span class="ConId">Nothing</span>
      <span class="ConId">Nothing</span><span class="Symbol">),</span>
 <span class="ConId">Insert</span>
   <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">10</span><span class="Symbol">,</span> <span class="Number">1</span><span class="Symbol">),</span>
               <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="ConId">Pseudo</span> <span class="ConId">Void</span><span class="Symbol">),</span> <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">([],</span> <span class="Symbol">[]),</span>
               <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
   <span class="Symbol">(</span><span class="ConId">Identifier</span>
      <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">10</span><span class="Symbol">,</span> <span class="Number">13</span><span class="Symbol">),</span> <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
      <span class="String">&quot;s&quot;</span><span class="Symbol">)</span>
   <span class="Symbol">[</span><span class="String">&quot;s_no&quot;</span><span class="Symbol">,</span> <span class="String">&quot;sname&quot;</span><span class="Symbol">,</span> <span class="String">&quot;status&quot;</span><span class="Symbol">,</span> <span class="String">&quot;city&quot;</span><span class="Symbol">]</span>
   <span class="Symbol">(</span><span class="ConId">Values</span>
      <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">10</span><span class="Symbol">,</span> <span class="Number">43</span><span class="Symbol">),</span>
                  <span class="VarId">atype</span> <span class="Symbol">=</span>
                    <span class="ConId">Just</span>
                      <span class="Symbol">(</span><span class="ConId">SetOfType</span>
                         <span class="Symbol">(</span><span class="ConId">CompositeType</span>
                            <span class="Symbol">[(</span><span class="String">&quot;column1&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;column2&quot;</span><span class="Symbol">,</span> <span class="ConId">UnknownType</span><span class="Symbol">),</span>
                             <span class="Symbol">(</span><span class="String">&quot;column3&quot;</span><span class="Symbol">,</span> <span class="ConId">UnknownType</span><span class="Symbol">),</span> <span class="Symbol">(</span><span class="String">&quot;column4&quot;</span><span class="Symbol">,</span> <span class="ConId">UnknownType</span><span class="Symbol">)])),</span>
                  <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                  <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">})</span>
      <span class="Symbol">[[</span><span class="ConId">IntegerLit</span>
          <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">10</span><span class="Symbol">,</span> <span class="Number">51</span><span class="Symbol">),</span>
                      <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">),</span> <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span>
                      <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">)})</span>
          <span class="Number">1</span><span class="Symbol">,</span>
        <span class="ConId">StringLit</span>
          <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">10</span><span class="Symbol">,</span> <span class="Number">54</span><span class="Symbol">),</span>
                      <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="ConId">UnknownType</span><span class="Symbol">,</span> <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span>
                      <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)})</span>
          <span class="String">&quot;name&quot;</span><span class="Symbol">,</span>
        <span class="ConId">StringLit</span>
          <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">10</span><span class="Symbol">,</span> <span class="Number">62</span><span class="Symbol">),</span>
                      <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="ConId">UnknownType</span><span class="Symbol">,</span> <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span>
                      <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">)})</span>
          <span class="String">&quot;good&quot;</span><span class="Symbol">,</span>
        <span class="ConId">StringLit</span>
          <span class="Symbol">(</span><span class="ConId">Annotation</span><span class="Symbol">{</span><span class="VarId">asrc</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="String">&quot;test6.sql&quot;</span><span class="Symbol">,</span> <span class="Number">10</span><span class="Symbol">,</span> <span class="Number">70</span><span class="Symbol">),</span>
                      <span class="VarId">atype</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="ConId">UnknownType</span><span class="Symbol">,</span> <span class="VarId">errs</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">stType</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">catUpd</span> <span class="Symbol">=</span> <span class="Symbol">[],</span>
                      <span class="VarId">fnProt</span> <span class="Symbol">=</span> <span class="ConId">Nothing</span><span class="Symbol">,</span> <span class="VarId">infType</span> <span class="Symbol">=</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)})</span>
          <span class="String">&quot;london&quot;</span><span class="Symbol">]])</span>
   <span class="ConId">Nothing</span><span class="Symbol">]</span></pre></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">allAnnotationsA</span> <span class="Symbol">=</span> <span class="VarId">mode</span> <span class="Symbol">$</span> <span class="ConId">AllAnnotations</span> <span class="Symbol">{</span><span class="VarId">database</span> <span class="Symbol">=</span> <span class="VarId">def</span>
                                       <span class="Symbol">,</span><span class="VarId">files</span> <span class="Symbol">=</span> <span class="VarId">def</span> <span class="Symbol">&amp;=</span> <span class="VarId">typ</span> <span class="String">&quot;FILES&quot;</span> <span class="Symbol">&amp;</span> <span class="VarId">args</span><span class="Symbol">}</span>
                  <span class="Symbol">&amp;=</span> <span class="VarId">text</span> <span class="String">&quot;reads each file, parses, type checks, then pretty \
                          \prints the ast with all annotations &quot;</span>

<span class="Function">allAnnotations</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="ConId">FilePath</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">allAnnotations</span> <span class="VarId">db</span> <span class="VarId">fns</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
  <span class="VarId">cat</span> <span class="Symbol">&lt;-</span> <span class="VarId">either</span> <span class="Symbol">(</span><span class="VarId">error</span> <span class="Symbol">.</span> <span class="VarId">show</span><span class="Symbol">)</span> <span class="VarId">return</span> <span class="Symbol">=&lt;&lt;</span> <span class="VarId">readCatalog</span> <span class="VarId">db</span>
  <span class="VarId">a1</span> <span class="Symbol">&lt;-</span> <span class="VarId">concat</span> <span class="Symbol">`</span><span class="VarId">fmap</span><span class="Symbol">`</span> <span class="VarId">parseInputs</span> <span class="ConId">P.</span><span class="VarId">parseSql</span> <span class="VarId">fns</span>
  <span class="VarId">putStrLn</span> <span class="Symbol">$</span> <span class="VarId">ppExpr</span> <span class="Symbol">$</span> <span class="VarId">snd</span> <span class="Symbol">$</span> <span class="ConId">A.</span><span class="VarId">typeCheck</span> <span class="VarId">cat</span> <span class="VarId">a1</span></pre></div></div></div><hr
	 /><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">rttA</span> <span class="Symbol">=</span> <span class="VarId">mode</span> <span class="Symbol">$</span> <span class="ConId">Rtt</span> <span class="Symbol">{</span><span class="VarId">database</span> <span class="Symbol">=</span> <span class="VarId">def</span>
                  <span class="Symbol">,</span><span class="VarId">files</span> <span class="Symbol">=</span> <span class="VarId">def</span> <span class="Symbol">&amp;=</span> <span class="VarId">typ</span> <span class="String">&quot;FILES&quot;</span> <span class="Symbol">&amp;</span> <span class="VarId">args</span><span class="Symbol">}</span>
                  <span class="Symbol">&amp;=</span> <span class="VarId">text</span> <span class="String">&quot;run tests on sql&quot;</span>

<span class="Function">rtt</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="ConId">FilePath</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">rtt</span> <span class="VarId">db</span> <span class="VarId">fns</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
  <span class="VarId">rt</span> <span class="Symbol">&lt;-</span> <span class="VarId">roundTripTest</span> <span class="VarId">astTransformer</span> <span class="VarId">db</span> <span class="VarId">fns</span>
  <span class="VarId">putStrLn</span> <span class="Symbol">$</span> <span class="VarId">rtShowBrief</span> <span class="VarId">rt</span></pre></div></div></div><hr
	 /><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">-- | Pretty print list of type errors with optional source position</span>
<span class="Comment">--   in emacs readable format.</span>
<span class="Function">ppTypeErrors</span> <span class="Symbol">::</span> <span class="Symbol">[(</span><span class="ConId">Maybe</span> <span class="Symbol">(</span><span class="ConId">String</span><span class="Symbol">,</span><span class="ConId">Int</span><span class="Symbol">,</span><span class="ConId">Int</span><span class="Symbol">),</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">])]</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="ConId">String</span><span class="Symbol">]</span>
<span class="Function">ppTypeErrors</span> <span class="VarId">tes</span> <span class="Symbol">=</span>
  <span class="VarId">map</span> <span class="VarId">showSpTe</span> <span class="VarId">tes</span>
  <span class="Keyword">where</span>
    <span class="VarId">showSpTe</span> <span class="Symbol">(</span><span class="ConId">Just</span> <span class="Symbol">(</span><span class="VarId">fn</span><span class="Symbol">,</span><span class="VarId">l</span><span class="Symbol">,</span><span class="VarId">c</span><span class="Symbol">),</span> <span class="VarId">e</span><span class="Symbol">)</span> <span class="Symbol">=</span>
        <span class="VarId">fn</span> <span class="Symbol">++</span> <span class="String">&quot;:&quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">l</span> <span class="Symbol">++</span> <span class="String">&quot;:&quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">c</span> <span class="Symbol">++</span> <span class="String">&quot;:\n&quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">e</span>
    <span class="VarId">showSpTe</span> <span class="Symbol">(</span><span class="VarId">_</span><span class="Symbol">,</span><span class="VarId">e</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="String">&quot;unknown:0:0:\n&quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">e</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">getTypeErrors</span> <span class="Symbol">::</span> <span class="ConId">Data</span> <span class="VarId">a</span> <span class="Symbol">=&gt;</span> <span class="VarId">a</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[(</span><span class="ConId">Maybe</span> <span class="Symbol">(</span><span class="ConId">String</span><span class="Symbol">,</span><span class="ConId">Int</span><span class="Symbol">,</span><span class="ConId">Int</span><span class="Symbol">),</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">])]</span>
<span class="Function">getTypeErrors</span> <span class="VarId">es</span> <span class="Symbol">=</span>
  <span class="Keyword">let</span> <span class="Keyword">as</span> <span class="Symbol">=</span> <span class="Symbol">[(</span><span class="VarId">a</span><span class="Symbol">::</span><span class="ConId">Annotation</span><span class="Symbol">)</span> <span class="Symbol">|</span> <span class="VarId">a</span> <span class="Symbol">&lt;-</span> <span class="VarId">universeBi</span> <span class="VarId">es</span><span class="Symbol">]</span>
  <span class="Keyword">in</span> <span class="VarId">mapMaybe</span> <span class="VarId">getTes</span> <span class="Keyword">as</span>
  <span class="Keyword">where</span>
    <span class="VarId">getTes</span> <span class="Keyword">as</span> <span class="Symbol">=</span> <span class="Keyword">let</span> <span class="VarId">tes</span> <span class="Symbol">=</span> <span class="VarId">errs</span> <span class="Keyword">as</span>
                <span class="Keyword">in</span> <span class="Keyword">if</span> <span class="VarId">null</span> <span class="VarId">tes</span>
                   <span class="Keyword">then</span> <span class="ConId">Nothing</span>
                   <span class="Keyword">else</span> <span class="ConId">Just</span> <span class="Symbol">(</span><span class="VarId">asrc</span> <span class="Keyword">as</span><span class="Symbol">,</span> <span class="VarId">tes</span><span class="Symbol">)</span></pre></div></div></div><hr
	 /><p
	>read file as string - issues are:</p
	><p
	>want to support reading from stdin, and reading from a string passed as an argument to the exe</p
	><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">-- | read a file as text, will read from stdin if filename is '-'.</span>
<span class="Function">readInput</span> <span class="Symbol">::</span> <span class="ConId">FilePath</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="ConId">String</span>
<span class="Function">readInput</span> <span class="VarId">f</span> <span class="Symbol">=</span>
  <span class="Keyword">case</span> <span class="VarId">f</span> <span class="Keyword">of</span>
             <span class="String">&quot;-&quot;</span> <span class="Symbol">-&gt;</span> <span class="VarId">getContents</span>
             <span class="VarId">_</span> <span class="Symbol">|</span> <span class="VarId">length</span> <span class="VarId">f</span> <span class="Symbol">&gt;=</span> <span class="Number">2</span> <span class="Symbol">&amp;&amp;</span>
                 <span class="VarId">head</span> <span class="VarId">f</span> <span class="Symbol">==</span> <span class="Char">'&quot;'</span> <span class="Symbol">&amp;&amp;</span> <span class="VarId">last</span> <span class="VarId">f</span> <span class="Symbol">==</span> <span class="Char">'&quot;'</span>
                   <span class="Symbol">-&gt;</span> <span class="VarId">return</span> <span class="Symbol">$</span> <span class="VarId">drop</span> <span class="Number">1</span> <span class="Symbol">$</span> <span class="VarId">take</span> <span class="Symbol">(</span><span class="VarId">length</span> <span class="VarId">f</span> <span class="Symbol">-</span> <span class="Number">1</span><span class="Symbol">)</span> <span class="VarId">f</span>
               <span class="Symbol">|</span> <span class="VarId">otherwise</span> <span class="Symbol">-&gt;</span> <span class="VarId">readFile</span> <span class="VarId">f</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">type</span> <span class="ConId">ErrorIO</span> <span class="VarId">e</span> <span class="VarId">a</span> <span class="Symbol">=</span> <span class="ConId">ErrorT</span> <span class="VarId">e</span> <span class="ConId">IO</span> <span class="VarId">a</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">runES</span> <span class="Symbol">::</span> <span class="ConId">ErrorIO</span> <span class="ConId">String</span> <span class="Symbol">()</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">runES</span> <span class="VarId">f</span> <span class="Symbol">=</span> <span class="VarId">runErrorT</span> <span class="VarId">f</span> <span class="Symbol">&gt;&gt;=</span> <span class="VarId">either</span> <span class="VarId">putStrLn</span> <span class="VarId">return</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">etsr</span> <span class="Symbol">::</span> <span class="ConId">Show</span> <span class="VarId">e</span> <span class="Symbol">=&gt;</span> <span class="ConId">Either</span> <span class="VarId">e</span> <span class="VarId">a</span> <span class="Symbol">-&gt;</span> <span class="ConId">ErrorIO</span> <span class="ConId">String</span> <span class="VarId">a</span>
<span class="Function">etsr</span> <span class="Symbol">=</span> <span class="VarId">either</span> <span class="Symbol">(</span><span class="VarId">throwError</span> <span class="Symbol">.</span> <span class="VarId">show</span><span class="Symbol">)</span> <span class="VarId">return</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">parseInputs</span> <span class="Symbol">::</span> <span class="Symbol">(</span><span class="ConId">Show</span> <span class="VarId">a1</span><span class="Symbol">,</span> <span class="ConId">Error</span> <span class="VarId">a1</span><span class="Symbol">)</span> <span class="Symbol">=&gt;</span>
               <span class="Symbol">(</span><span class="ConId">FilePath</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Either</span> <span class="VarId">a1</span> <span class="VarId">a</span><span class="Symbol">)</span>
            <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="ConId">FilePath</span><span class="Symbol">]</span>
            <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">[</span><span class="VarId">a</span><span class="Symbol">]</span>
<span class="Function">parseInputs</span> <span class="VarId">p</span> <span class="VarId">fns</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
  <span class="Keyword">as</span> <span class="Symbol">&lt;-</span> <span class="VarId">mapM</span> <span class="VarId">pin</span> <span class="VarId">fns</span>
  <span class="VarId">return</span> <span class="Symbol">$</span> <span class="VarId">either</span> <span class="Symbol">(</span><span class="VarId">error</span> <span class="Symbol">.</span> <span class="VarId">show</span><span class="Symbol">)</span> <span class="VarId">id</span> <span class="Symbol">$</span> <span class="VarId">sequence</span> <span class="Keyword">as</span>
  <span class="Keyword">where</span>
    <span class="VarId">pin</span> <span class="VarId">fn</span> <span class="Symbol">=</span> <span class="VarId">fmap</span> <span class="Symbol">(</span><span class="VarId">p</span> <span class="VarId">fn</span><span class="Symbol">)</span> <span class="Symbol">$</span> <span class="VarId">readInput</span> <span class="VarId">fn</span></pre></div></div></div><hr
	 /></div
      ></div
    ><div id="main"
    ><h1
      >main</h1
      ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">
<span class="Function">main</span> <span class="Symbol">::</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">main</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
       <span class="VarId">cmd</span> <span class="Symbol">&lt;-</span> <span class="VarId">cmdArgs</span> <span class="String">&quot;HsSqlPppUtil, Copyright Jake Wheat 2010&quot;</span>
                      <span class="Symbol">[</span><span class="VarId">lexA</span><span class="Symbol">,</span> <span class="VarId">parseA</span><span class="Symbol">,</span> <span class="VarId">ppppA</span><span class="Symbol">,</span> <span class="VarId">pppA</span><span class="Symbol">,</span>
                       <span class="VarId">parseExpressionA</span><span class="Symbol">,</span> <span class="VarId">typeCheckExpressionA</span><span class="Symbol">,</span>
                       <span class="VarId">typeCheckA</span><span class="Symbol">,</span><span class="VarId">allAnnotationsA</span><span class="Symbol">,</span> <span class="VarId">rttA</span><span class="Symbol">]</span>

       <span class="Keyword">case</span> <span class="VarId">cmd</span> <span class="Keyword">of</span>
         <span class="ConId">Lex</span> <span class="VarId">fns</span> <span class="Symbol">-&gt;</span> <span class="VarId">lexFiles</span> <span class="VarId">fns</span>
         <span class="ConId">Parse</span> <span class="VarId">fns</span> <span class="Symbol">-&gt;</span> <span class="VarId">showAst</span> <span class="VarId">fns</span>
         <span class="ConId">Pppp</span> <span class="VarId">fns</span> <span class="Symbol">-&gt;</span> <span class="VarId">testPppp</span> <span class="VarId">fns</span>
         <span class="ConId">Ppp</span> <span class="VarId">fns</span> <span class="Symbol">-&gt;</span> <span class="VarId">ppp</span> <span class="VarId">fns</span>
         <span class="ConId">ParseExpression</span> <span class="VarId">fns</span> <span class="Symbol">-&gt;</span> <span class="VarId">parseExpression</span> <span class="VarId">fns</span>
         <span class="ConId">TypeCheck</span> <span class="VarId">db</span> <span class="VarId">fns</span> <span class="Symbol">-&gt;</span> <span class="VarId">typeCheck2</span> <span class="VarId">db</span> <span class="VarId">fns</span>
         <span class="ConId">TypeCheckExpression</span> <span class="VarId">db</span> <span class="VarId">fns</span> <span class="Symbol">-&gt;</span> <span class="VarId">typeCheckExpression</span> <span class="VarId">db</span> <span class="VarId">fns</span>
         <span class="ConId">AllAnnotations</span> <span class="VarId">db</span> <span class="VarId">fns</span> <span class="Symbol">-&gt;</span> <span class="VarId">allAnnotations</span> <span class="VarId">db</span> <span class="VarId">fns</span>
         <span class="ConId">Rtt</span> <span class="VarId">db</span> <span class="VarId">fns</span> <span class="Symbol">-&gt;</span> <span class="VarId">rtt</span> <span class="VarId">db</span> <span class="VarId">fns</span>

<span class="Function">lexA</span><span class="Symbol">,</span> <span class="VarId">parseA</span><span class="Symbol">,</span> <span class="VarId">ppppA</span><span class="Symbol">,</span> <span class="VarId">pppA</span><span class="Symbol">,</span>
  <span class="VarId">typeCheckA</span><span class="Symbol">,</span> <span class="VarId">parseExpressionA</span><span class="Symbol">,</span> <span class="VarId">typeCheckExpressionA</span><span class="Symbol">,</span>
  <span class="VarId">allAnnotationsA</span><span class="Symbol">,</span> <span class="VarId">rttA</span> <span class="Symbol">::</span> <span class="ConId">Mode</span> <span class="ConId">HsSqlPppUtil</span></pre></div></div></div></div
    ><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/31/11 20:00:52, hssqlppp-0.3.0</div
    ></body
  ></html
>
