<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >DocTool</title
    ><link href="../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../index.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">{-# LANGUAGE PatternGuards #-}</span>
<span class="Keyword">module</span> <span class="ConId">Text.DocTool.DocTool</span>
    <span class="Symbol">(</span><span class="ConId">OutputFile</span><span class="Symbol">(..)</span>
    <span class="Symbol">,</span><span class="ConId">Type</span><span class="Symbol">(..)</span>
    <span class="Symbol">,</span><span class="ConId">Source</span><span class="Symbol">(..)</span>
    <span class="Symbol">,</span><span class="ConId">Title</span>
    <span class="Symbol">,</span><span class="VarId">docify</span><span class="Symbol">)</span> <span class="Keyword">where</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">import</span> <span class="ConId">Text.Pandoc</span>
<span class="Keyword">import</span> <span class="ConId">Text.XHtml.Transitional</span> <span class="Keyword">hiding</span> <span class="Symbol">(</span><span class="VarId">toHtml</span><span class="Symbol">)</span>
<span class="Keyword">import</span> <span class="ConId">System.FilePath</span>
<span class="Keyword">import</span> <span class="ConId">System.Directory</span>
<span class="Keyword">import</span> <span class="ConId">Debug.Trace</span>
<span class="Keyword">import</span> <span class="ConId">Text.Highlighting.Illuminate</span>
<span class="Keyword">import</span> <span class="ConId">Data.DateTime</span>
<span class="Keyword">import</span> <span class="ConId">Control.Concurrent</span>
<span class="Keyword">import</span> <span class="ConId">Data.List</span>
<span class="Keyword">import</span> <span class="ConId">Control.Exception</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">import</span> <span class="ConId">Text.DocTool.Parser</span> <span class="Keyword">as</span> <span class="ConId">Parser</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">docify</span> <span class="Symbol">::</span> <span class="ConId">FilePath</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="ConId">OutputFile</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">docify</span> <span class="VarId">b</span> <span class="VarId">ofs</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
  <span class="VarId">t</span> <span class="Symbol">&lt;-</span> <span class="VarId">getCurrentTime</span>
  <span class="Keyword">let</span> <span class="VarId">tm</span> <span class="Symbol">=</span> <span class="VarId">formatDateTime</span> <span class="String">&quot;%D %T&quot;</span> <span class="VarId">t</span>
  <span class="VarId">children</span> <span class="Symbol">&lt;-</span> <span class="Symbol">(</span><span class="VarId">newMVar</span> <span class="Symbol">[])</span>
  <span class="VarId">mapM_</span> <span class="Symbol">(\</span><span class="VarId">f</span> <span class="Symbol">-&gt;</span> <span class="VarId">forkChild</span> <span class="VarId">children</span> <span class="Symbol">(</span><span class="VarId">process</span> <span class="String">&quot;0.3.0&quot;</span> <span class="VarId">tm</span> <span class="VarId">b</span> <span class="VarId">f</span> <span class="Symbol">&gt;&gt;</span> <span class="VarId">putStrLn</span> <span class="Symbol">(</span><span class="VarId">showOf</span> <span class="VarId">f</span><span class="Symbol">)))</span> <span class="VarId">ofs</span>
  <span class="VarId">waitForChildren</span> <span class="VarId">children</span>
         <span class="Keyword">where</span>
           <span class="VarId">showOf</span> <span class="Symbol">(</span><span class="ConId">OutputFile</span> <span class="Symbol">(</span><span class="ConId">Text</span> <span class="VarId">_</span><span class="Symbol">)</span> <span class="VarId">_</span> <span class="VarId">fp</span> <span class="VarId">_</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">fp</span>
           <span class="VarId">showOf</span> <span class="Symbol">(</span><span class="ConId">OutputFile</span> <span class="VarId">s</span> <span class="VarId">_</span> <span class="VarId">_</span> <span class="VarId">_</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">show</span> <span class="VarId">s</span></pre></div></div></div><p
    >====================================================================</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">data</span> <span class="ConId">OutputFile</span> <span class="Symbol">=</span> <span class="ConId">OutputFile</span> <span class="ConId">Source</span> <span class="ConId">Type</span> <span class="ConId">FilePath</span> <span class="ConId">Title</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">instance</span> <span class="ConId">Show</span> <span class="ConId">OutputFile</span> <span class="Keyword">where</span>
    <span class="VarId">show</span> <span class="Symbol">(</span><span class="ConId">OutputFile</span> <span class="Symbol">(</span><span class="ConId">Text</span> <span class="VarId">_</span><span class="Symbol">)</span> <span class="VarId">a</span> <span class="VarId">b</span> <span class="VarId">c</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="String">&quot;OutputFile (Text \&quot;...\&quot;) &quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">a</span> <span class="Symbol">++</span> <span class="String">&quot; &quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">b</span> <span class="Symbol">++</span> <span class="String">&quot; &quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">c</span>
    <span class="VarId">show</span> <span class="Symbol">(</span><span class="ConId">OutputFile</span> <span class="VarId">a</span> <span class="VarId">b</span> <span class="VarId">c</span> <span class="VarId">d</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="String">&quot;OutputFile &quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">a</span> <span class="Symbol">++</span> <span class="String">&quot; &quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">b</span> <span class="Symbol">++</span> <span class="String">&quot; &quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">c</span> <span class="Symbol">++</span> <span class="String">&quot; &quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">d</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">data</span> <span class="ConId">Type</span> <span class="Symbol">=</span> <span class="ConId">Sql</span> <span class="Symbol">|</span> <span class="ConId">Lhs</span> <span class="Symbol">|</span> <span class="ConId">Hs</span> <span class="Symbol">|</span> <span class="ConId">Txt</span> <span class="Symbol">|</span> <span class="ConId">Ag</span> <span class="Symbol">|</span> <span class="ConId">Css</span> <span class="Symbol">|</span> <span class="ConId">C</span> <span class="Symbol">|</span> <span class="ConId">H</span>
            <span class="Keyword">deriving</span> <span class="ConId">Show</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">data</span> <span class="ConId">Source</span> <span class="Symbol">=</span> <span class="ConId">File</span> <span class="ConId">FilePath</span>
            <span class="Symbol">|</span> <span class="ConId">Text</span> <span class="ConId">String</span>
              <span class="Keyword">deriving</span> <span class="ConId">Show</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">type</span> <span class="ConId">Title</span> <span class="Symbol">=</span> <span class="ConId">String</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">--type ProcessText = String -&gt; String</span>
<span class="Comment">--type ProcessPandoc = Pandoc -&gt; Pandoc</span>
<span class="Comment">--type ProcessHtml = Html -&gt; Html</span></pre></div></div></div><p
    >=========================================================</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">{-ppPandoc :: OutputFile -&gt; IO String</span>
<span class="Comment">ppPandoc (OutputFile s t _ _) =</span>
<span class="Comment">    asText s &gt;&gt;= return . (toPandoc t |&gt; ppExpr)-}</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">asText</span> <span class="Symbol">::</span> <span class="ConId">Source</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="ConId">String</span>
<span class="Function">asText</span> <span class="Symbol">(</span><span class="ConId">File</span> <span class="VarId">fp</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">readFile</span> <span class="VarId">fp</span>
<span class="Function">asText</span> <span class="Symbol">(</span><span class="ConId">Text</span> <span class="VarId">a</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">return</span> <span class="VarId">a</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">toPandoc</span> <span class="Symbol">::</span> <span class="ConId">Type</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Pandoc</span>
<span class="Function">toPandoc</span> <span class="VarId">t</span> <span class="VarId">s</span> <span class="Symbol">=</span> <span class="Comment">{-trace (&quot;toPandoc &quot; ++ show t ++ s) $-}</span>
               <span class="Keyword">case</span> <span class="VarId">t</span> <span class="Keyword">of</span>
                 <span class="ConId">Lhs</span> <span class="Symbol">-&gt;</span> <span class="VarId">readLhs</span> <span class="VarId">s</span>
                 <span class="ConId">Sql</span> <span class="Symbol">-&gt;</span> <span class="VarId">readSource</span> <span class="String">&quot;/*&quot;</span> <span class="String">&quot;*/&quot;</span> <span class="String">&quot;sql&quot;</span> <span class="VarId">s</span>
                 <span class="ConId">Hs</span> <span class="Symbol">-&gt;</span> <span class="VarId">readSource</span> <span class="String">&quot;{-&quot;</span> <span class="String">&quot;-}&quot;</span> <span class="String">&quot;haskell&quot;</span> <span class="VarId">s</span>
                 <span class="ConId">Ag</span> <span class="Symbol">-&gt;</span> <span class="VarId">readSource</span> <span class="String">&quot;{-&quot;</span> <span class="String">&quot;-}&quot;</span> <span class="String">&quot;haskell&quot;</span> <span class="VarId">s</span>
                 <span class="ConId">Txt</span> <span class="Symbol">-&gt;</span> <span class="VarId">readMd</span> <span class="VarId">s</span>
                 <span class="ConId">Css</span> <span class="Symbol">-&gt;</span> <span class="VarId">readSource</span> <span class="String">&quot;/*&quot;</span> <span class="String">&quot;*/&quot;</span> <span class="String">&quot;css&quot;</span> <span class="VarId">s</span>
                 <span class="ConId">C</span> <span class="Symbol">-&gt;</span> <span class="VarId">readSource</span> <span class="String">&quot;/*&quot;</span> <span class="String">&quot;*/&quot;</span> <span class="String">&quot;c&quot;</span> <span class="VarId">s</span>
                 <span class="ConId">H</span> <span class="Symbol">-&gt;</span> <span class="VarId">readSource</span> <span class="String">&quot;/*&quot;</span> <span class="String">&quot;*/&quot;</span> <span class="String">&quot;c&quot;</span> <span class="VarId">s</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">setTitle</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Pandoc</span> <span class="Symbol">-&gt;</span> <span class="ConId">Pandoc</span>
<span class="Function">setTitle</span> <span class="VarId">t</span> <span class="Symbol">(</span><span class="ConId">Pandoc</span> <span class="VarId">m</span> <span class="VarId">bs</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="ConId">Pandoc</span> <span class="VarId">m'</span> <span class="VarId">bs</span>
    <span class="Keyword">where</span>
      <span class="VarId">m'</span> <span class="Symbol">=</span> <span class="VarId">m</span> <span class="Symbol">{</span><span class="VarId">docTitle</span> <span class="Symbol">=</span> <span class="Symbol">[</span><span class="ConId">Str</span> <span class="VarId">t</span><span class="Symbol">]}</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">toHtml</span> <span class="Symbol">::</span> <span class="ConId">Pandoc</span> <span class="Symbol">-&gt;</span> <span class="ConId">Html</span>
<span class="Function">toHtml</span> <span class="VarId">pa</span> <span class="Symbol">=</span> <span class="VarId">writeHtml</span> <span class="VarId">defaultWriterOptions</span> <span class="Symbol">{</span><span class="VarId">writerLiterateHaskell</span> <span class="Symbol">=</span> <span class="ConId">True</span><span class="Symbol">}</span> <span class="VarId">highlightCode</span>
    <span class="Keyword">where</span>
      <span class="VarId">highlightCode</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="VarId">pa</span> <span class="Keyword">of</span>
                          <span class="ConId">Pandoc</span> <span class="VarId">m</span> <span class="VarId">bs</span> <span class="Symbol">-&gt;</span> <span class="ConId">Pandoc</span> <span class="VarId">m</span> <span class="Symbol">(</span><span class="VarId">map</span> <span class="VarId">hi</span> <span class="VarId">bs</span><span class="Symbol">)</span>
      <span class="VarId">hi</span> <span class="Symbol">(</span><span class="ConId">CodeBlock</span> <span class="VarId">a</span> <span class="VarId">b</span><span class="Symbol">)</span> <span class="Symbol">|</span> <span class="ConId">Just</span> <span class="VarId">t</span> <span class="Symbol">&lt;-</span> <span class="VarId">getType</span> <span class="VarId">a</span> <span class="VarId">b</span> <span class="Symbol">=</span>
         <span class="Keyword">case</span> <span class="VarId">illuminate</span> <span class="VarId">t</span> <span class="VarId">b</span> <span class="Keyword">of</span>
           <span class="ConId">Right</span> <span class="VarId">result</span> <span class="Symbol">-&gt;</span> <span class="ConId">RawHtml</span> <span class="Symbol">$</span> <span class="VarId">getPres</span> <span class="VarId">a</span> <span class="Symbol">++</span> <span class="VarId">result</span> <span class="Symbol">++</span> <span class="VarId">getClosePres</span> <span class="VarId">a</span>
           <span class="ConId">Left</span>  <span class="VarId">err</span>    <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="String">&quot;Could not parse input: &quot;</span> <span class="Symbol">++</span> <span class="VarId">err</span>
      <span class="VarId">hi</span> <span class="VarId">x</span> <span class="Symbol">=</span> <span class="VarId">x</span>
      <span class="VarId">getClasses</span> <span class="Symbol">(</span><span class="VarId">_</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">_</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">x</span>
      <span class="VarId">getPres</span> <span class="VarId">a</span> <span class="Symbol">=</span> <span class="VarId">concatMap</span> <span class="Symbol">(\</span><span class="VarId">x</span> <span class="Symbol">-&gt;</span> <span class="String">&quot;&lt;div class='&quot;</span> <span class="Symbol">++</span> <span class="VarId">x</span> <span class="Symbol">++</span> <span class="String">&quot;'&gt;&quot;</span><span class="Symbol">)</span>  <span class="Symbol">$</span> <span class="VarId">getClasses</span> <span class="VarId">a</span>
      <span class="VarId">getClosePres</span> <span class="VarId">a</span> <span class="Symbol">=</span> <span class="VarId">concatMap</span> <span class="Symbol">(</span><span class="VarId">const</span> <span class="String">&quot;&lt;/div&gt;&quot;</span><span class="Symbol">)</span> <span class="Symbol">$</span> <span class="VarId">getClasses</span> <span class="VarId">a</span>
      <span class="VarId">getType</span> <span class="Symbol">(</span><span class="VarId">_</span><span class="Symbol">,</span><span class="VarId">x</span><span class="Symbol">,</span><span class="VarId">_</span><span class="Symbol">)</span> <span class="VarId">b</span> <span class="Symbol">=</span>
         <span class="Keyword">case</span> <span class="VarId">x</span> <span class="Keyword">of</span>
           <span class="Symbol">[]</span> <span class="Symbol">-&gt;</span> <span class="ConId">Nothing</span>
           <span class="VarId">_</span> <span class="Symbol">|</span> <span class="String">&quot;sql&quot;</span> <span class="Symbol">`</span><span class="VarId">elem</span><span class="Symbol">`</span> <span class="VarId">x</span>
               <span class="Symbol">||</span> <span class="String">&quot;SqlPostgresql&quot;</span> <span class="Symbol">`</span><span class="VarId">elem</span><span class="Symbol">`</span> <span class="VarId">x</span> <span class="Symbol">-&gt;</span> <span class="ConId">Just</span> <span class="String">&quot;sql&quot;</span>
             <span class="Symbol">|</span> <span class="String">&quot;haskell&quot;</span> <span class="Symbol">`</span><span class="VarId">elem</span><span class="Symbol">`</span> <span class="VarId">x</span> <span class="Symbol">-&gt;</span> <span class="ConId">Just</span> <span class="String">&quot;haskell&quot;</span>
             <span class="Symbol">|</span> <span class="String">&quot;sh&quot;</span> <span class="Symbol">`</span><span class="VarId">elem</span><span class="Symbol">`</span> <span class="VarId">x</span> <span class="Symbol">-&gt;</span> <span class="ConId">Just</span> <span class="String">&quot;sh&quot;</span>
             <span class="Symbol">|</span> <span class="String">&quot;c&quot;</span> <span class="Symbol">`</span><span class="VarId">elem</span><span class="Symbol">`</span> <span class="VarId">x</span> <span class="Symbol">-&gt;</span> <span class="ConId">Just</span> <span class="String">&quot;c&quot;</span>
             <span class="Symbol">|</span> <span class="String">&quot;chs&quot;</span> <span class="Symbol">`</span><span class="VarId">elem</span><span class="Symbol">`</span> <span class="VarId">x</span> <span class="Symbol">-&gt;</span> <span class="ConId">Just</span> <span class="String">&quot;haskell&quot;</span>
             <span class="Symbol">|</span> <span class="VarId">otherwise</span> <span class="Symbol">-&gt;</span> <span class="VarId">trace</span> <span class="Symbol">(</span><span class="String">&quot;unknown:&quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">x</span>
                                   <span class="Symbol">++</span> <span class="String">&quot;\n&quot;</span> <span class="Symbol">++</span> <span class="VarId">show</span> <span class="VarId">b</span><span class="Symbol">)</span> <span class="ConId">Nothing</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">wrapHtmlFragment</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Html</span> <span class="Symbol">-&gt;</span> <span class="ConId">Html</span>
<span class="Function">wrapHtmlFragment</span> <span class="VarId">ti</span> <span class="VarId">h</span> <span class="Symbol">=</span>
  <span class="VarId">header</span> <span class="Symbol">&lt;&lt;</span> <span class="Symbol">[</span><span class="VarId">t</span><span class="Symbol">,</span><span class="VarId">c</span><span class="Symbol">]</span>
  <span class="Symbol">+++</span> <span class="VarId">body</span> <span class="Symbol">&lt;&lt;</span> <span class="VarId">h</span>
  <span class="Keyword">where</span>
    <span class="VarId">t</span> <span class="Symbol">=</span> <span class="VarId">thetitle</span> <span class="Symbol">&lt;&lt;</span> <span class="VarId">ti</span>
    <span class="VarId">c</span> <span class="Symbol">=</span> <span class="VarId">thelink</span> <span class="Symbol">!</span> <span class="Symbol">[</span><span class="VarId">href</span> <span class="String">&quot;/website/main.css&quot;</span>
                  <span class="Symbol">,</span><span class="VarId">rel</span> <span class="String">&quot;stylesheet&quot;</span>
                  <span class="Symbol">,</span><span class="VarId">thetype</span> <span class="String">&quot;text/css&quot;</span><span class="Symbol">]</span> <span class="Symbol">&lt;&lt;</span> <span class="String">&quot;&quot;</span></pre></div></div></div><p
    >bit dodgy</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">filterLinks</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span>
<span class="Function">filterLinks</span> <span class="VarId">path</span> <span class="Symbol">=</span> <span class="VarId">replace</span>
                          <span class="String">&quot;\&quot;/website/&quot;</span>
                          <span class="Symbol">(</span><span class="Char">'&quot;'</span><span class="Symbol">:</span> <span class="VarId">path</span><span class="Symbol">)</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">toText</span> <span class="Symbol">::</span> <span class="ConId">Html</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span>
<span class="Function">toText</span> <span class="Symbol">=</span> <span class="VarId">renderHtml</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">process</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">FilePath</span> <span class="Symbol">-&gt;</span> <span class="ConId">OutputFile</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">process</span> <span class="VarId">_</span> <span class="VarId">_</span> <span class="VarId">_</span> <span class="Symbol">(</span><span class="ConId">OutputFile</span> <span class="Symbol">(</span><span class="ConId">File</span> <span class="VarId">f</span><span class="Symbol">)</span> <span class="ConId">Css</span> <span class="VarId">fp</span> <span class="VarId">_</span><span class="Symbol">)</span> <span class="Symbol">=</span>
  <span class="VarId">copyFile</span> <span class="VarId">f</span> <span class="VarId">fp</span>
<span class="Function">process</span> <span class="VarId">v</span> <span class="VarId">tm</span> <span class="VarId">b</span> <span class="Symbol">(</span><span class="ConId">OutputFile</span> <span class="VarId">s</span> <span class="VarId">t</span> <span class="VarId">fp</span> <span class="VarId">ti</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
  <span class="Keyword">let</span> <span class="VarId">hd</span> <span class="Symbol">=</span> <span class="VarId">wheader</span> <span class="VarId">v</span>
      <span class="VarId">ft</span> <span class="Symbol">=</span> <span class="VarId">wfooter</span> <span class="VarId">v</span> <span class="VarId">tm</span>
  <span class="VarId">flip</span> <span class="VarId">fmap</span> <span class="Symbol">(</span><span class="VarId">asText</span> <span class="VarId">s</span><span class="Symbol">)</span>
    <span class="Symbol">(</span><span class="VarId">toPandoc</span> <span class="VarId">t</span>
      <span class="Symbol">|&gt;</span> <span class="VarId">setTitle</span> <span class="VarId">ti</span>
      <span class="Symbol">|&gt;</span> <span class="VarId">toHtml</span>
      <span class="Symbol">|&gt;</span> <span class="Symbol">(\</span> <span class="VarId">h</span> <span class="Symbol">-&gt;</span> <span class="VarId">hd</span> <span class="Symbol">+++</span> <span class="VarId">h</span> <span class="Symbol">+++</span> <span class="VarId">ft</span><span class="Symbol">)</span>
      <span class="Symbol">|&gt;</span> <span class="VarId">wrapHtmlFragment</span> <span class="VarId">ti</span>
      <span class="Symbol">|&gt;</span> <span class="VarId">toText</span>
      <span class="Symbol">|&gt;</span> <span class="VarId">filterLinks</span> <span class="VarId">back</span><span class="Symbol">)</span>
    <span class="Symbol">&gt;&gt;=</span> <span class="VarId">writeFolderFile</span> <span class="VarId">fp</span>
  <span class="Keyword">where</span>
    <span class="VarId">relpath</span> <span class="Symbol">=</span> <span class="VarId">makeRelative</span> <span class="VarId">b</span> <span class="VarId">fp</span>
    <span class="VarId">back</span> <span class="Symbol">=</span> <span class="VarId">concat</span> <span class="Symbol">$</span> <span class="VarId">replicate</span> <span class="Symbol">(</span><span class="VarId">length</span> <span class="Symbol">$</span>
                      <span class="VarId">splitDirectories</span> <span class="Symbol">$</span>
                      <span class="VarId">dropFileName</span> <span class="VarId">relpath</span><span class="Symbol">)</span>
                     <span class="String">&quot;../&quot;</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">wheader</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Html</span>
<span class="Function">wheader</span> <span class="VarId">v</span> <span class="Symbol">=</span>
  <span class="VarId">thediv</span> <span class="Symbol">!</span> <span class="Symbol">[</span><span class="VarId">theclass</span> <span class="String">&quot;header&quot;</span><span class="Symbol">]</span>
      <span class="Symbol">&lt;&lt;</span> <span class="VarId">a</span>
  <span class="Symbol">+++</span> <span class="Symbol">[</span><span class="VarId">br</span><span class="Symbol">,</span><span class="VarId">br</span><span class="Symbol">,</span><span class="VarId">br</span><span class="Symbol">]</span>
  <span class="Keyword">where</span>
    <span class="VarId">a</span> <span class="Symbol">=</span> <span class="VarId">anchor</span> <span class="Symbol">!</span> <span class="Symbol">[</span><span class="VarId">href</span> <span class="String">&quot;/website/index.html&quot;</span><span class="Symbol">]</span>
                   <span class="Symbol">&lt;&lt;</span> <span class="Symbol">(</span><span class="String">&quot;HsSqlPpp-&quot;</span> <span class="Symbol">++</span> <span class="VarId">v</span><span class="Symbol">)</span></pre></div></div></div><p
    >todo: add the last modified time for each file individually</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">wfooter</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Html</span>
<span class="Function">wfooter</span> <span class="VarId">v</span> <span class="VarId">d</span> <span class="Symbol">=</span>
    <span class="Symbol">[</span><span class="VarId">br</span><span class="Symbol">,</span><span class="VarId">br</span><span class="Symbol">,</span><span class="VarId">br</span><span class="Symbol">]</span> <span class="Symbol">+++</span> <span class="VarId">di</span>
  <span class="Keyword">where</span>
    <span class="VarId">s</span> <span class="Symbol">=</span> <span class="String">&quot;generated on &quot;</span> <span class="Symbol">++</span> <span class="VarId">d</span> <span class="Symbol">++</span> <span class="String">&quot;, hssqlppp-&quot;</span> <span class="Symbol">++</span> <span class="VarId">v</span>
    <span class="VarId">di</span> <span class="Symbol">=</span> <span class="VarId">thediv</span> <span class="Symbol">!</span> <span class="Symbol">[</span><span class="VarId">theclass</span> <span class="String">&quot;footer&quot;</span><span class="Symbol">]</span> <span class="Symbol">&lt;&lt;</span> <span class="VarId">s</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">writeFolderFile</span> <span class="Symbol">::</span> <span class="ConId">FilePath</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">writeFolderFile</span> <span class="VarId">fp</span> <span class="VarId">t</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
  <span class="VarId">createDirectoryIfMissing</span> <span class="ConId">True</span> <span class="Symbol">$</span> <span class="VarId">dropFileName</span> <span class="VarId">fp</span>
  <span class="VarId">writeFile</span> <span class="VarId">fp</span> <span class="VarId">t</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">infixl</span> <span class="Number">9</span> <span class="Symbol">|&gt;</span>
<span class="Symbol">(|&gt;)</span> <span class="Symbol">::</span> <span class="Symbol">(</span><span class="VarId">a</span> <span class="Symbol">-&gt;</span> <span class="VarId">b</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span> <span class="Symbol">(</span><span class="VarId">b</span> <span class="Symbol">-&gt;</span> <span class="VarId">c</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span> <span class="VarId">a</span> <span class="Symbol">-&gt;</span> <span class="VarId">c</span>
<span class="Symbol">(|&gt;)</span> <span class="Symbol">=</span> <span class="VarId">flip</span> <span class="Symbol">(.)</span></pre></div></div></div><p
    >add some sample files: ag lhs hs txt sql show the pandoc ast try illuminate, need to write sql highlighter?</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">{-ppExpr :: Show s =&gt; s -&gt; String</span>
<span class="Comment">ppExpr s =</span>
<span class="Comment">  case Exts.parseExp (show s) of</span>
<span class="Comment">    Exts.ParseOk ast -&gt; Exts.prettyPrint ast</span>
<span class="Comment">    x -&gt; error $ show x-}</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">-- pure wrappers to do various rendering</span>
<span class="Function">readMd</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Pandoc</span>
<span class="Function">readMd</span> <span class="Symbol">=</span> <span class="VarId">readMarkdown</span> <span class="VarId">defaultParserState</span>

<span class="Function">readLhs</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Pandoc</span>
<span class="Function">readLhs</span> <span class="Symbol">=</span> <span class="VarId">readMarkdown</span> <span class="VarId">ropt</span>
  <span class="Keyword">where</span>
    <span class="VarId">ropt</span> <span class="Symbol">=</span> <span class="VarId">defaultParserState</span> <span class="Symbol">{</span>
            <span class="VarId">stateLiterateHaskell</span> <span class="Symbol">=</span> <span class="ConId">True</span>
           <span class="Symbol">}</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">readSource</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Pandoc</span>
<span class="Function">readSource</span> <span class="VarId">sc</span> <span class="VarId">ec</span> <span class="VarId">ty</span> <span class="VarId">txt</span> <span class="Symbol">=</span> <span class="VarId">either</span> <span class="VarId">err</span> <span class="VarId">id</span> <span class="Symbol">$</span> <span class="Keyword">do</span>
    <span class="VarId">ccs</span> <span class="Symbol">&lt;-</span> <span class="VarId">parseSource</span> <span class="VarId">sc</span> <span class="VarId">ec</span> <span class="VarId">txt</span>
    <span class="VarId">return</span> <span class="Symbol">$</span> <span class="VarId">convl</span> <span class="VarId">ccs</span>
    <span class="Keyword">where</span>
      <span class="VarId">err</span> <span class="VarId">e</span> <span class="Symbol">=</span> <span class="VarId">trace</span> <span class="Symbol">(</span><span class="VarId">show</span> <span class="VarId">e</span><span class="Symbol">)</span> <span class="Symbol">$</span> <span class="VarId">w</span> <span class="Symbol">$</span> <span class="VarId">cb</span> <span class="VarId">txt</span>
      <span class="VarId">convl</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">Cc</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">Pandoc</span>
      <span class="VarId">convl</span> <span class="VarId">cs</span> <span class="Symbol">=</span> <span class="VarId">w</span> <span class="Symbol">$</span> <span class="VarId">concatMap</span> <span class="VarId">conv</span> <span class="VarId">cs</span>
      <span class="VarId">conv</span> <span class="Symbol">::</span> <span class="ConId">Cc</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="ConId">Block</span><span class="Symbol">]</span>
      <span class="VarId">conv</span> <span class="Symbol">(</span><span class="ConId">Parser.Code</span> <span class="VarId">c</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">cb</span> <span class="VarId">c</span>
      <span class="VarId">conv</span> <span class="Symbol">(</span><span class="ConId">Comments</span> <span class="VarId">m</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="VarId">readMarkdown</span> <span class="VarId">defaultParserState</span> <span class="VarId">m</span> <span class="Keyword">of</span>
                           <span class="ConId">Pandoc</span> <span class="VarId">_</span> <span class="VarId">b</span> <span class="Symbol">-&gt;</span> <span class="VarId">b</span>
      <span class="VarId">cb</span> <span class="VarId">s</span> <span class="Symbol">=</span> <span class="Symbol">[</span><span class="ConId">CodeBlock</span> <span class="Symbol">(</span><span class="String">&quot;&quot;</span><span class="Symbol">,</span> <span class="Symbol">[</span><span class="String">&quot;sourceCode&quot;</span><span class="Symbol">,</span> <span class="String">&quot;literate&quot;</span><span class="Symbol">,</span> <span class="VarId">ty</span><span class="Symbol">],</span> <span class="Symbol">[])</span> <span class="VarId">s</span><span class="Symbol">]</span>
      <span class="VarId">w</span> <span class="Symbol">=</span> <span class="ConId">Pandoc</span> <span class="ConId">Meta</span> <span class="Symbol">{</span><span class="VarId">docTitle</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">docAuthors</span> <span class="Symbol">=</span> <span class="Symbol">[],</span> <span class="VarId">docDate</span> <span class="Symbol">=</span> <span class="Symbol">[]}</span></pre></div></div></div><p
    >todo: do hack for =,==,etc. headers do hack for sql strings in haskell? add css add anchors filter relative links titles copyright header footer navigation, sitemap, breadcrumbs</p
    ><p
    >================================================</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">illuminate</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Either</span> <span class="ConId">String</span> <span class="ConId">String</span>
<span class="Function">illuminate</span> <span class="VarId">ty</span> <span class="VarId">txt</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
    <span class="Keyword">let</span> <span class="VarId">lexer</span> <span class="Symbol">=</span> <span class="VarId">lexerByName</span> <span class="VarId">ty</span>
    <span class="VarId">tokens</span> <span class="Symbol">&lt;-</span> <span class="VarId">tokenize</span> <span class="VarId">lexer</span> <span class="VarId">txt</span>
    <span class="Keyword">let</span> <span class="VarId">html</span> <span class="Symbol">=</span> <span class="VarId">toXHtmlCSS</span> <span class="VarId">defaultOptions</span> <span class="VarId">tokens</span>
    <span class="VarId">return</span> <span class="Symbol">$</span> <span class="VarId">showHtmlFragment</span> <span class="VarId">html</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">replace</span> <span class="Symbol">::</span> <span class="Symbol">(</span><span class="ConId">Eq</span> <span class="VarId">a</span><span class="Symbol">)</span> <span class="Symbol">=&gt;</span> <span class="Symbol">[</span><span class="VarId">a</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="VarId">a</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="VarId">a</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="VarId">a</span><span class="Symbol">]</span>
<span class="Function">replace</span> <span class="VarId">_</span> <span class="VarId">_</span> <span class="Symbol">[]</span> <span class="Symbol">=</span> <span class="Symbol">[]</span>
<span class="Function">replace</span> <span class="VarId">old</span> <span class="VarId">new</span> <span class="VarId">xs</span><span class="Symbol">@(</span><span class="VarId">y</span><span class="Symbol">:</span><span class="VarId">ys</span><span class="Symbol">)</span> <span class="Symbol">=</span>
  <span class="Keyword">case</span> <span class="VarId">stripPrefix</span> <span class="VarId">old</span> <span class="VarId">xs</span> <span class="Keyword">of</span>
    <span class="ConId">Nothing</span> <span class="Symbol">-&gt;</span> <span class="VarId">y</span> <span class="Symbol">:</span> <span class="VarId">replace</span> <span class="VarId">old</span> <span class="VarId">new</span> <span class="VarId">ys</span>
    <span class="ConId">Just</span> <span class="VarId">ys'</span> <span class="Symbol">-&gt;</span> <span class="VarId">new</span> <span class="Symbol">++</span> <span class="VarId">replace</span> <span class="VarId">old</span> <span class="VarId">new</span> <span class="VarId">ys'</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">waitForChildren</span> <span class="Symbol">::</span> <span class="ConId">MVar</span> <span class="Symbol">[</span><span class="ConId">MVar</span> <span class="Symbol">()]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span>
<span class="Function">waitForChildren</span> <span class="VarId">children</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
  <span class="VarId">cs</span> <span class="Symbol">&lt;-</span> <span class="VarId">takeMVar</span> <span class="VarId">children</span>
  <span class="Keyword">case</span> <span class="VarId">cs</span> <span class="Keyword">of</span>
       <span class="Symbol">[]</span>   <span class="Symbol">-&gt;</span> <span class="VarId">return</span> <span class="Symbol">()</span>
       <span class="VarId">m</span><span class="Symbol">:</span><span class="VarId">ms</span> <span class="Symbol">-&gt;</span> <span class="Keyword">do</span>
          <span class="VarId">putMVar</span> <span class="VarId">children</span> <span class="VarId">ms</span>
          <span class="VarId">takeMVar</span> <span class="VarId">m</span>
          <span class="VarId">waitForChildren</span> <span class="VarId">children</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">forkChild</span> <span class="Symbol">::</span> <span class="ConId">MVar</span> <span class="Symbol">[</span><span class="ConId">MVar</span> <span class="Symbol">()]</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">()</span> <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="ConId">ThreadId</span>
<span class="Function">forkChild</span> <span class="VarId">children</span> <span class="VarId">io</span> <span class="Symbol">=</span> <span class="Keyword">do</span>
       <span class="VarId">mvar</span> <span class="Symbol">&lt;-</span> <span class="VarId">newEmptyMVar</span>
       <span class="VarId">childs</span> <span class="Symbol">&lt;-</span> <span class="VarId">takeMVar</span> <span class="VarId">children</span>
       <span class="VarId">putMVar</span> <span class="VarId">children</span> <span class="Symbol">(</span><span class="VarId">mvar</span><span class="Symbol">:</span><span class="VarId">childs</span><span class="Symbol">)</span>
       <span class="VarId">forkIO</span> <span class="Symbol">(</span><span class="VarId">io</span> <span class="Symbol">`</span><span class="VarId">finally</span><span class="Symbol">`</span> <span class="VarId">putMVar</span> <span class="VarId">mvar</span> <span class="Symbol">())</span></pre></div></div></div><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/31/11 20:00:52, hssqlppp-0.3.0</div
    ></body
  ></html
>
