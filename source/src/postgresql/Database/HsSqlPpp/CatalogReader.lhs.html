<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >CatalogReader</title
    ><link href="../../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../../index.txt.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><p
    >This module contains the code to read a set of catalog updates from a database.</p
    ><p
    >The code here hasn't been tidied up since the Catalog data type was heavily changed so it's a bit messy.</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">{-# LANGUAGE QuasiQuotes #-}</span>

<span class="Keyword">module</span> <span class="ConId">Database.HsSqlPpp.CatalogReader</span>
    <span class="Symbol">(</span><span class="VarId">readCatalogFromDatabase</span><span class="Symbol">)</span> <span class="Keyword">where</span>

<span class="Keyword">import</span> <span class="Keyword">qualified</span> <span class="ConId">Data.Map</span> <span class="Keyword">as</span> <span class="ConId">M</span>
<span class="Keyword">import</span> <span class="ConId">Data.Maybe</span>
<span class="Keyword">import</span> <span class="ConId">Control.Applicative</span>
<span class="Comment">--import Debug.Trace</span>

<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.AstInternals.TypeType</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Utils.Utils</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Utils.Here</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.AstInternals.Catalog.CatalogInternal</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Utils.DbmsCommon</span>

<span class="Comment">-- | Creates an 'CatalogUpdate' list by reading the database given.</span>
<span class="Comment">-- To create an Catalog value from this, use</span>
<span class="Symbol">--</span>
<span class="Comment">-- @</span>
<span class="Comment">-- cat &lt;- readCatalogFromDatabase 'something'</span>
<span class="Comment">-- let newCat = updateCatalog defaultCatalog cat</span>
<span class="Comment">-- @</span>
<span class="Function">readCatalogFromDatabase</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Comment">-- ^ name of the database to read</span>
                            <span class="Symbol">-&gt;</span> <span class="ConId">IO</span> <span class="Symbol">[</span><span class="ConId">CatalogUpdate</span><span class="Symbol">]</span>
<span class="Function">readCatalogFromDatabase</span> <span class="VarId">dbName</span> <span class="Symbol">=</span> <span class="VarId">withConn</span> <span class="Symbol">(</span><span class="String">&quot;dbname=&quot;</span> <span class="Symbol">++</span> <span class="VarId">dbName</span><span class="Symbol">)</span> <span class="Symbol">$</span> <span class="Symbol">\</span><span class="VarId">conn</span> <span class="Symbol">-&gt;</span> <span class="Keyword">do</span>
   <span class="VarId">typeInfo</span> <span class="Symbol">&lt;-</span> <span class="VarId">selectRelation</span> <span class="VarId">conn</span> <span class="Symbol">[$</span><span class="VarId">here</span><span class="Symbol">|</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">
<span class="Function">select</span> <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">oid</span> <span class="Keyword">as</span> <span class="VarId">oid</span><span class="Symbol">,</span>
       <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">typtype</span><span class="Symbol">,</span>
       <span class="Keyword">case</span> <span class="VarId">nspname</span>
         <span class="VarId">when</span> '<span class="VarId">public'</span> <span class="Keyword">then</span> <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">typname</span>
         <span class="VarId">when</span> '<span class="VarId">pg_catalog'</span> <span class="Keyword">then</span> <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">typname</span>
         <span class="Keyword">else</span> <span class="VarId">nspname</span> <span class="Symbol">||</span> <span class="Char">'.'</span> <span class="Symbol">||</span> <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">typname</span>
       <span class="VarId">end</span> <span class="Keyword">as</span> <span class="VarId">typname</span><span class="Symbol">,</span>
       <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">typarray</span><span class="Symbol">,</span>
       <span class="VarId">coalesce</span><span class="Symbol">(</span><span class="VarId">e</span><span class="Symbol">.</span><span class="VarId">typtype</span><span class="Symbol">,</span><span class="Char">'0'</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">atyptype</span><span class="Symbol">,</span>
       <span class="VarId">e</span><span class="Symbol">.</span><span class="VarId">oid</span> <span class="Keyword">as</span> <span class="VarId">aoid</span><span class="Symbol">,</span>
       <span class="VarId">e</span><span class="Symbol">.</span><span class="VarId">typname</span> <span class="Keyword">as</span> <span class="VarId">atypname</span>
  <span class="VarId">from</span> <span class="VarId">pg_catalog</span><span class="Symbol">.</span><span class="VarId">pg_type</span> <span class="VarId">t</span>
  <span class="VarId">left</span> <span class="VarId">outer</span> <span class="VarId">join</span> <span class="VarId">pg_type</span> <span class="VarId">e</span>
    <span class="VarId">on</span> <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">typarray</span> <span class="Symbol">=</span> <span class="VarId">e</span><span class="Symbol">.</span><span class="VarId">oid</span>
   <span class="VarId">inner</span> <span class="VarId">join</span> <span class="VarId">pg_namespace</span> <span class="VarId">ns</span>
      <span class="VarId">on</span> <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">typnamespace</span> <span class="Symbol">=</span> <span class="VarId">ns</span><span class="Symbol">.</span><span class="VarId">oid</span>
         <span class="VarId">and</span> <span class="VarId">ns</span><span class="Symbol">.</span><span class="VarId">nspname</span> <span class="Keyword">in</span> <span class="Symbol">(</span>'<span class="VarId">pg_catalog'</span>
                           <span class="Symbol">,</span>'<span class="VarId">public'</span>
                           <span class="Symbol">,</span>'<span class="VarId">information_schema'</span><span class="Symbol">)</span>
  <span class="Keyword">where</span> <span class="Symbol">/*</span><span class="VarId">pg_catalog</span><span class="Symbol">.</span><span class="VarId">pg_type_is_visible</span><span class="Symbol">(</span><span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">)</span>
   <span class="VarId">and</span> <span class="Symbol">*/</span><span class="VarId">not</span> <span class="VarId">exists</span><span class="Symbol">(</span><span class="VarId">select</span> <span class="Number">1</span> <span class="VarId">from</span> <span class="VarId">pg_catalog</span><span class="Symbol">.</span><span class="VarId">pg_type</span> <span class="VarId">el</span>
                       <span class="Keyword">where</span> <span class="VarId">el</span><span class="Symbol">.</span><span class="VarId">typarray</span> <span class="Symbol">=</span> <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">)</span>
  <span class="VarId">order</span> <span class="VarId">by</span> <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">typname</span><span class="Symbol">;</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">               <span class="Symbol">|]</span> <span class="Symbol">[]</span>
   <span class="Keyword">let</span> <span class="VarId">typeStuff</span> <span class="Symbol">=</span> <span class="VarId">concatMap</span> <span class="VarId">convTypeInfoRow</span> <span class="VarId">typeInfo</span>
       <span class="VarId">typeAssoc</span> <span class="Symbol">=</span> <span class="VarId">map</span> <span class="Symbol">(\(</span><span class="VarId">a</span><span class="Symbol">,</span><span class="VarId">b</span><span class="Symbol">,</span><span class="VarId">_</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span> <span class="Symbol">(</span><span class="VarId">a</span><span class="Symbol">,</span><span class="VarId">b</span><span class="Symbol">))</span> <span class="VarId">typeStuff</span>
       <span class="VarId">typeMap</span> <span class="Symbol">=</span> <span class="ConId">M.</span><span class="VarId">fromList</span> <span class="VarId">typeAssoc</span>
   <span class="VarId">cts</span> <span class="Symbol">&lt;-</span> <span class="VarId">map</span> <span class="Symbol">(\(</span><span class="VarId">nm</span><span class="Symbol">:</span><span class="VarId">cat</span><span class="Symbol">:</span><span class="VarId">pref</span><span class="Symbol">:[])</span> <span class="Symbol">-&gt;</span>
               <span class="ConId">CatCreateScalar</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="VarId">nm</span><span class="Symbol">)</span> <span class="VarId">cat</span> <span class="Symbol">(</span> <span class="VarId">read</span> <span class="VarId">pref</span> <span class="Symbol">::</span> <span class="ConId">Bool</span><span class="Symbol">))</span> <span class="Symbol">&lt;$&gt;</span>
          <span class="VarId">selectRelation</span> <span class="VarId">conn</span> <span class="Symbol">[$</span><span class="VarId">here</span><span class="Symbol">|</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">
<span class="Function">select</span> <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">typname</span><span class="Symbol">,</span><span class="VarId">typcategory</span><span class="Symbol">,</span><span class="VarId">typispreferred</span>
<span class="Function">from</span> <span class="VarId">pg_type</span> <span class="VarId">t</span>
   <span class="VarId">inner</span> <span class="VarId">join</span> <span class="VarId">pg_namespace</span> <span class="VarId">ns</span>
      <span class="VarId">on</span> <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">typnamespace</span> <span class="Symbol">=</span> <span class="VarId">ns</span><span class="Symbol">.</span><span class="VarId">oid</span>
         <span class="VarId">and</span> <span class="VarId">ns</span><span class="Symbol">.</span><span class="VarId">nspname</span> <span class="Keyword">in</span> <span class="Symbol">(</span>'<span class="VarId">pg_catalog'</span><span class="Symbol">,</span> '<span class="VarId">public'</span><span class="Symbol">,</span> '<span class="VarId">information_schema'</span><span class="Symbol">)</span>
<span class="Keyword">where</span> <span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">typarray</span><span class="Symbol">&lt;&gt;</span><span class="Number">0</span> <span class="VarId">and</span>
    <span class="VarId">typtype</span><span class="Symbol">=</span><span class="Char">'b'</span> <span class="Symbol">/*</span><span class="VarId">and</span>
    <span class="VarId">pg_catalog</span><span class="Symbol">.</span><span class="VarId">pg_type_is_visible</span><span class="Symbol">(</span><span class="VarId">t</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">)*/;</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">               <span class="Symbol">|]</span> <span class="Symbol">[]</span>
   <span class="VarId">domainDefInfo</span> <span class="Symbol">&lt;-</span> <span class="VarId">selectRelation</span> <span class="VarId">conn</span> <span class="Symbol">[$</span><span class="VarId">here</span><span class="Symbol">|</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">
<span class="Function">select</span> <span class="VarId">pg_type</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">,</span> <span class="VarId">typbasetype</span>
  <span class="VarId">from</span> <span class="VarId">pg_type</span>
  <span class="VarId">inner</span> <span class="VarId">join</span> <span class="VarId">pg_namespace</span> <span class="VarId">ns</span>
      <span class="VarId">on</span> <span class="VarId">pg_type</span><span class="Symbol">.</span><span class="VarId">typnamespace</span> <span class="Symbol">=</span> <span class="VarId">ns</span><span class="Symbol">.</span><span class="VarId">oid</span>
         <span class="VarId">and</span> <span class="VarId">ns</span><span class="Symbol">.</span><span class="VarId">nspname</span> <span class="Keyword">in</span> <span class="Symbol">(</span>'<span class="VarId">pg_catalog'</span><span class="Symbol">,</span> '<span class="VarId">public'</span><span class="Symbol">,</span> '<span class="VarId">information_schema'</span><span class="Symbol">)</span>
 <span class="Keyword">where</span> <span class="VarId">typtype</span> <span class="Symbol">=</span> <span class="Char">'d'</span>
     <span class="Symbol">/*</span><span class="VarId">and</span>  <span class="VarId">pg_catalog</span><span class="Symbol">.</span><span class="VarId">pg_type_is_visible</span><span class="Symbol">(</span><span class="VarId">oid</span><span class="Symbol">)*/;</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">               <span class="Symbol">|]</span> <span class="Symbol">[]</span>
   <span class="Keyword">let</span> <span class="VarId">jlt</span> <span class="VarId">k</span> <span class="Symbol">=</span> <span class="VarId">fromJust</span> <span class="Symbol">$</span> <span class="ConId">M.</span><span class="VarId">lookup</span> <span class="VarId">k</span> <span class="VarId">typeMap</span>
   <span class="Keyword">let</span> <span class="VarId">domainDefs</span> <span class="Symbol">=</span> <span class="VarId">map</span> <span class="Symbol">(\</span><span class="VarId">l</span> <span class="Symbol">-&gt;</span> <span class="Symbol">(</span><span class="VarId">jlt</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">0</span><span class="Symbol">),</span>  <span class="VarId">jlt</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">1</span><span class="Symbol">)))</span> <span class="VarId">domainDefInfo</span>
   <span class="Comment">--let domainCasts = map (\(t,b) -&gt;(t,b,ImplicitCastContext)) domainDefs</span>
   <span class="VarId">castInfo</span> <span class="Symbol">&lt;-</span> <span class="VarId">selectRelation</span> <span class="VarId">conn</span>
                 <span class="String">&quot;select castsource,casttarget,castcontext from pg_cast;&quot;</span> <span class="Symbol">[]</span>
   <span class="Keyword">let</span> <span class="VarId">casts</span> <span class="Symbol">=</span>
     <span class="Comment">{- domainCasts ++ -}</span>
         <span class="VarId">flip</span> <span class="VarId">map</span> <span class="VarId">castInfo</span>
              <span class="Symbol">(\</span><span class="VarId">l</span> <span class="Symbol">-&gt;</span> <span class="Symbol">(</span><span class="VarId">jlt</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">0</span><span class="Symbol">)</span>
                     <span class="Symbol">,</span><span class="VarId">jlt</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">1</span><span class="Symbol">)</span>
                     <span class="Symbol">,</span><span class="Keyword">case</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">2</span><span class="Symbol">)</span> <span class="Keyword">of</span>
                                  <span class="String">&quot;a&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">AssignmentCastContext</span>
                                  <span class="String">&quot;i&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">ImplicitCastContext</span>
                                  <span class="String">&quot;e&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">ExplicitCastContext</span>
                                  <span class="VarId">_</span> <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="String">&quot;internal error: unknown \
                                               \cast context &quot;</span> <span class="Symbol">++</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">2</span><span class="Symbol">)))</span>
   <span class="VarId">operatorInfo</span> <span class="Symbol">&lt;-</span> <span class="VarId">selectRelation</span> <span class="VarId">conn</span> <span class="Symbol">[$</span><span class="VarId">here</span><span class="Symbol">|</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">
<span class="Function">select</span> <span class="VarId">oprname</span><span class="Symbol">,</span>
       <span class="VarId">oprleft</span><span class="Symbol">,</span>
       <span class="VarId">oprright</span><span class="Symbol">,</span>
       <span class="VarId">oprresult</span>
<span class="Function">from</span> <span class="VarId">pg_operator</span>
      <span class="Keyword">where</span> <span class="VarId">not</span> <span class="Symbol">(</span><span class="VarId">oprleft</span> <span class="Symbol">&lt;&gt;</span> <span class="Number">0</span> <span class="VarId">and</span> <span class="VarId">oprright</span> <span class="Symbol">&lt;&gt;</span> <span class="Number">0</span>
         <span class="VarId">and</span> <span class="VarId">oprname</span> <span class="Symbol">=</span> <span class="Char">'@'</span><span class="Symbol">)</span> <span class="Comment">--hack for now</span>
      <span class="VarId">order</span> <span class="VarId">by</span> <span class="VarId">oprname</span><span class="Symbol">;</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">               <span class="Symbol">|]</span> <span class="Symbol">[]</span>
   <span class="Keyword">let</span> <span class="VarId">getOps</span> <span class="VarId">a</span> <span class="VarId">b</span> <span class="VarId">c</span> <span class="Symbol">[]</span> <span class="Symbol">=</span> <span class="Symbol">(</span><span class="VarId">a</span><span class="Symbol">,</span><span class="VarId">b</span><span class="Symbol">,</span><span class="VarId">c</span><span class="Symbol">)</span>
       <span class="VarId">getOps</span> <span class="VarId">pref</span> <span class="VarId">post</span> <span class="VarId">bin</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">:</span><span class="VarId">ls</span><span class="Symbol">)</span> <span class="Symbol">=</span>
         <span class="Keyword">let</span> <span class="VarId">bit</span> <span class="Symbol">=</span> <span class="Symbol">(\</span><span class="VarId">a</span> <span class="Symbol">-&gt;</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">0</span><span class="Symbol">,</span> <span class="VarId">a</span><span class="Symbol">,</span> <span class="VarId">jlt</span><span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">3</span><span class="Symbol">)))</span>
         <span class="Keyword">in</span> <span class="Keyword">case</span> <span class="Symbol">()</span> <span class="Keyword">of</span>
                  <span class="VarId">_</span> <span class="Symbol">|</span> <span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">1</span> <span class="Symbol">==</span> <span class="String">&quot;0&quot;</span>
                        <span class="Symbol">-&gt;</span> <span class="VarId">getOps</span> <span class="Symbol">(</span><span class="VarId">bit</span> <span class="Symbol">[</span><span class="VarId">jlt</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">2</span><span class="Symbol">)]:</span><span class="VarId">pref</span><span class="Symbol">)</span> <span class="VarId">post</span> <span class="VarId">bin</span> <span class="VarId">ls</span>
                    <span class="Symbol">|</span> <span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">2</span> <span class="Symbol">==</span> <span class="String">&quot;0&quot;</span>
                        <span class="Symbol">-&gt;</span> <span class="VarId">getOps</span> <span class="VarId">pref</span> <span class="Symbol">(</span><span class="VarId">bit</span> <span class="Symbol">[</span><span class="VarId">jlt</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">1</span><span class="Symbol">)]:</span><span class="VarId">post</span><span class="Symbol">)</span> <span class="VarId">bin</span> <span class="VarId">ls</span>
                    <span class="Symbol">|</span> <span class="VarId">otherwise</span> <span class="Symbol">-&gt;</span> <span class="VarId">getOps</span> <span class="VarId">pref</span> <span class="VarId">post</span> <span class="Symbol">(</span><span class="VarId">bit</span> <span class="Symbol">[</span><span class="VarId">jlt</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">1</span><span class="Symbol">)</span>
                                                         <span class="Symbol">,</span><span class="VarId">jlt</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">2</span><span class="Symbol">)]:</span><span class="VarId">bin</span><span class="Symbol">)</span> <span class="VarId">ls</span>
   <span class="Keyword">let</span> <span class="Symbol">(</span><span class="VarId">prefixOps</span><span class="Symbol">,</span> <span class="VarId">postfixOps</span><span class="Symbol">,</span> <span class="VarId">binaryOps</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">getOps</span> <span class="Symbol">[]</span> <span class="Symbol">[]</span> <span class="Symbol">[]</span> <span class="VarId">operatorInfo</span>
   <span class="VarId">functionInfo</span> <span class="Symbol">&lt;-</span> <span class="VarId">selectRelation</span> <span class="VarId">conn</span> <span class="Symbol">[$</span><span class="VarId">here</span><span class="Symbol">|</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">
<span class="Function">select</span> <span class="VarId">proname</span><span class="Symbol">,</span>
       <span class="VarId">array_to_string</span><span class="Symbol">(</span><span class="VarId">proargtypes</span><span class="Symbol">,</span><span class="Char">','</span><span class="Symbol">),</span>
       <span class="VarId">proretset</span><span class="Symbol">,</span>
       <span class="VarId">prorettype</span>
<span class="Function">from</span> <span class="VarId">pg_proc</span>
<span class="Keyword">where</span> <span class="VarId">pg_catalog</span><span class="Symbol">.</span><span class="VarId">pg_function_is_visible</span><span class="Symbol">(</span><span class="VarId">pg_proc</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">)</span>
      <span class="VarId">and</span> <span class="VarId">provariadic</span> <span class="Symbol">=</span> <span class="Number">0</span>
      <span class="VarId">and</span> <span class="VarId">not</span> <span class="VarId">proisagg</span>
      <span class="VarId">and</span> <span class="VarId">not</span> <span class="VarId">proiswindow</span>
<span class="Function">order</span> <span class="VarId">by</span> <span class="VarId">proname</span><span class="Symbol">,</span><span class="VarId">proargtypes</span><span class="Symbol">;</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">               <span class="Symbol">|]</span> <span class="Symbol">[]</span>
   <span class="Keyword">let</span> <span class="VarId">fnProts</span> <span class="Symbol">=</span> <span class="VarId">map</span> <span class="Symbol">(</span><span class="VarId">convFnRow</span> <span class="VarId">jlt</span><span class="Symbol">)</span> <span class="VarId">functionInfo</span>
   <span class="VarId">aggregateInfo</span> <span class="Symbol">&lt;-</span> <span class="VarId">selectRelation</span> <span class="VarId">conn</span> <span class="Symbol">[$</span><span class="VarId">here</span><span class="Symbol">|</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">
<span class="Function">select</span> <span class="VarId">proname</span><span class="Symbol">,</span>
       <span class="VarId">array_to_string</span><span class="Symbol">(</span><span class="VarId">proargtypes</span><span class="Symbol">,</span><span class="Char">','</span><span class="Symbol">),</span>
       <span class="VarId">proretset</span><span class="Symbol">,</span>
       <span class="VarId">prorettype</span>
<span class="Function">from</span> <span class="VarId">pg_proc</span>
<span class="Keyword">where</span> <span class="VarId">pg_catalog</span><span class="Symbol">.</span><span class="VarId">pg_function_is_visible</span><span class="Symbol">(</span><span class="VarId">pg_proc</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">)</span>
      <span class="VarId">and</span> <span class="VarId">provariadic</span> <span class="Symbol">=</span> <span class="Number">0</span>
      <span class="VarId">and</span> <span class="VarId">proisagg</span>
<span class="Function">order</span> <span class="VarId">by</span> <span class="VarId">proname</span><span class="Symbol">,</span><span class="VarId">proargtypes</span><span class="Symbol">;</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">               <span class="Symbol">|]</span> <span class="Symbol">[]</span>
   <span class="Keyword">let</span> <span class="VarId">aggProts</span> <span class="Symbol">=</span> <span class="VarId">map</span> <span class="Symbol">(</span><span class="VarId">convFnRow</span> <span class="VarId">jlt</span><span class="Symbol">)</span> <span class="VarId">aggregateInfo</span>
   <span class="VarId">windowInfo</span> <span class="Symbol">&lt;-</span> <span class="VarId">selectRelation</span> <span class="VarId">conn</span> <span class="Symbol">[$</span><span class="VarId">here</span><span class="Symbol">|</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">
<span class="Function">select</span> <span class="VarId">proname</span><span class="Symbol">,</span>
       <span class="VarId">array_to_string</span><span class="Symbol">(</span><span class="VarId">proargtypes</span><span class="Symbol">,</span><span class="Char">','</span><span class="Symbol">),</span>
       <span class="VarId">proretset</span><span class="Symbol">,</span>
       <span class="VarId">prorettype</span>
<span class="Function">from</span> <span class="VarId">pg_proc</span>
<span class="Keyword">where</span> <span class="VarId">pg_catalog</span><span class="Symbol">.</span><span class="VarId">pg_function_is_visible</span><span class="Symbol">(</span><span class="VarId">pg_proc</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">)</span>
      <span class="VarId">and</span> <span class="VarId">provariadic</span> <span class="Symbol">=</span> <span class="Number">0</span>
      <span class="VarId">and</span> <span class="VarId">proiswindow</span>
<span class="Function">order</span> <span class="VarId">by</span> <span class="VarId">proname</span><span class="Symbol">,</span><span class="VarId">proargtypes</span><span class="Symbol">;</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">               <span class="Symbol">|]</span> <span class="Symbol">[]</span>
   <span class="Keyword">let</span> <span class="VarId">winProts</span> <span class="Symbol">=</span> <span class="VarId">map</span> <span class="Symbol">(</span><span class="VarId">convFnRow</span> <span class="VarId">jlt</span><span class="Symbol">)</span> <span class="VarId">windowInfo</span>
   <span class="VarId">comps</span> <span class="Symbol">&lt;-</span> <span class="VarId">map</span> <span class="Symbol">(\(</span><span class="VarId">kind</span><span class="Symbol">:</span><span class="VarId">nm</span><span class="Symbol">:</span><span class="VarId">atts</span><span class="Symbol">:</span><span class="VarId">sysatts</span><span class="Symbol">:</span><span class="VarId">nsp</span><span class="Symbol">:[])</span> <span class="Symbol">-&gt;</span>
             <span class="Keyword">let</span> <span class="VarId">nm1</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="VarId">nsp</span> <span class="Keyword">of</span>
                                <span class="String">&quot;pg_catalog&quot;</span> <span class="Symbol">-&gt;</span> <span class="VarId">nm</span>
                                <span class="String">&quot;public&quot;</span> <span class="Symbol">-&gt;</span> <span class="VarId">nm</span>
                                <span class="VarId">n</span> <span class="Symbol">-&gt;</span> <span class="VarId">n</span> <span class="Symbol">++</span> <span class="String">&quot;.&quot;</span> <span class="Symbol">++</span> <span class="VarId">nm</span>
             <span class="Keyword">in</span> <span class="Keyword">case</span> <span class="VarId">kind</span> <span class="Keyword">of</span>
                    <span class="String">&quot;c&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">CatCreateComposite</span> <span class="VarId">nm1</span> <span class="Symbol">(</span><span class="VarId">convertAttString</span> <span class="VarId">jlt</span> <span class="VarId">atts</span><span class="Symbol">)</span>
                    <span class="String">&quot;r&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">CatCreateTable</span> <span class="VarId">nm1</span> <span class="Symbol">(</span><span class="VarId">convertAttString</span> <span class="VarId">jlt</span> <span class="VarId">atts</span><span class="Symbol">)</span>
                                              <span class="Symbol">(</span><span class="VarId">convertAttString</span> <span class="VarId">jlt</span> <span class="VarId">sysatts</span><span class="Symbol">)</span>
                    <span class="String">&quot;v&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">CatCreateView</span> <span class="VarId">nm1</span> <span class="Symbol">(</span><span class="VarId">convertAttString</span> <span class="VarId">jlt</span> <span class="VarId">atts</span><span class="Symbol">)</span>
                    <span class="VarId">_</span> <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="String">&quot;unrecognised relkind: &quot;</span> <span class="Symbol">++</span> <span class="VarId">kind</span><span class="Symbol">)</span> <span class="Symbol">&lt;$&gt;</span>
                <span class="VarId">selectRelation</span> <span class="VarId">conn</span> <span class="Symbol">[$</span><span class="VarId">here</span><span class="Symbol">|</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">
<span class="Function">with</span> <span class="VarId">att1</span> <span class="Keyword">as</span> <span class="Symbol">(</span>
 <span class="VarId">select</span>
     <span class="VarId">attrelid</span><span class="Symbol">,</span>
     <span class="VarId">attname</span><span class="Symbol">,</span>
     <span class="VarId">attnum</span><span class="Symbol">,</span>
     <span class="VarId">atttypid</span>
   <span class="VarId">from</span> <span class="VarId">pg_attribute</span>
   <span class="VarId">inner</span> <span class="VarId">join</span> <span class="VarId">pg_class</span> <span class="VarId">cls</span>
      <span class="VarId">on</span> <span class="VarId">cls</span><span class="Symbol">.</span><span class="VarId">oid</span> <span class="Symbol">=</span> <span class="VarId">attrelid</span>
   <span class="VarId">inner</span> <span class="VarId">join</span> <span class="VarId">pg_namespace</span> <span class="VarId">ns</span>
      <span class="VarId">on</span> <span class="VarId">cls</span><span class="Symbol">.</span><span class="VarId">relnamespace</span> <span class="Symbol">=</span> <span class="VarId">ns</span><span class="Symbol">.</span><span class="VarId">oid</span>
         <span class="VarId">and</span> <span class="VarId">ns</span><span class="Symbol">.</span><span class="VarId">nspname</span> <span class="Keyword">in</span> <span class="Symbol">(</span>'<span class="VarId">pg_catalog'</span><span class="Symbol">,</span> '<span class="VarId">public'</span><span class="Symbol">,</span> '<span class="VarId">information_schema'</span><span class="Symbol">)</span>
   <span class="Keyword">where</span> <span class="Symbol">/*</span><span class="VarId">pg_catalog</span><span class="Symbol">.</span><span class="VarId">pg_table_is_visible</span><span class="Symbol">(</span><span class="VarId">cls</span><span class="Symbol">.</span><span class="VarId">oid</span><span class="Symbol">)</span>
      <span class="VarId">and</span><span class="Symbol">*/</span> <span class="VarId">cls</span><span class="Symbol">.</span><span class="VarId">relkind</span> <span class="Keyword">in</span> <span class="Symbol">(</span><span class="Char">'r'</span><span class="Symbol">,</span><span class="Char">'v'</span><span class="Symbol">,</span><span class="Char">'c'</span><span class="Symbol">)</span>
      <span class="VarId">and</span> <span class="VarId">not</span> <span class="VarId">attisdropped</span><span class="Symbol">),</span>
 <span class="VarId">sysAtt</span> <span class="Keyword">as</span> <span class="Symbol">(</span>
 <span class="VarId">select</span> <span class="VarId">attrelid</span><span class="Symbol">,</span>
     <span class="VarId">array_to_string</span><span class="Symbol">(</span>
       <span class="VarId">array_agg</span><span class="Symbol">(</span><span class="VarId">attname</span> <span class="Symbol">||</span> <span class="Char">';'</span> <span class="Symbol">||</span> <span class="VarId">atttypid</span><span class="Symbol">)</span>
         <span class="VarId">over</span> <span class="Symbol">(</span><span class="VarId">partition</span> <span class="VarId">by</span> <span class="VarId">attrelid</span> <span class="VarId">order</span> <span class="VarId">by</span> <span class="VarId">attnum</span>
               <span class="VarId">range</span> <span class="VarId">between</span> <span class="VarId">unbounded</span> <span class="VarId">preceding</span>
               <span class="VarId">and</span> <span class="VarId">unbounded</span> <span class="VarId">following</span><span class="Symbol">)</span>
       <span class="Symbol">,</span><span class="Char">','</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">sysAtts</span>
   <span class="VarId">from</span> <span class="VarId">att1</span>
   <span class="Keyword">where</span> <span class="VarId">attnum</span> <span class="Symbol">&lt;</span> <span class="Number">0</span><span class="Symbol">),</span>
 <span class="VarId">att</span> <span class="Keyword">as</span> <span class="Symbol">(</span>
 <span class="VarId">select</span> <span class="VarId">attrelid</span><span class="Symbol">,</span>
     <span class="VarId">array_to_string</span><span class="Symbol">(</span>
       <span class="VarId">array_agg</span><span class="Symbol">(</span><span class="VarId">attname</span> <span class="Symbol">||</span> <span class="Char">';'</span> <span class="Symbol">||</span> <span class="VarId">atttypid</span><span class="Symbol">)</span>
          <span class="VarId">over</span> <span class="Symbol">(</span><span class="VarId">partition</span> <span class="VarId">by</span> <span class="VarId">attrelid</span> <span class="VarId">order</span> <span class="VarId">by</span> <span class="VarId">attnum</span>
                <span class="VarId">range</span> <span class="VarId">between</span> <span class="VarId">unbounded</span> <span class="VarId">preceding</span>
                <span class="VarId">and</span> <span class="VarId">unbounded</span> <span class="VarId">following</span><span class="Symbol">)</span>
       <span class="Symbol">,</span><span class="Char">','</span><span class="Symbol">)</span> <span class="Keyword">as</span> <span class="VarId">atts</span>
   <span class="VarId">from</span> <span class="VarId">att1</span>
   <span class="Keyword">where</span> <span class="VarId">attnum</span> <span class="Symbol">&gt;</span> <span class="Number">0</span><span class="Symbol">)</span>
 <span class="VarId">select</span> <span class="VarId">distinct</span>
     <span class="VarId">cls</span><span class="Symbol">.</span><span class="VarId">relkind</span><span class="Symbol">,</span>
     <span class="VarId">cls</span><span class="Symbol">.</span><span class="VarId">relname</span><span class="Symbol">,</span>
     <span class="VarId">atts</span><span class="Symbol">,</span>
     <span class="VarId">coalesce</span><span class="Symbol">(</span><span class="VarId">sysAtts</span><span class="Symbol">,</span>''<span class="Symbol">),</span>
     <span class="VarId">nspname</span>
   <span class="VarId">from</span> <span class="VarId">att</span> <span class="VarId">left</span> <span class="VarId">outer</span> <span class="VarId">join</span> <span class="VarId">sysAtt</span> <span class="VarId">using</span> <span class="Symbol">(</span><span class="VarId">attrelid</span><span class="Symbol">)</span>
   <span class="VarId">inner</span> <span class="VarId">join</span> <span class="VarId">pg_class</span> <span class="VarId">cls</span>
     <span class="VarId">on</span> <span class="VarId">cls</span><span class="Symbol">.</span><span class="VarId">oid</span> <span class="Symbol">=</span> <span class="VarId">attrelid</span>
   <span class="VarId">inner</span> <span class="VarId">join</span> <span class="VarId">pg_namespace</span> <span class="VarId">ns</span>
      <span class="VarId">on</span> <span class="VarId">cls</span><span class="Symbol">.</span><span class="VarId">relnamespace</span> <span class="Symbol">=</span> <span class="VarId">ns</span><span class="Symbol">.</span><span class="VarId">oid</span>
   <span class="VarId">order</span> <span class="VarId">by</span> <span class="VarId">relkind</span><span class="Symbol">,</span><span class="VarId">relname</span><span class="Symbol">;</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">               <span class="Symbol">|]</span> <span class="Symbol">[]</span>
   <span class="VarId">return</span>
     <span class="Symbol">$</span> <span class="VarId">concat</span> <span class="Symbol">[</span><span class="VarId">cts</span>
              <span class="Symbol">,</span><span class="VarId">map</span> <span class="Symbol">(</span><span class="VarId">uncurry</span> <span class="ConId">CatCreateDomain</span><span class="Symbol">)</span> <span class="VarId">domainDefs</span>
              <span class="Symbol">,</span><span class="VarId">map</span> <span class="Symbol">(\(</span><span class="VarId">a</span><span class="Symbol">,</span><span class="VarId">b</span><span class="Symbol">,</span><span class="VarId">c</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span> <span class="ConId">CatCreateCast</span> <span class="VarId">a</span> <span class="VarId">b</span> <span class="VarId">c</span><span class="Symbol">)</span> <span class="VarId">casts</span>
              <span class="Symbol">,</span><span class="VarId">map</span> <span class="Symbol">(\(</span><span class="VarId">a</span><span class="Symbol">,</span><span class="VarId">b</span><span class="Symbol">,</span><span class="VarId">c</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span>
                    <span class="ConId">CatCreateFunction</span> <span class="ConId">FunPrefix</span> <span class="VarId">a</span> <span class="VarId">b</span> <span class="VarId">c</span> <span class="ConId">False</span><span class="Symbol">)</span> <span class="VarId">prefixOps</span>
              <span class="Symbol">,</span><span class="VarId">map</span> <span class="Symbol">(\(</span><span class="VarId">a</span><span class="Symbol">,</span><span class="VarId">b</span><span class="Symbol">,</span><span class="VarId">c</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span>
                    <span class="ConId">CatCreateFunction</span> <span class="ConId">FunPostfix</span> <span class="VarId">a</span> <span class="VarId">b</span> <span class="VarId">c</span> <span class="ConId">False</span><span class="Symbol">)</span> <span class="VarId">postfixOps</span>
              <span class="Symbol">,</span><span class="VarId">map</span> <span class="Symbol">(\(</span><span class="VarId">a</span><span class="Symbol">,</span><span class="VarId">b</span><span class="Symbol">,</span><span class="VarId">c</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span>
                    <span class="ConId">CatCreateFunction</span> <span class="ConId">FunBinary</span> <span class="VarId">a</span> <span class="VarId">b</span> <span class="VarId">c</span> <span class="ConId">False</span><span class="Symbol">)</span> <span class="VarId">binaryOps</span>
              <span class="Symbol">,</span><span class="VarId">map</span> <span class="Symbol">(\(</span><span class="VarId">a</span><span class="Symbol">,</span><span class="VarId">b</span><span class="Symbol">,</span><span class="VarId">c</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span>
                    <span class="ConId">CatCreateFunction</span> <span class="ConId">FunName</span> <span class="VarId">a</span> <span class="VarId">b</span> <span class="VarId">c</span> <span class="ConId">False</span><span class="Symbol">)</span> <span class="VarId">fnProts</span>
              <span class="Symbol">,</span><span class="VarId">map</span> <span class="Symbol">(\(</span><span class="VarId">a</span><span class="Symbol">,</span><span class="VarId">b</span><span class="Symbol">,</span><span class="VarId">c</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span>
                    <span class="ConId">CatCreateFunction</span> <span class="ConId">FunAgg</span> <span class="VarId">a</span> <span class="VarId">b</span> <span class="VarId">c</span> <span class="ConId">False</span><span class="Symbol">)</span> <span class="VarId">aggProts</span>
              <span class="Symbol">,</span><span class="VarId">map</span> <span class="Symbol">(\(</span><span class="VarId">a</span><span class="Symbol">,</span><span class="VarId">b</span><span class="Symbol">,</span><span class="VarId">c</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span>
                    <span class="ConId">CatCreateFunction</span> <span class="ConId">FunWindow</span> <span class="VarId">a</span> <span class="VarId">b</span> <span class="VarId">c</span> <span class="ConId">False</span><span class="Symbol">)</span> <span class="VarId">winProts</span>
              <span class="Symbol">,</span><span class="VarId">comps</span><span class="Symbol">]</span>
   <span class="Keyword">where</span>
     <span class="VarId">convertAttString</span> <span class="VarId">jlt</span> <span class="VarId">s</span> <span class="Symbol">=</span>
         <span class="Keyword">let</span> <span class="VarId">ps</span> <span class="Symbol">=</span> <span class="VarId">split</span> <span class="Char">','</span> <span class="VarId">s</span>
             <span class="VarId">ps1</span> <span class="Symbol">=</span> <span class="VarId">map</span> <span class="Symbol">(</span><span class="VarId">split</span> <span class="Char">';'</span><span class="Symbol">)</span> <span class="VarId">ps</span>
         <span class="Keyword">in</span> <span class="VarId">map</span> <span class="Symbol">(\</span><span class="VarId">pl</span> <span class="Symbol">-&gt;</span> <span class="Symbol">(</span><span class="VarId">head</span> <span class="VarId">pl</span><span class="Symbol">,</span> <span class="VarId">jlt</span> <span class="Symbol">(</span><span class="VarId">pl</span><span class="Symbol">!!</span><span class="Number">1</span><span class="Symbol">)))</span> <span class="VarId">ps1</span>
     <span class="VarId">convFnRow</span> <span class="VarId">jlt</span> <span class="VarId">l</span> <span class="Symbol">=</span>
        <span class="Symbol">(</span><span class="VarId">head</span> <span class="VarId">l</span><span class="Symbol">,</span><span class="VarId">fnArgs</span><span class="Symbol">,</span><span class="VarId">fnRet</span><span class="Symbol">)</span>
        <span class="Keyword">where</span>
          <span class="VarId">fnRet</span> <span class="Symbol">=</span> <span class="Keyword">let</span> <span class="VarId">rt1</span> <span class="Symbol">=</span> <span class="VarId">jlt</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">3</span><span class="Symbol">)</span>
                  <span class="Keyword">in</span> <span class="Keyword">if</span> <span class="VarId">read</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">2</span><span class="Symbol">)::</span><span class="ConId">Bool</span>
                       <span class="Keyword">then</span> <span class="ConId">SetOfType</span> <span class="VarId">rt1</span>
                       <span class="Keyword">else</span> <span class="VarId">rt1</span>
          <span class="VarId">fnArgs</span> <span class="Symbol">=</span> <span class="Keyword">if</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">1</span><span class="Symbol">)</span> <span class="Symbol">==</span> <span class="String">&quot;&quot;</span>
                     <span class="Keyword">then</span> <span class="Symbol">[]</span>
                     <span class="Keyword">else</span> <span class="Keyword">let</span> <span class="VarId">a</span> <span class="Symbol">=</span> <span class="VarId">split</span> <span class="Char">','</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">1</span><span class="Symbol">)</span>
                          <span class="Keyword">in</span> <span class="VarId">map</span> <span class="VarId">jlt</span> <span class="VarId">a</span>
     <span class="VarId">convTypeInfoRow</span> <span class="VarId">l</span> <span class="Symbol">=</span>
       <span class="Keyword">let</span> <span class="VarId">name</span> <span class="Symbol">=</span> <span class="VarId">canonicalizeTypeName</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">2</span><span class="Symbol">)</span>
           <span class="VarId">ctor</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">1</span><span class="Symbol">)</span> <span class="Keyword">of</span>
                    <span class="String">&quot;b&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">ScalarType</span>
                    <span class="String">&quot;c&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">NamedCompositeType</span>
                    <span class="String">&quot;d&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">DomainType</span>
                    <span class="String">&quot;e&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">EnumType</span>
                    <span class="String">&quot;p&quot;</span> <span class="Symbol">-&gt;</span> <span class="Symbol">\</span><span class="VarId">t</span> <span class="Symbol">-&gt;</span> <span class="ConId">Pseudo</span> <span class="Symbol">$</span> <span class="VarId">pn</span> <span class="VarId">t</span>
                    <span class="VarId">_</span> <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="String">&quot;internal error: unknown type type: &quot;</span>
                         <span class="Symbol">++</span> <span class="Symbol">(</span><span class="VarId">l</span> <span class="Symbol">!!</span> <span class="Number">1</span><span class="Symbol">)</span>
           <span class="VarId">scType</span> <span class="Symbol">=</span> <span class="Symbol">(</span><span class="VarId">head</span> <span class="VarId">l</span><span class="Symbol">,</span> <span class="VarId">ctor</span> <span class="VarId">name</span><span class="Symbol">,</span> <span class="VarId">name</span><span class="Symbol">)</span>
       <span class="Keyword">in</span> <span class="Keyword">if</span> <span class="Symbol">(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">4</span><span class="Symbol">)</span> <span class="Symbol">/=</span> <span class="String">&quot;0&quot;</span>
          <span class="Keyword">then</span> <span class="Symbol">[(</span><span class="VarId">l</span><span class="Symbol">!!</span><span class="Number">5</span><span class="Symbol">,</span><span class="ConId">ArrayType</span> <span class="Symbol">$</span> <span class="VarId">ctor</span> <span class="VarId">name</span><span class="Symbol">,</span> <span class="Char">'_'</span><span class="Symbol">:</span><span class="VarId">name</span><span class="Symbol">),</span> <span class="VarId">scType</span><span class="Symbol">]</span>
          <span class="Keyword">else</span> <span class="Symbol">[</span><span class="VarId">scType</span><span class="Symbol">]</span>
     <span class="VarId">pn</span> <span class="VarId">t</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="VarId">t</span> <span class="Keyword">of</span>
                   <span class="String">&quot;any&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">Any</span>
                   <span class="String">&quot;anyarray&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">AnyArray</span>
                   <span class="String">&quot;anyelement&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">AnyElement</span>
                   <span class="String">&quot;anyenum&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">AnyEnum</span>
                   <span class="String">&quot;anynonarray&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">AnyNonArray</span>
                   <span class="String">&quot;cstring&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">Cstring</span>
                   <span class="String">&quot;internal&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">Internal</span>
                   <span class="String">&quot;language_handler&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">LanguageHandler</span>
                   <span class="String">&quot;opaque&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">Opaque</span>
                   <span class="String">&quot;record&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">Record</span>
                   <span class="String">&quot;trigger&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">Trigger</span>
                   <span class="String">&quot;void&quot;</span> <span class="Symbol">-&gt;</span> <span class="ConId">Void</span>
                   <span class="VarId">_</span> <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="String">&quot;internal error: unknown pseudo &quot;</span> <span class="Symbol">++</span> <span class="VarId">t</span></pre></div></div></div><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/29/11 20:06:46, hssqlppp-0.3.0</div
    ></body
  ></html
>
