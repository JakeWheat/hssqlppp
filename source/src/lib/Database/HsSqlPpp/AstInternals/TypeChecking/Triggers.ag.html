<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >Triggers</title
    ><link href="../../../../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../../../../index.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><p
    >{-</p
    ><p
    >triggers</p
    ><p
    >only supporting what I use at the moment</p
    ><p
    >functions returning trigger introduce OLD and NEW records which need a new type, and match against any composite, contain any field. - this will allow the function returning trigger to type check sort of correctly (it won't fail things which should pass).</p
    ><p
    >[Could do slightly better whilst checking these functions (e.g. detect inconsistencies in the way old and new are used), but don't need to do this here to catch errors, since we catch them when they are attached to a table.</p
    ><p
    >also: returns trigger means that the function should return old, new or null, could catch this in the function, but using it will catch this so skip for now.]</p
    ><p
    >Then, when adding a trigger, recheck the function with the exact composite types substituted in for the return type, old and new. This should catch any remaining errors with the function.</p
    ><p
    >Might need to alter annotations to allow a single type error to have multiple messages with multiple source positions</p
    ><p
    >Roughly, the catalog entry will be: triggername, events, tablename, statement|row,procedure_name</p
    ><p
    >Summary: change typechecking functions which return trigger to add magic old and new records to type check a create trigger, check the table exists, the procedure exists, and recheck the procedure with the table's composite type as new, old and return type</p
    ><ol style="list-style-type: decimal;"
    ><li
      >get function with old, new, return trigger passing typecheck</li
      ><li
      >add triggers to catalog, get catupdates from typechecking create trigger</li
      ><li
      >read trigger info from pg catalog</li
      ><li
      >errors: missing table, missing function</li
      ><li
      >recheck used function with table composite type in place of old and new - success and error checks</li
      ></ol
    ><p
    >-}</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">
</pre></div></div></div><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/31/11 20:00:52, hssqlppp-0.3.0</div
    ></body
  ></html
>
