<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >BindingsTests</title
    ><link href="../../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../../index.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><p
    >Test the bindings code is working.</p
    ><p
    >LBIds|LBTref|LBJoinTref|LocalBindingsUpdate|emptyBindings|lbUpdate|lbExpandStar|lbLookupID|lbUpdateDot</p
    ><p
    >Where are local bindings set, and where are lookups done?</p
    ><p
    >== insert</p
    ><p
    >--lookup: table set: col names for targetCols --lookup: 'implicit assigment' for select expression -&gt; cols --lookup: returning set: record type in returning</p
    ><p
    >== update --lookup: table set: col names for assigns, where, returning what about from joins? --lookup: where --lookup: returning set: record type in returning</p
    ><p
    >== delete --lookup: table set: col names for where and returning what about using?</p
    ><p
    >= copy --lookup: table set: col names for targetcols + lookup</p
    ><p
    >= create table: set atts into constraints</p
    ><p
    >= create function: params</p
    ><p
    >= create domain check expression</p
    ><p
    >= assignment record type</p
    ><p
    >= execute into record type</p
    ><p
    >= for select record type</p
    ><p
    >= for integer implicitly declared integer record type</p
    ><p
    >= select expression tref -&gt; select list, where, group, order</p
    ><p
    >= trefs tref cols up, into on exprs</p
    ><p
    >etc. etc.</p
    ><p
    >New approach: test the hairy bits first: trefs + aliases, ambiguous, correlation names, on exprs contexts for *: selectlist, returning, aggregates hack for member with same name as composite in select list record type setting implicit int in for loop</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">{-# LANGUAGE QuasiQuotes #-}</span>
<span class="Keyword">module</span> <span class="ConId">Database.HsSqlPpp.Tests.BindingsTests</span>
    <span class="Symbol">(</span><span class="VarId">bindingsTests</span><span class="Symbol">)</span> <span class="Keyword">where</span>

<span class="Keyword">import</span> <span class="ConId">Test.HUnit</span>
<span class="Keyword">import</span> <span class="ConId">Test.Framework</span>
<span class="Keyword">import</span> <span class="ConId">Test.Framework.Providers.HUnit</span>
<span class="Keyword">import</span> <span class="ConId">Data.Generics.Uniplate.Data</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Parser</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.TypeChecker</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Annotation</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Catalog</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.SqlTypes</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Utils.PPExpr</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Tests.TestUtils</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">
<span class="Keyword">data</span> <span class="ConId">Item</span> <span class="Symbol">=</span> <span class="ConId">Group</span> <span class="ConId">String</span> <span class="Symbol">[</span><span class="ConId">Item</span><span class="Symbol">]</span>
          <span class="Symbol">|</span> <span class="ConId">StmtType</span> <span class="Symbol">[</span><span class="ConId">CatalogUpdate</span><span class="Symbol">]</span> <span class="ConId">String</span> <span class="Symbol">(</span><span class="ConId">Either</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span> <span class="Symbol">[</span><span class="ConId">Maybe</span> <span class="ConId">StatementType</span><span class="Symbol">])</span>

<span class="Function">bindingsTests</span> <span class="Symbol">::</span> <span class="ConId">Test.Framework.Test</span>
<span class="Function">bindingsTests</span> <span class="Symbol">=</span> <span class="VarId">itemToTft</span> <span class="VarId">bindingsTestData</span>

<span class="Function">bindingsTestData</span> <span class="Symbol">::</span> <span class="ConId">Item</span>
<span class="Function">bindingsTestData</span> <span class="Symbol">=</span>
  <span class="ConId">Group</span> <span class="String">&quot;bind tests&quot;</span>
   <span class="Symbol">[</span><span class="VarId">trefTests</span><span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">trefTests</span> <span class="Symbol">::</span> <span class="ConId">Item</span>
<span class="Function">trefTests</span> <span class="Symbol">=</span> <span class="ConId">Group</span> <span class="String">&quot;tref&quot;</span> <span class="Symbol">[</span><span class="VarId">simpleSingleTrefs</span>
                         <span class="Symbol">,</span><span class="VarId">simpleSingleAliasedTrefs</span><span class="Symbol">]</span></pre></div></div></div><p
    >= simple selects with a single unaliased table:</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">simpleSingleTrefs</span> <span class="Symbol">::</span> <span class="ConId">Item</span>
<span class="Function">simpleSingleTrefs</span> <span class="Symbol">=</span> <span class="ConId">Group</span> <span class="String">&quot;simpleSingleTrefs&quot;</span></pre></div></div></div><p
    >single columns, including system columns</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">[</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select a from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select b from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select oid from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span></pre></div></div></div><p
    >multiple columns</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select a,b from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="VarId">cols</span><span class="Symbol">)]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select a,b,oid from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="VarId">cols</span> <span class="Symbol">++</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span></pre></div></div></div><p
    >aliased columns</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select a as c, b as d from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;c&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)</span>
                          <span class="Symbol">,(</span><span class="String">&quot;d&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select a as x,b as y,oid as z from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;x&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)</span>
                          <span class="Symbol">,(</span><span class="String">&quot;y&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
                          <span class="Symbol">,(</span><span class="String">&quot;z&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span></pre></div></div></div><p
    >qualified column references</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.a from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.b from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.oid from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span></pre></div></div></div><p
    >star variations</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;/*cunt*/select * from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="VarId">cols</span><span class="Symbol">)]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;/*cunt*/select t.* from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="VarId">cols</span><span class="Symbol">)]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select *, a as c from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)</span>
                          <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
                          <span class="Symbol">,(</span><span class="String">&quot;c&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)])]</span></pre></div></div></div><p
    >errors: unrecognised column, unrecognised correlation name, unrecognised table</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select c from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;c&quot;</span><span class="Symbol">]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select c.* from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedCorrelationName</span> <span class="String">&quot;c&quot;</span><span class="Symbol">]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select * from u;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">BadStarExpand</span><span class="Symbol">,</span><span class="ConId">UnrecognisedRelation</span> <span class="String">&quot;u&quot;</span><span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">   <span class="Keyword">where</span> <span class="VarId">cols</span> <span class="Symbol">=</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)</span>
                <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]</span>
         <span class="VarId">ct</span> <span class="Symbol">=</span> <span class="Symbol">[</span><span class="ConId">CatCreateTable</span> <span class="String">&quot;t&quot;</span> <span class="VarId">cols</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)]]</span></pre></div></div></div><p
    >= simple selects with a single aliased table:</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">simpleSingleAliasedTrefs</span> <span class="Symbol">::</span> <span class="ConId">Item</span>
<span class="Function">simpleSingleAliasedTrefs</span> <span class="Symbol">=</span> <span class="ConId">Group</span> <span class="String">&quot;simpleSingleAliasedTrefs&quot;</span></pre></div></div></div><p
    >qualified column references</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">[</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select u.a from t u;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.a from t u;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedCorrelationName</span> <span class="String">&quot;t&quot;</span><span class="Symbol">]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select u.oid from t u;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.oid from t u;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedCorrelationName</span> <span class="String">&quot;t&quot;</span><span class="Symbol">]</span></pre></div></div></div><p
    >star variations</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.* from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="VarId">cols</span><span class="Symbol">)]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select u.* from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedCorrelationName</span> <span class="String">&quot;u&quot;</span><span class="Symbol">]</span>
    <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">   <span class="Keyword">where</span> <span class="VarId">cols</span> <span class="Symbol">=</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)</span>
                <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]</span>
         <span class="VarId">ct</span> <span class="Symbol">=</span> <span class="Symbol">[</span><span class="ConId">CatCreateTable</span> <span class="String">&quot;t&quot;</span> <span class="VarId">cols</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)]]</span></pre></div></div></div><p
    >= simple selects with a single function:</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">{-simpleSingleFunTrefs :: Item</span>
<span class="Comment">simpleSingleFunTrefs = Group &quot;simpleSingleFunTrefs&quot;</span></pre></div></div></div><p
    >single columns, including system columns</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">[</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select a from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select b from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span></pre></div></div></div><p
    >multiple columns</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select a,b from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="VarId">cols</span><span class="Symbol">)]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select a,b,oid from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="VarId">cols</span> <span class="Symbol">++</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span></pre></div></div></div><p
    >aliased columns</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select a as c, b as d from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;c&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)</span>
                          <span class="Symbol">,(</span><span class="String">&quot;d&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select a as x,b as y,oid as z from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;x&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)</span>
                          <span class="Symbol">,(</span><span class="String">&quot;y&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
                          <span class="Symbol">,(</span><span class="String">&quot;z&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span></pre></div></div></div><p
    >qualified column references</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.a from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.b from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.oid from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span></pre></div></div></div><p
    >star variations</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select * from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="VarId">cols</span><span class="Symbol">)]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.* from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="VarId">cols</span><span class="Symbol">)]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select *, a as c from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)</span>
                          <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
                          <span class="Symbol">,(</span><span class="String">&quot;c&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)])]</span></pre></div></div></div><p
    >errors: unrecognised column, unrecognised correlation name, unrecognised table</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select c from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;c&quot;</span><span class="Symbol">]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select c.* from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;c&quot;</span><span class="Symbol">]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select * from u;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedRelation</span> <span class="String">&quot;u&quot;</span><span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">   <span class="Keyword">where</span> <span class="VarId">cols</span> <span class="Symbol">=</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)</span>
                <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]</span>
         <span class="VarId">ct</span> <span class="Symbol">=</span> <span class="Symbol">[</span><span class="ConId">CatCreateTable</span> <span class="String">&quot;t&quot;</span> <span class="VarId">cols</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)]]</span></pre></div></div></div><p
    >= simple selects with a single aliased table:</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">simpleSingleAliasedTrefs</span> <span class="Symbol">::</span> <span class="ConId">Item</span>
<span class="Function">simpleSingleAliasedTrefs</span> <span class="Symbol">=</span> <span class="ConId">Group</span> <span class="String">&quot;simpleSingleAliasedTrefs&quot;</span></pre></div></div></div><p
    >qualified column references</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">[</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select u.a from t u;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.a from t u;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select u.oid from t u;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.oid from t u;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[]</span></pre></div></div></div><p
    >star variations</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select t.* from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[]</span>
    <span class="Symbol">,</span><span class="ConId">StmtType</span> <span class="VarId">ct</span> <span class="String">&quot;select u.* from t;&quot;</span>
     <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="VarId">cols</span><span class="Symbol">)]</span>
    <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">   <span class="Keyword">where</span> <span class="VarId">cols</span> <span class="Symbol">=</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)</span>
                <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]</span>
         <span class="VarId">ct</span> <span class="Symbol">=</span> <span class="Symbol">[</span><span class="ConId">CatCreateTable</span> <span class="String">&quot;t&quot;</span> <span class="VarId">cols</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)]]</span> <span class="Symbol">-}</span></pre></div></div></div><p
    >plain references bad references qualified refs star on own qualified star star with extras qualified star with extras system columns</p
    ><p
    >same with aliases</p
    ><p
    >above for simpletref, funtref, subselecttref</p
    ><p
    >composite/member hack for select lists check</p
    ><p
    >simple joins - two tables cross implicit cross using natural</p
    ><p
    >do: ambiguous errors where possible list columns out list qualified columns star + qualified combos degenerate natural bad using: no col, incompatible types on expression check, and implicit cross with on in where variant</p
    ><p
    >then: big space - aliased, three way joins, on exprs, etc.</p
    ><hr
     /><p
    >update: tref -&gt; whr, assigns, returning select: tref -? select list, where, group, order by tref: subtref, vanilla, fun, join onexpr assignment: lkp + adjust record type for loop: check type + implicit integer decl + adjust rec type delete tref -&gt; whr, returning block decl create table -&gt; table constraints att def -&gt; constraint function params + pos arg ref select into: assign checks + adjust rec type insert returning, values list? &quot;.&quot; expansion identifier ref: todo - list all contexts domain constraint trigger old and new hack</p
    ><hr
     /><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">itemToTft</span> <span class="Symbol">::</span> <span class="ConId">Item</span> <span class="Symbol">-&gt;</span> <span class="ConId">Test.Framework.Test</span>
<span class="Function">itemToTft</span> <span class="Symbol">(</span><span class="ConId">StmtType</span> <span class="VarId">c</span> <span class="VarId">s</span> <span class="VarId">r</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">testStatementType</span> <span class="VarId">c</span> <span class="VarId">s</span> <span class="VarId">r</span>
<span class="Function">itemToTft</span> <span class="Symbol">(</span><span class="ConId">Group</span> <span class="VarId">s</span> <span class="VarId">is</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">testGroup</span> <span class="VarId">s</span> <span class="Symbol">$</span> <span class="VarId">map</span> <span class="VarId">itemToTft</span> <span class="VarId">is</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">testStatementType</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">CatalogUpdate</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Either</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span> <span class="Symbol">[</span><span class="ConId">Maybe</span> <span class="ConId">StatementType</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">Test.Framework.Test</span>
<span class="Function">testStatementType</span> <span class="VarId">eu</span> <span class="VarId">src</span> <span class="VarId">sis</span> <span class="Symbol">=</span> <span class="VarId">testCase</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="Symbol">$</span>
  <span class="Keyword">let</span> <span class="VarId">ast</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="VarId">parseStatements</span> <span class="String">&quot;&quot;</span> <span class="VarId">src</span> <span class="Keyword">of</span>
                              <span class="ConId">Left</span> <span class="VarId">e</span> <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="VarId">show</span> <span class="VarId">e</span>
                              <span class="ConId">Right</span> <span class="VarId">l</span> <span class="Symbol">-&gt;</span> <span class="VarId">l</span>
      <span class="VarId">aast</span> <span class="Symbol">=</span> <span class="VarId">snd</span> <span class="Symbol">$</span> <span class="VarId">typeCheckStatements</span> <span class="VarId">makeCat</span> <span class="VarId">ast</span>
      <span class="VarId">is</span> <span class="Symbol">=</span> <span class="VarId">map</span> <span class="Symbol">(</span><span class="VarId">stType</span> <span class="Symbol">.</span> <span class="VarId">getAnnotation</span><span class="Symbol">)</span> <span class="VarId">aast</span>
      <span class="VarId">er</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span>
      <span class="VarId">er</span> <span class="Symbol">=</span> <span class="Symbol">[</span><span class="VarId">x</span> <span class="Symbol">|</span> <span class="VarId">x</span> <span class="Symbol">&lt;-</span> <span class="VarId">universeBi</span> <span class="VarId">aast</span><span class="Symbol">]</span>
  <span class="Keyword">in</span> <span class="Keyword">case</span> <span class="Symbol">(</span><span class="VarId">length</span> <span class="VarId">er</span><span class="Symbol">,</span> <span class="VarId">length</span> <span class="VarId">is</span><span class="Symbol">)</span> <span class="Keyword">of</span>
       <span class="Symbol">(</span><span class="Number">0</span><span class="Symbol">,</span><span class="Number">0</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span> <span class="VarId">assertFailure</span> <span class="String">&quot;didn't get any infos?&quot;</span>
       <span class="Symbol">(</span><span class="Number">0</span><span class="Symbol">,</span><span class="VarId">_</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span> <span class="VarId">assertTrace</span> <span class="Symbol">(</span><span class="VarId">ppExpr</span> <span class="VarId">is</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="VarId">sis</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">is</span>
       <span class="VarId">_</span> <span class="Symbol">-&gt;</span> <span class="VarId">assertEqual</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="VarId">sis</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="VarId">er</span>
  <span class="Keyword">where</span>
    <span class="VarId">makeCat</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="VarId">updateCatalog</span> <span class="VarId">defaultTemplate1Catalog</span> <span class="VarId">eu</span> <span class="Keyword">of</span>
                        <span class="ConId">Left</span> <span class="VarId">x</span> <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="VarId">show</span> <span class="VarId">x</span>
                        <span class="ConId">Right</span> <span class="VarId">e</span> <span class="Symbol">-&gt;</span> <span class="VarId">e</span></pre></div></div></div><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/31/11 20:00:52, hssqlppp-0.3.0</div
    ></body
  ></html
>
