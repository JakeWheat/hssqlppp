<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><title
    >TypeCheckTests</title
    ><link href="../../../../../main.css" rel="stylesheet" type="text/css"
     /></head
  ><body
  ><div class="header"
    ><a href="../../../../../index.html"
      >HsSqlPpp-0.3.0</a
      ></div
    ><br
     /><br
     /><br
     /><p
    >Set of tests to check the type checking code. Includes tests for the errors for sql which doesn't type check.</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Comment">{-# LANGUAGE QuasiQuotes #-}</span>
<span class="Keyword">module</span> <span class="ConId">Database.HsSqlPpp.Tests.TypeCheckTests</span>
    <span class="Symbol">(</span><span class="VarId">typeCheckTests</span>
    <span class="Symbol">,</span><span class="VarId">typeCheckTestData</span>
    <span class="Symbol">,</span><span class="ConId">Item</span><span class="Symbol">(..))</span> <span class="Keyword">where</span>

<span class="Keyword">import</span> <span class="ConId">Test.HUnit</span>
<span class="Keyword">import</span> <span class="ConId">Test.Framework</span>
<span class="Keyword">import</span> <span class="ConId">Test.Framework.Providers.HUnit</span>
<span class="Keyword">import</span> <span class="ConId">Data.List</span>
<span class="Keyword">import</span> <span class="ConId">Data.Generics.Uniplate.Data</span>

<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Utils.Here</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Parser</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.TypeChecker</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Annotation</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Catalog</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.SqlTypes</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Utils.PPExpr</span>
<span class="Keyword">import</span> <span class="ConId">Database.HsSqlPpp.Tests.TestUtils</span>

<span class="Keyword">data</span> <span class="ConId">Item</span> <span class="Symbol">=</span> <span class="ConId">Group</span> <span class="ConId">String</span> <span class="Symbol">[</span><span class="ConId">Item</span><span class="Symbol">]</span>
          <span class="Symbol">|</span> <span class="ConId">Expr</span> <span class="ConId">String</span> <span class="Symbol">(</span><span class="ConId">Either</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span> <span class="ConId">Type</span><span class="Symbol">)</span>
          <span class="Symbol">|</span> <span class="ConId">StmtType</span> <span class="ConId">String</span> <span class="Symbol">(</span><span class="ConId">Either</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span> <span class="Symbol">[</span><span class="ConId">Maybe</span> <span class="ConId">StatementType</span><span class="Symbol">])</span>
          <span class="Symbol">|</span> <span class="ConId">CatStmtType</span> <span class="ConId">String</span> <span class="Symbol">[</span><span class="ConId">CatalogUpdate</span><span class="Symbol">]</span> <span class="Symbol">(</span><span class="ConId">Either</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span> <span class="Symbol">[</span><span class="ConId">Maybe</span> <span class="ConId">StatementType</span><span class="Symbol">])</span>
          <span class="Symbol">|</span> <span class="ConId">Ddl</span> <span class="ConId">String</span> <span class="Symbol">[</span><span class="ConId">CatalogUpdate</span><span class="Symbol">]</span>

<span class="Function">typeCheckTests</span> <span class="Symbol">::</span> <span class="ConId">Test.Framework.Test</span>
<span class="Function">typeCheckTests</span> <span class="Symbol">=</span> <span class="VarId">itemToTft</span> <span class="VarId">typeCheckTestData</span>

<span class="Function">typeCheckTestData</span> <span class="Symbol">::</span> <span class="ConId">Item</span>
<span class="Function">typeCheckTestData</span> <span class="Symbol">=</span>
  <span class="ConId">Group</span> <span class="String">&quot;astCheckTests&quot;</span> <span class="Symbol">[</span>

   <span class="ConId">Group</span> <span class="String">&quot;basic literal types&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">e</span> <span class="String">&quot;1&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;1.0&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeNumeric</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;'test'&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="ConId">UnknownType</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;true&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array[1,2,3]&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ArrayType</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array['a','b']&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ArrayType</span> <span class="ConId">UnknownType</span><span class="Symbol">)</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array['a'::text,'b']&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ArrayType</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">))</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array['a','b'::text]&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ArrayType</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">))</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array[1,'b']&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ArrayType</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array[1,true]&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;!arrayctor&quot;</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span><span class="Symbol">]]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;some expressions&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">e</span> <span class="String">&quot;1=1&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;1=true&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;=&quot;</span> <span class="Symbol">[</span><span class="VarId">typeInt</span><span class="Symbol">,</span><span class="VarId">typeBool</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;substring('aqbc' from 2 for 2)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>

     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;substring(3 from 2 for 2)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span>
                                     <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;!substring&quot;</span>
                                      <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span>
                                      <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span>
                                      <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;substring('aqbc' from 2 for true)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span>
                    <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;!substring&quot;</span>
                     <span class="Symbol">[</span><span class="ConId">UnknownType</span>
                     <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span>
                     <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span><span class="Symbol">]]</span>

     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;3 between 2 and 4&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;3 between true and 4&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span>
                               <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;&gt;=&quot;</span>
                                <span class="Symbol">[</span><span class="VarId">typeInt</span>
                                <span class="Symbol">,</span><span class="VarId">typeBool</span><span class="Symbol">]]</span>

     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array[1,2,3][2]&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array['a','b'][1]&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="ConId">UnknownType</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array['a'::text,'b'][1]&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
     <span class="Comment">{-,p &quot;array['a','b'][true]&quot; (TypeError (&quot;&quot;,0,0)</span>
<span class="Comment">                                  (WrongType</span>
<span class="Comment">                                   typeInt</span>
<span class="Comment">                                   UnknownType))-}</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;not true&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;not 1&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span>
                 <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;!not&quot;</span> <span class="Symbol">[</span><span class="VarId">typeInt</span><span class="Symbol">]]</span>

     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;@ 3&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;@ true&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span>
                 <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;@&quot;</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span><span class="Symbol">]]</span>

     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;-3&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;-'a'&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span>
                 <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;-&quot;</span> <span class="Symbol">[</span><span class="ConId">UnknownType</span><span class="Symbol">]]</span>

     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;4-3&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>

     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;1 is null&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;1 is not null&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>

     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;1+1&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;1+1&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;31*511&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;5/2&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;2^10&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeFloat8</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;17%5&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;3 and 4&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span>
                  <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;!and&quot;</span> <span class="Symbol">[</span><span class="VarId">typeInt</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;True and False&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;false or true&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;lower('TEST')&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;lower(1)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;lower&quot;</span> <span class="Symbol">[</span><span class="VarId">typeInt</span><span class="Symbol">]]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;special functions&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">e</span> <span class="String">&quot;coalesce(null,1,2,null)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;coalesce('3',1,2,null)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;coalesce('3',1,true,null)&quot;</span>
            <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;coalesce&quot;</span> <span class="Symbol">[</span><span class="ConId">UnknownType</span>
                                                  <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span>
                                                  <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span>
                                                  <span class="Symbol">,</span><span class="ConId">UnknownType</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;nullif('hello','hello')&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="ConId">UnknownType</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;nullif('hello'::text,'hello')&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;nullif(3,4)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;nullif(true,3)&quot;</span>
            <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;nullif&quot;</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span>
                                          <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;greatest(3,5,6,4,3)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;least(3,5,6,4,3)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;least(5,true)&quot;</span>
            <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;least&quot;</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span><span class="Symbol">]]</span>
     <span class="Symbol">]</span></pre></div></div></div><pre
    ><code
      >implicit casting and function/operator choice tests:
check when multiple implicit and one exact match on num args
check multiple matches with num args, only one with implicit conversions
check multiple implicit matches with one preferred
check multiple implicit matches with one preferred highest count
check casts from unknown string lits
</code
      ></pre
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;some expressions&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">e</span> <span class="String">&quot;3 + '4'&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;3.0 + '4'&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeNumeric</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;'3' + '4'&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;+&quot;</span> <span class="Symbol">[</span><span class="ConId">UnknownType</span>
                                              <span class="Symbol">,</span><span class="ConId">UnknownType</span><span class="Symbol">]]</span>
     <span class="Symbol">]</span>
  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;exists expressions&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">e</span> <span class="String">&quot;exists (select 1 from pg_type)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;exists (select testit from pg_type)&quot;</span>
       <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;testit&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">]</span>
  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;row comparison expressions&quot;</span> <span class="Symbol">[</span></pre></div></div></div><pre
    ><code
      >rows different lengths
rows match types pairwise, same and different types
rows implicit cast from unknown
rows don't match types
</code
      ></pre
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">      <span class="VarId">e</span> <span class="String">&quot;row(1)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="VarId">typeInt</span><span class="Symbol">])</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;row(1,2)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="VarId">typeInt</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">])</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;row('t1','t2')&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="ConId">UnknownType</span><span class="Symbol">,</span><span class="ConId">UnknownType</span><span class="Symbol">])</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;row(true,1,'t3')&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="VarId">typeBool</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">,</span><span class="ConId">UnknownType</span><span class="Symbol">])</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;(true,1,'t3',75.3)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="VarId">typeBool</span><span class="Symbol">,</span><span class="VarId">typeInt</span>
                                      <span class="Symbol">,</span><span class="ConId">UnknownType</span><span class="Symbol">,</span><span class="VarId">typeNumeric</span><span class="Symbol">])</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;row(1) = row(2)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;row(1,2) = row(2,1)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;(1,2) = (2,1)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;(1,2,3) = (2,1)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;=&quot;</span>
                                  <span class="Symbol">[</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span>
                                                       <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span>
                                                       <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">]</span>
                                   <span class="Symbol">,</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span>
                                                        <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">]]]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;('1',2) = (2,'1')&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;(1,true) = (2,1)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;=&quot;</span>
                                   <span class="Symbol">[</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span>
                                                        <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span><span class="Symbol">]</span>
                                   <span class="Symbol">,</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span>
                                                        <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">]]]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;(1,2) &lt;&gt; (2,1)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;(1,2) &gt;= (2,1)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;(1,2) &lt;= (2,1)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;(1,2) &gt; (2,1)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;(1,2) &lt; (2,1)&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">]</span>
  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;case expressions&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">e</span> <span class="String">&quot;case\n\
        \ when true then 1\n\
        \end&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;case\n\
        \ when 1=2 then 'stuff'\n\
        \ when 2=3 then 'blah'\n\
        \ else 'test'\n\
        \end&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="ConId">UnknownType</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;case\n\
        \ when 1=2 then 'stuff'\n\
        \ when 2=3 then 'blah'\n\
        \ else 'test'::text\n\
        \end&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">$</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;case\n\
        \ when 1=2 then 'stuff'\n\
        \ when true=3 then 'blah'\n\
        \ else 'test'\n\
        \end&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;=&quot;</span> <span class="Symbol">[</span><span class="VarId">typeBool</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;case\n\
        \ when 1=2 then true\n\
        \ when 2=3 then false\n\
        \ else 1\n\
        \end&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypeSet</span> <span class="Symbol">[</span><span class="VarId">typeBool</span>
                                        <span class="Symbol">,</span><span class="VarId">typeBool</span>
                                        <span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;case\n\
        \ when 1=2 then false\n\
        \ when 2=3 then 1\n\
        \ else true\n\
        \end&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypeSet</span> <span class="Symbol">[</span><span class="VarId">typeBool</span>
                                          <span class="Symbol">,</span><span class="VarId">typeInt</span>
                                          <span class="Symbol">,</span><span class="VarId">typeBool</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;case 1 when 2 then 3 else 4 end&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;case 1 when true then 3 else 4 end&quot;</span>
            <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypeSet</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span>
                                         <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;case 1 when 2 then true else false end&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeBool</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;case 1 when 2 then 3 else false end&quot;</span>
            <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypeSet</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span>
                                         <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span><span class="Symbol">]]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;polymorphic functions&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">e</span> <span class="String">&quot;array_append(ARRAY[1,2], 3)&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ArrayType</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array_append(ARRAY['a','b'], 'c')&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ArrayType</span> <span class="ConId">UnknownType</span><span class="Symbol">)</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array_append(ARRAY['a','b'], 'c'::text)&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ArrayType</span> <span class="Symbol">$</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array_append(ARRAY['a','b'::text], 'c')&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ArrayType</span> <span class="Symbol">$</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array_append(ARRAY['a'::int,'b'], 'c')&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ArrayType</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;cast expressions&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">e</span> <span class="String">&quot;cast ('1' as integer)&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">typeInt</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;cast ('1' as baz)&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnknownTypeName</span> <span class="String">&quot;baz&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array[]&quot;</span> <span class="Comment">-- this isn't quite right but not sure how to do it atm</span>
                  <span class="Comment">-- no point fixing this case since need a load of other</span>
                  <span class="Comment">-- test cases where the behaviour is different</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">Pseudo</span> <span class="ConId">AnyArray</span><span class="Symbol">)</span> <span class="Comment">-- Left [TypelessEmptyArray]</span>
     <span class="Symbol">,</span><span class="VarId">e</span> <span class="String">&quot;array[] :: text[]&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">(</span><span class="ConId">ArrayType</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">))</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;simple selects&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;select 1;&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;?column?&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select 1 as a;&quot;</span> <span class="Symbol">$</span>
        <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select 1,2;&quot;</span> <span class="Symbol">$</span>
        <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;?column?&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
                                                <span class="Symbol">,(</span><span class="String">&quot;?column?&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select 1 as a, 2 as b;&quot;</span> <span class="Symbol">$</span>
        <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
                                                <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select 1+2 as a, 'a' || 'b';&quot;</span> <span class="Symbol">$</span>
        <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
                                       <span class="Symbol">,(</span><span class="String">&quot;?column?&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;values (1,2);&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
                                          <span class="Symbol">[(</span><span class="String">&quot;column1&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
                                          <span class="Symbol">,(</span><span class="String">&quot;column2&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;values (1,2),('3', '4');&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
                                                     <span class="Symbol">[(</span><span class="String">&quot;column1&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
                                                     <span class="Symbol">,(</span><span class="String">&quot;column2&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;values (1,2),('a', true);&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypeSet</span> <span class="Symbol">[</span><span class="VarId">typeInt</span>
                                                                <span class="Symbol">,</span><span class="VarId">typeBool</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;values ('3', '4'),(1,2);&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
                                                     <span class="Symbol">[(</span><span class="String">&quot;column1&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
                                                     <span class="Symbol">,(</span><span class="String">&quot;column2&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;values ('a', true),(1,2);&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypeSet</span> <span class="Symbol">[</span><span class="VarId">typeBool</span>
                                                                <span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;values ('a'::text, '2'::int2),('1','2');&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
                                     <span class="Symbol">[(</span><span class="String">&quot;column1&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
                                     <span class="Symbol">,(</span><span class="String">&quot;column2&quot;</span><span class="Symbol">,</span> <span class="VarId">typeSmallInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;values (1,2,3),(1,2);&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">ValuesListsMustBeSameLength</span><span class="Symbol">]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;simple combine selects&quot;</span> <span class="Symbol">[</span>
     <span class="VarId">s</span> <span class="String">&quot;select 1,2  union select '3', '4';&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
                                     <span class="Symbol">[(</span><span class="String">&quot;?column?&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
                                     <span class="Symbol">,(</span><span class="String">&quot;?column?&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select 1,2 intersect select 'a', true;&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypeSet</span> <span class="Symbol">[</span><span class="VarId">typeInt</span>
                                                        <span class="Symbol">,</span><span class="VarId">typeBool</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select '3', '4' except select 1,2;&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
                                     <span class="Symbol">[(</span><span class="String">&quot;?column?&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
                                     <span class="Symbol">,(</span><span class="String">&quot;?column?&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select 'a', true union select 1,2;&quot;</span>
                                     <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypeSet</span> <span class="Symbol">[</span><span class="VarId">typeBool</span>
                                                        <span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">]]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select 'a'::text, '2'::int2 intersect select '1','2';&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
                                     <span class="Symbol">[(</span><span class="String">&quot;text&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
                                     <span class="Symbol">,(</span><span class="String">&quot;int2&quot;</span><span class="Symbol">,</span> <span class="VarId">typeSmallInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select 1,2,3 except select 1,2;&quot;</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">ValuesListsMustBeSameLength</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select '3' as a, '4' as b except select 1,2;&quot;</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
                                     <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
                                     <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="Symbol">[$</span><span class="VarId">here</span><span class="Symbol">|</span>
         <span class="VarId">with</span> <span class="VarId">a</span> <span class="Keyword">as</span> <span class="Symbol">(</span><span class="VarId">select</span> <span class="Number">1</span> <span class="Keyword">as</span> <span class="VarId">a1</span><span class="Symbol">),</span>
              <span class="VarId">b</span> <span class="Keyword">as</span> <span class="Symbol">(</span><span class="VarId">select</span> <span class="Symbol">*</span> <span class="VarId">from</span> <span class="VarId">a</span><span class="Symbol">)</span>
              <span class="VarId">select</span> <span class="Symbol">*</span> <span class="VarId">from</span> <span class="VarId">a</span>
              <span class="VarId">union</span> <span class="VarId">select</span> <span class="Symbol">*</span> <span class="VarId">from</span> <span class="VarId">b</span><span class="Symbol">;</span> <span class="Symbol">|]</span>
         <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
                           <span class="Symbol">[(</span><span class="String">&quot;a1&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;simple selects from&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;select a from (select 1 as a, 2 as b) x;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select b from (select 1 as a, 2 as b) x;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select c from (select 1 as a, 2 as b) x;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;c&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select typlen from pg_type;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;typlen&quot;</span><span class="Symbol">,</span> <span class="VarId">typeSmallInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select oid from pg_type;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;oid&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select p.oid from pg_type p;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;oid&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;oid&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select typlen from nope;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;typlen&quot;</span><span class="Symbol">,</span><span class="ConId">UnrecognisedRelation</span> <span class="String">&quot;nope&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select generate_series from generate_series(1,7);&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;generate_series&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>

     <span class="Comment">-- check aliasing</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select generate_series.generate_series from generate_series(1,7);&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;generate_series&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select g from generate_series(1,7) g;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;g&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select g.g from generate_series(1,7) g;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;g&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select generate_series.g from generate_series(1,7) g;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedCorrelationName</span> <span class="String">&quot;generate_series&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select g.generate_series from generate_series(1,7) g;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;g.generate_series&quot;</span><span class="Symbol">]</span>

     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select * from pg_attrdef;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
         <span class="Symbol">[(</span><span class="String">&quot;adrelid&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;oid&quot;</span><span class="Symbol">)</span>
         <span class="Symbol">,(</span><span class="String">&quot;adnum&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int2&quot;</span><span class="Symbol">)</span>
         <span class="Symbol">,(</span><span class="String">&quot;adbin&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
         <span class="Symbol">,(</span><span class="String">&quot;adsrc&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select abs from abs(3);&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;abs&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
        <span class="Comment">--todo: these are both valid,</span>
        <span class="Comment">--the second one means select 3+generate_series from generate_series(1,7)</span>
        <span class="Comment">--  select generate_series(1,7);</span>
        <span class="Comment">-- select 3 + generate_series(1,7);</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;simple selects from 2&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">c</span> <span class="String">&quot;select a,b from testfunc();&quot;</span>
        <span class="Symbol">[</span><span class="ConId">CatCreateComposite</span> <span class="String">&quot;testType&quot;</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
                                       <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
                                       <span class="Symbol">,(</span><span class="String">&quot;c&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)]</span>
        <span class="Symbol">,</span><span class="ConId">CatCreateFunction</span> <span class="ConId">FunName</span> <span class="String">&quot;testfunc&quot;</span> <span class="Symbol">[]</span>
         <span class="Symbol">(</span><span class="ConId">SetOfType</span> <span class="Symbol">$</span> <span class="ConId">NamedCompositeType</span> <span class="String">&quot;testType&quot;</span><span class="Symbol">)</span> <span class="ConId">False</span><span class="Symbol">]</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
                 <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">),(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">)])]</span>

     <span class="Symbol">,</span><span class="VarId">c</span> <span class="String">&quot;select testfunc();&quot;</span>
        <span class="Symbol">[</span><span class="ConId">CatCreateFunction</span> <span class="ConId">FunName</span> <span class="String">&quot;testfunc&quot;</span> <span class="Symbol">[]</span> <span class="Symbol">(</span><span class="ConId">Pseudo</span> <span class="ConId">Void</span><span class="Symbol">)</span> <span class="ConId">False</span><span class="Symbol">]</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[])]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Comment">{-currently broken, needs fixing</span>
<span class="Comment">    ,Group &quot;simple join selects&quot; [</span>
<span class="Comment">      s &quot;select * from (select 1 as a, 2 as b) a\n\</span>
<span class="Comment">        \  cross join (select true as c, 4.5 as d) b;&quot;</span>
<span class="Comment">        $ Right [Just $ ([], [(&quot;a&quot;, typeInt)</span>
<span class="Comment">                             ,(&quot;b&quot;, typeInt)</span>
<span class="Comment">                             ,(&quot;c&quot;, typeBool)</span>
<span class="Comment">                             ,(&quot;d&quot;, typeNumeric)])]</span>
<span class="Comment">     ,s &quot;select * from (select 1 as a, 2 as b) a\n\</span>
<span class="Comment">        \  inner join (select true as c, 4.5 as d) b on true;&quot;</span>
<span class="Comment">        $ Right [Just $ ([], [(&quot;a&quot;, typeInt)</span>
<span class="Comment">                             ,(&quot;b&quot;, typeInt)</span>
<span class="Comment">                             ,(&quot;c&quot;, typeBool)</span>
<span class="Comment">                             ,(&quot;d&quot;, typeNumeric)])]</span>
<span class="Comment">     ,s &quot;select * from (select 1 as a, 2 as b) a\n\</span>
<span class="Comment">        \  inner join (select 1 as a, 4.5 as d) b using(a);&quot;</span>
<span class="Comment">        $ Right [Just $ ([], [(&quot;a&quot;, typeInt)</span>
<span class="Comment">                             ,(&quot;b&quot;, typeInt)</span>
<span class="Comment">                             ,(&quot;d&quot;, typeNumeric)])]</span>
<span class="Comment">     ,s &quot;select * from (select 1 as a, 2 as b) a\n\</span>
<span class="Comment">        \ natural inner join (select 1 as a, 4.5 as d) b;&quot;</span>
<span class="Comment">        $ Right [Just $ ([], [(&quot;a&quot;, typeInt)</span>
<span class="Comment">                             ,(&quot;b&quot;, typeInt)</span>
<span class="Comment">                             ,(&quot;d&quot;, typeNumeric)])]</span>
<span class="Comment">        --check the attribute order</span>
<span class="Comment">     ,s &quot;select * from (select 2 as b, 1 as a) a\n\</span>
<span class="Comment">        \ natural inner join (select 4.5 as d, 1 as a) b;&quot;</span>
<span class="Comment">        $ Right [Just $ ([], [(&quot;a&quot;, typeInt)</span>
<span class="Comment">                             ,(&quot;b&quot;, typeInt)</span>
<span class="Comment">                             ,(&quot;d&quot;, typeNumeric)])]</span>
<span class="Comment">     ,s &quot;select * from (select 1 as a1, 2 as b) a\n\</span>
<span class="Comment">        \ natural inner join (select true as a1, 4.5 as d) b;&quot;</span>
<span class="Comment">        $ Left [UnrecognisedCorrelationName &quot;&quot;</span>
<span class="Comment">               ,IncompatibleTypeSet [ScalarType &quot;int4&quot;</span>
<span class="Comment">                                    ,ScalarType &quot;bool&quot;]]</span>
<span class="Comment">       ,s &quot;select * from (select 1 as a1, 2 as b) a\n\</span>
<span class="Comment">        \ natural inner join (select true as a1, 4.5 as d) b;&quot;</span>
<span class="Comment">        $ Left [UnrecognisedCorrelationName &quot;&quot;</span>
<span class="Comment">               ,IncompatibleTypeSet [ScalarType &quot;int4&quot;</span>
<span class="Comment">                                    ,ScalarType &quot;bool&quot;]]</span>
<span class="Comment">       ,s &quot;select * from (select 1 as a1) a, (select 2 as a2) b;&quot;</span>
<span class="Comment">        $ Right [Just $ ([], [(&quot;a1&quot;, typeInt)</span>
<span class="Comment">                                           ,(&quot;a2&quot;, typeInt)])]</span>

<span class="Comment">       ,s &quot;select * from (select 1 as a1) a, (select 2 as a1) b;&quot;</span>
<span class="Comment">        $ Right [Just $ ([], [(&quot;a1&quot;, typeInt)</span>
<span class="Comment">                                           ,(&quot;a1&quot;, typeInt)])]</span>

<span class="Comment">       ,s &quot;select a1 from (select 1 as a1) a,  (select 2 as a1) b;&quot;</span>
<span class="Comment">        $ Left [AmbiguousIdentifier &quot;a1&quot;]</span>
<span class="Comment">     ]-}</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;simple scalar identifier qualification&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;select a.* from \n\
        \(select 1 as a, 2 as b) a \n\
        \cross join (select 3 as c, 4 as d) b;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)</span>
                                          <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select nothere.* from \n\
        \(select 1 as a, 2 as b) a \n\
        \cross join (select 3 as c, 4 as d) b;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedCorrelationName</span> <span class="String">&quot;nothere&quot;</span><span class="Symbol">]</span>
     <span class="Comment">{- currently broken, needs fixing</span>
<span class="Comment">       ,s &quot;select a.b,b.c from \n\</span>
<span class="Comment">        \(select 1 as a, 2 as b) a \n\</span>
<span class="Comment">        \natural inner join (select 3 as a, 4 as c) b;&quot;</span>
<span class="Comment">        $ Right [Just $ ([], [(&quot;b&quot;, typeInt)</span>
<span class="Comment">                                          ,(&quot;c&quot;, typeInt)])-}</span>
     <span class="Comment">{- currently broken, needs fixing</span>
<span class="Comment">       ,s &quot;select a.a,b.a from \n\</span>
<span class="Comment">        \(select 1 as a, 2 as b) a \n\</span>
<span class="Comment">        \natural inner join (select 3 as a, 4 as c) b;&quot;</span>
<span class="Comment">        $ Right [Just $ ([], [(&quot;a&quot;, typeInt)</span>
<span class="Comment">                                          ,(&quot;a&quot;, typeInt)])]-}</span>

     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select pg_attrdef.adsrc from pg_attrdef;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;adsrc&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span>

     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select a.adsrc from pg_attrdef a;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;adsrc&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span>

     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select pg_attrdef.adsrc from pg_attrdef a;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedCorrelationName</span> <span class="String">&quot;pg_attrdef&quot;</span><span class="Symbol">]</span>

     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select a from (select 2 as b, 1 as a) a\n\
        \natural inner join (select 4.5 as d, 1 as a) b;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>

<span class="Comment">-- select g.fn from fn() g</span>

     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;aggregates&quot;</span> <span class="Symbol">[</span>
       <span class="VarId">s</span> <span class="String">&quot;select max(prorettype::int) from pg_proc;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;max&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;simple wheres&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;select 1 from pg_type where true;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;?column?&quot;</span><span class="Symbol">,</span> <span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select 1 from pg_type where 1;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">ExpressionMustBeBool</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select typname from pg_type where typbyval;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;typname&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;name&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select typname from pg_type where typtype = 'b';&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;typname&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;name&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select typname from pg_type where what = 'b';&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;what&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;unnest&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;select conname,unnest(conkey) as attnum from pg_constraint;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">(([],</span> <span class="Symbol">[(</span><span class="String">&quot;conname&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;name&quot;</span><span class="Symbol">)</span>
                                         <span class="Symbol">,(</span><span class="String">&quot;attnum&quot;</span><span class="Symbol">,</span><span class="VarId">typeSmallInt</span><span class="Symbol">)]))]</span>
     <span class="Symbol">]</span></pre></div></div></div><p
    >TODO: check identifier stacking working, then remove the pg_namespace qualifier before oid and this should still work</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;subqueries&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;select relname as relvar_name\n\
        \    from pg_class\n\
        \    where ((relnamespace =\n\
        \           (select oid\n\
        \              from pg_namespace\n\
        \              where (nspname = 'public'))) and (relkind = 'r'));&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;relvar_name&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;name&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select relname from pg_class where relkind in ('r', 'v');&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;relname&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;name&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select * from generate_series(1,7) g\n\
        \where g not in (select * from generate_series(3,5));&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;g&quot;</span><span class="Symbol">,</span><span class="VarId">typeInt</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select 3 = any(array[1,2,3]);&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;?column?&quot;</span><span class="Symbol">,</span><span class="VarId">typeBool</span><span class="Symbol">)])]</span>
     <span class="Symbol">]</span>

 <span class="Comment">-- identifiers in select parts</span>

<span class="Comment">{-    ,testGroup &quot;select part identifiers&quot;</span>
<span class="Comment">    (mapStatementTypes [</span>
<span class="Comment">      p &quot;select relname,attname from pg_class\n\</span>
<span class="Comment">        \inner join pg_attribute\n\</span>
<span class="Comment">        \on pg_attribute.attrelid = pg_class.oid;&quot;</span>
<span class="Comment">        $ Right [Just $ ([], [(&quot;relvar_name&quot;,ScalarType &quot;name&quot;)]]</span>
<span class="Comment">     ])-}</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;insert&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;insert into nope (a,b) values (c,d);&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedRelation</span> <span class="String">&quot;nope&quot;</span>
               <span class="Symbol">,</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;c&quot;</span>
               <span class="Symbol">,</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;d&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;insert into pg_attrdef (adrelid,adnum,adbin,adsrc)\n\
        \values (1,2, 'a', 'b');&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[]</span> <span class="Comment">{-InsertInfo &quot;pg_attrdef&quot;</span>
<span class="Comment">                          [(&quot;adrelid&quot;,ScalarType &quot;oid&quot;)</span>
<span class="Comment">                          ,(&quot;adnum&quot;,ScalarType &quot;int2&quot;)</span>
<span class="Comment">                          ,(&quot;adbin&quot;,ScalarType &quot;text&quot;)</span>
<span class="Comment">                          ,(&quot;adsrc&quot;,ScalarType &quot;text&quot;)]-}</span><span class="Symbol">)]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;insert into pg_attrdef\n\
        \values (1,2, 'a', 'c');&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[]</span> <span class="Comment">{-InsertInfo &quot;pg_attrdef&quot;</span>
<span class="Comment">                          [(&quot;adrelid&quot;,ScalarType &quot;oid&quot;)</span>
<span class="Comment">                          ,(&quot;adnum&quot;,ScalarType &quot;int2&quot;)</span>
<span class="Comment">                          ,(&quot;adbin&quot;,ScalarType &quot;text&quot;)</span>
<span class="Comment">                          ,(&quot;adsrc&quot;,ScalarType &quot;text&quot;)]-}</span><span class="Symbol">)]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;insert into pg_attrdef (hello,adnum,adbin,adsrc)\n\
        \values (1,2, 'a', 'b');&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;hello&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;insert into pg_attrdef (adrelid,adnum,adbin,adsrc)\n\
        \values (1,true, 'a', 'b');&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypes</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;int2&quot;</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span><span class="Symbol">)]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;insert into pg_attrdef (adrelid,adnum,adbin,adsrc)\n\
        \values (1,true, 'a', 'b','c');&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">WrongNumberOfColumns</span><span class="Symbol">]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;update&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;update nope set a = 1;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedRelation</span> <span class="String">&quot;nope&quot;</span>
               <span class="Symbol">,</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;a&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;update pg_attrdef set adsrc = '' where 1;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">ExpressionMustBeBool</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;update pg_attrdef set (adbin,adsrc) = ('a','b','c');&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;=&quot;</span>
                <span class="Symbol">[</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span>
                                     <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">]</span>
                <span class="Symbol">,</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="ConId">UnknownType</span>
                                     <span class="Symbol">,</span><span class="ConId">UnknownType</span>
                                     <span class="Symbol">,</span><span class="ConId">UnknownType</span><span class="Symbol">]]]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;update pg_attrdef set (adrelid,adsrc) = (true,'b');&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;=&quot;</span>
                <span class="Symbol">[</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;oid&quot;</span>
                                     <span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">]</span>
                <span class="Symbol">,</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span>
                                     <span class="Symbol">,</span><span class="ConId">UnknownType</span><span class="Symbol">]]]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;update pg_attrdef set (shmadrelid,adsrc) = ('a','b');&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;shmadrelid&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;update pg_attrdef set adsrc='';&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[]</span> <span class="Comment">{-UpdateInfo &quot;pg_attrdef&quot; [(&quot;adsrc&quot;,ScalarType &quot;text&quot;)]-}</span><span class="Symbol">)]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;update pg_attrdef set adsrc='' where 1=2;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[]</span> <span class="Comment">{-UpdateInfo &quot;pg_attrdef&quot; [(&quot;adsrc&quot;,ScalarType &quot;text&quot;)]-}</span><span class="Symbol">)]</span>
      <span class="Comment">-- </span><span class="Alert">TODO:</span><span class="Comment"> actually, pg doesn't support this so need to generate error instead</span>
     <span class="Comment">{-,s &quot;update pg_attrdef set (adbin,adsrc) = ((select 'a','b'));&quot;</span>
<span class="Comment">        $ Right [Just $ ([], [] {-UpdateInfo &quot;pg_attrdef&quot; [(&quot;adbin&quot;,ScalarType &quot;text&quot;),(&quot;adsrc&quot;,ScalarType &quot;text&quot;)]-})]-}</span>
     <span class="Comment">--check where ids</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;update pg_attrdef set adsrc='' where adsrc='';&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[]</span> <span class="Comment">{-UpdateInfo &quot;pg_attrdef&quot; [(&quot;adsrc&quot;,ScalarType &quot;text&quot;)]-}</span><span class="Symbol">)]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;update pg_attrdef set adnum = adnum + 1;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[]</span> <span class="Comment">{-UpdateInfo &quot;pg_attrdef&quot; [(&quot;adnum&quot;,ScalarType &quot;int2&quot;)]-}</span><span class="Symbol">)]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;delete&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;delete from nope;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedRelation</span> <span class="String">&quot;nope&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;delete from pg_attrdef where 1=2;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;delete from pg_attrdef where 1;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">ExpressionMustBeBool</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;delete from pg_attrdef where adsrc='';&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[])]</span>
     <span class="Symbol">]</span></pre></div></div></div><hr
     /><p
    >test the catalog updates from creates, etc.</p
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;creates&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">d</span> <span class="String">&quot;create table t1 (\n\
        \   a int,\n\
        \   b text\n\
        \);&quot;</span>
        <span class="Symbol">[</span><span class="ConId">CatCreateTable</span> <span class="String">&quot;t1&quot;</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">)</span>
                              <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]</span>
                              <span class="Symbol">[(</span><span class="String">&quot;tableoid&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;oid&quot;</span><span class="Symbol">)</span>
                              <span class="Symbol">,(</span><span class="String">&quot;cmax&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;cid&quot;</span><span class="Symbol">)</span>
                              <span class="Symbol">,(</span><span class="String">&quot;xmax&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;xid&quot;</span><span class="Symbol">)</span>
                              <span class="Symbol">,(</span><span class="String">&quot;cmin&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;cid&quot;</span><span class="Symbol">)</span>
                              <span class="Symbol">,(</span><span class="String">&quot;xmin&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;xid&quot;</span><span class="Symbol">)</span>
                              <span class="Symbol">,(</span><span class="String">&quot;ctid&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;tid&quot;</span><span class="Symbol">)]]</span>
     <span class="Symbol">,</span><span class="VarId">d</span> <span class="String">&quot;create type t1 as (\n\
        \   a int,\n\
        \   b text\n\
        \);&quot;</span>
        <span class="Symbol">[</span><span class="ConId">CatCreateComposite</span> <span class="String">&quot;t1&quot;</span> <span class="Symbol">[(</span><span class="String">&quot;a&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">)</span>
                                  <span class="Symbol">,(</span><span class="String">&quot;b&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]]</span>

     <span class="Symbol">,</span><span class="VarId">d</span> <span class="String">&quot;create domain t1 as text;&quot;</span>
        <span class="Symbol">[</span><span class="ConId">CatCreateDomain</span> <span class="Symbol">(</span><span class="ConId">DomainType</span> <span class="String">&quot;t1&quot;</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]</span>

     <span class="Symbol">,</span><span class="VarId">d</span> <span class="String">&quot;create domain t1 as text check (value in ('a', 'b'));\n\
        \select 'text'::t1;&quot;</span>
        <span class="Symbol">[</span><span class="ConId">CatCreateDomain</span> <span class="Symbol">(</span><span class="ConId">DomainType</span> <span class="String">&quot;t1&quot;</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]</span>


     <span class="Symbol">,</span><span class="VarId">d</span> <span class="String">&quot;create view v1 as select * from pg_attrdef;&quot;</span>
        <span class="Symbol">[</span><span class="ConId">CatCreateView</span> <span class="String">&quot;v1&quot;</span> <span class="Symbol">[(</span><span class="String">&quot;adrelid&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;oid&quot;</span><span class="Symbol">)</span>
                             <span class="Symbol">,(</span><span class="String">&quot;adnum&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int2&quot;</span><span class="Symbol">)</span>
                             <span class="Symbol">,(</span><span class="String">&quot;adbin&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
                             <span class="Symbol">,(</span><span class="String">&quot;adsrc&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]]</span>

     <span class="Symbol">,</span><span class="VarId">d</span> <span class="String">&quot;create function t1(text) returns text as $$\n\
        \null;\n\
        \$$ language sql stable;&quot;</span>
        <span class="Symbol">[</span><span class="ConId">CatCreateFunction</span> <span class="ConId">FunName</span> <span class="String">&quot;t1&quot;</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">]</span>
                            <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span> <span class="ConId">False</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">d</span> <span class="String">&quot;create language plpgsql;&quot;</span>
        <span class="Symbol">[</span><span class="ConId">CatCreateFunction</span> <span class="ConId">FunName</span> <span class="String">&quot;plpgsql_call_handler&quot;</span> <span class="Symbol">[]</span> <span class="Symbol">(</span><span class="ConId">Pseudo</span> <span class="ConId">LanguageHandler</span><span class="Symbol">)</span> <span class="ConId">False</span>
        <span class="Symbol">,</span><span class="ConId">CatCreateFunction</span> <span class="ConId">FunName</span> <span class="String">&quot;plpgsql_validator&quot;</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;oid&quot;</span><span class="Symbol">]</span> <span class="Symbol">(</span><span class="ConId">Pseudo</span> <span class="ConId">Void</span><span class="Symbol">)</span> <span class="ConId">False</span><span class="Symbol">]</span>
     <span class="Symbol">]</span>
</pre></div></div></div><hr
     /><pre
    ><code
      >check the identifier resolution for functions:
parameters
variable declarations
select expressions inside these:
refer to param
refer to variable
override var with var
override var with select iden
todo: override var with param, override select iden with param

check var defs:
check type exists
check type of initial values
</code
      ></pre
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;create function identifier resolution&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;create function t1(stuff text) returns text as $$\n\
        \begin\n\
        \  return stuff || ' and stuff';\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">])</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1(stuff text) returns text as $$\n\
        \begin\n\
        \  return badstuff || ' and stuff';\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;badstuff&quot;</span><span class="Symbol">])</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns text as $$\n\
        \declare\n\
        \  stuff text;\n\
        \begin\n\
        \  return stuff || ' and stuff';\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">])</span>
     <span class="Symbol">]</span></pre></div></div></div><hr
     /><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;plpgsqlbits&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;create function t1(stuff text) returns text as $$\n\
        \begin\n\
        \  return stuff || ' and stuff';\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">])</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1(stuff text) returns text as $$\n\
        \begin\n\
        \  return badstuff || ' and stuff';\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;badstuff&quot;</span><span class="Symbol">])</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns text as $$\n\
        \declare\n\
        \  stuff text;\n\
        \begin\n\
        \  return stuff || ' and stuff';\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">])</span>
     <span class="Symbol">]</span></pre></div></div></div><hr
     /><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;plpgsqlbits&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  a bool;\n\
        \begin\n\
        \  a := 3;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypes</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">)])</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  a boolean;\n\
        \begin\n\
        \  a := true;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">])</span>
     <span class="Symbol">]</span></pre></div></div></div><hr
     /><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;for loops&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  r record;\n\
        \  t int;\n\
        \begin\n\
        \  for r in select * from pg_attrdef loop\n\
        \    t := r.adnum;\n\
        \  end loop;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">])</span>


     <span class="Comment">{-,s &quot;create function t1() returns void as $$\n\</span>
<span class="Comment">        \declare\n\</span>
<span class="Comment">        \  r record;\n\</span>
<span class="Comment">        \  t int;\n\</span>
<span class="Comment">        \begin\n\</span>
<span class="Comment">        \  for r in select adnum from pg_attrdef loop\n\</span>
<span class="Comment">        \    t := r;\n\</span>
<span class="Comment">        \  end loop;\n\</span>
<span class="Comment">        \end;\n\</span>
<span class="Comment">        \$$ language plpgsql stable;&quot;</span>
<span class="Comment">        (Right [Nothing])-}</span>

      <span class="Comment">-- loop var already declared</span>

     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function test() returns void as $$\n\
        \declare\n\
        \  i int;\n\
        \  i1 int;\n\
        \begin\n\
        \  for i in 0 .. 10 loop\n\
        \    i1 := i;\n\
        \  end loop;\n\
        \end;\n\
        \$$ language plpgsql volatile;&quot;</span>
       <span class="Symbol">(</span><span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">])</span>

       <span class="Comment">--implicitly created loop var</span>

     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function test() returns void as $$\n\
        \declare\n\
        \  i1 int;\n\
        \begin\n\
        \  for i in 0 .. 10 loop\n\
        \    i1 := i;\n\
        \  end loop;\n\
        \end;\n\
        \$$ language plpgsql volatile;&quot;</span>
       <span class="Symbol">(</span><span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">])</span>

       <span class="Comment">--loop var already declared, wrong type</span>

     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function test() returns void as $$\n\
        \declare\n\
        \  i bool;\n\
        \begin\n\
        \  for i in 0 .. 10 loop\n\
        \    null;\n\
        \  end loop;\n\
        \end;\n\
        \$$ language plpgsql volatile;&quot;</span>
       <span class="Symbol">(</span><span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypes</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">)])</span>

      <span class="Comment">--loop var implicit check it's type</span>

     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function test() returns void as $$\n\
        \declare\n\
        \  t bool;\n\
        \begin\n\
        \  for i in 0 .. 10 loop\n\
        \    t := i;\n\
        \  end loop;\n\
        \end;\n\
        \       $$ language plpgsql volatile;&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypes</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;bool&quot;</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">)])</span>
     <span class="Symbol">]</span></pre></div></div></div><hr
     /><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;check catalog chaining&quot;</span> <span class="Symbol">[</span>

    <span class="Comment">-- create function then select</span>
    <span class="Comment">-- select then create function</span>
    <span class="Comment">-- then in two separate chained asts</span>

      <span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \begin\n\
        \  null;\n\
        \end;\n\
        \$$ language plpgsql stable;\n\
        \select t1();&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">,</span><span class="ConId">Just</span> <span class="Symbol">(([],</span> <span class="Symbol">[]))])</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;select t1();\n\
        \create function t1() returns void as $$\n\
        \begin\n\
        \  null;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">(</span><span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">NoMatchingOperator</span> <span class="String">&quot;t1&quot;</span> <span class="Symbol">[]])</span>
     <span class="Symbol">]</span>

  <span class="Comment">{-,Group &quot;check catalog chaining2&quot; [ StatementTypes [</span>
<span class="Comment">      p [&quot;create function t1() returns void as $$\n\</span>
<span class="Comment">         \begin\n\</span>
<span class="Comment">         \  null;\n\</span>
<span class="Comment">         \end;\n\</span>
<span class="Comment">         \$$ language plpgsql stable;&quot;</span>
<span class="Comment">        ,&quot;select t1();&quot;]</span>
<span class="Comment">        (Right [Just (SelectInfo (Pseudo Void))])</span>
<span class="Comment">     ,p [&quot;select t1();&quot;</span>
<span class="Comment">        ,&quot;create function t1() returns void as $$\n\</span>
<span class="Comment">         \begin\n\</span>
<span class="Comment">         \  null;\n\</span>
<span class="Comment">         \end;\n\</span>
<span class="Comment">         \$$ language plpgsql stable;&quot;]</span>
<span class="Comment">        (Left [NoMatchingOperator &quot;t1&quot; []])</span>
<span class="Comment">     ]]-}</span></pre></div></div></div><hr
     /><pre
    ><code
      >test some casts
assign composite to record
  then assign record to composite
assign row to composite
 : check wrong cols, wrong types
check read and write fields in composite-&gt;record
check read and write fields in composite
check domain &lt;-&gt; base assigns
check call function with compatible composite, compatible row ctor
assign comp to comp

todo for chaos sql
for loop var = scalar, select = setof composite with one scalar

select into
composite assignment and equality
autocast from rowctor to composite when calling function
assignment to composite fields
read fields of composite

array_contains -&gt; match anyelement
createtable as cat update
window functions
assign domain &lt;-&gt; base
sql function not working
</code
      ></pre
    ><hr
     /><pre
    ><code
      >check insert returning, update returning, delete returning, one check each
check select into: multiple vars, record (then access fields to check),
  composite var
check errors: select into wrong number of vars, wrong types, and into
  composite wrong number and wrong type
</code
      ></pre
    ><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;select into&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;insert into pg_attrdef (adrelid,adnum,adbin,adsrc)\n\
        \values (1,2, 'a', 'b') returning adnum,adbin;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;adnum&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int2&quot;</span><span class="Symbol">)</span>
                                         <span class="Symbol">,(</span><span class="String">&quot;adbin&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;update pg_attrdef set adnum = adnum + 1 returning adnum;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;adnum&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int2&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;delete from pg_attrdef returning adnum,adbin;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span> <span class="Symbol">[(</span><span class="String">&quot;adnum&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;int2&quot;</span><span class="Symbol">)</span>
                                         <span class="Symbol">,(</span><span class="String">&quot;adbin&quot;</span><span class="Symbol">,</span> <span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  a int;\n\
        \  b text;\n\
        \begin\n\
        \  select adnum,adbin into a,b from pg_attrdef;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  a int;\n\
        \  b text;\n\
        \begin\n\
        \  select adnum,adbin into b,a from pg_attrdef;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypes</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;int2&quot;</span><span class="Symbol">)</span>
               <span class="Symbol">,</span><span class="ConId">IncompatibleTypes</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;int4&quot;</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  a int;\n\
        \  b text;\n\
        \begin\n\
        \  select adnum,adbin into a,c from pg_attrdef;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;c&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  a int;\n\
        \  b text;\n\
        \begin\n\
        \  select adnum,adbin into a from pg_attrdef;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">WrongNumberOfColumns</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  r record;\n\
        \  a int;\n\
        \  b text;\n\
        \begin\n\
        \  select adnum,adbin into r from pg_attrdef;\n\
        \  a := r.adnum;\n\
        \  b := r.adbin;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  r record;\n\
        \  a int;\n\
        \  b text;\n\
        \begin\n\
        \  select adnum,adbin into r from pg_attrdef;\n\
        \  a := r.adnum;\n\
        \  b := r.adsrc;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;adsrc&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  r pg_attrdef;\n\
        \begin\n\
        \  select * into r from pg_attrdef;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  r pg_class;\n\
        \begin\n\
        \  select adnum,adbin into r from pg_attrdef;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">IncompatibleTypes</span> <span class="Symbol">(</span><span class="ConId">NamedCompositeType</span> <span class="String">&quot;pg_class&quot;</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="ConId">AnonymousRecordType</span> <span class="Symbol">[</span><span class="ConId">ScalarType</span> <span class="String">&quot;int2&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">])]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  r record;\n\
        \begin\n\
        \  select adnum,adbin into r from pg_attrdef;\n\
        \  select relname into r from pg_class;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;composite elements&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;create function t1() returns void as $$\n\
        \declare\n\
        \  r pg_attrdef;\n\
        \  a int;\n\
        \  b text;\n\
        \begin\n\
        \  b = r.adsrc;\n\
        \  r.adnum := a;\n\
        \  b = r.adsrc;\n\
        \end;\n\
        \$$ language plpgsql stable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;positional args&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;create function distance(int, int, int, int) returns float(24) as $$\n\
        \  select (point($1, $2) &lt;-&gt; point($3, $4))::float(24) as result;\n\
        \$$ language sql immutable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Nothing</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">s</span> <span class="String">&quot;create function distance(int, int, int, int) returns float(24) as $$\n\
        \  select (point($1, $2) &lt;-&gt; point($3, $5))::float(24) as result;\n\
        \$$ language sql immutable;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="Symbol">[</span><span class="ConId">UnrecognisedIdentifier</span> <span class="String">&quot;$5&quot;</span><span class="Symbol">]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;window fns&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">s</span> <span class="String">&quot;select *, row_number() over () from pg_attrdef;&quot;</span>
        <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="Symbol">[</span><span class="ConId">Just</span> <span class="Symbol">$</span> <span class="Symbol">([],</span>
                  <span class="Symbol">[(</span><span class="String">&quot;adrelid&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;oid&quot;</span><span class="Symbol">)</span>
                  <span class="Symbol">,(</span><span class="String">&quot;adnum&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int2&quot;</span><span class="Symbol">)</span>
                  <span class="Symbol">,(</span><span class="String">&quot;adbin&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
                  <span class="Symbol">,(</span><span class="String">&quot;adsrc&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;text&quot;</span><span class="Symbol">)</span>
                  <span class="Symbol">,(</span><span class="String">&quot;row_number&quot;</span><span class="Symbol">,</span><span class="ConId">ScalarType</span> <span class="String">&quot;int8&quot;</span><span class="Symbol">)])]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;drop stuff&quot;</span> <span class="Symbol">[</span>
      <span class="VarId">d</span> <span class="String">&quot;create function test(a int) returns void as $$\n\
        \begin\n\
        \  null;\n\
        \end\n\
        \$$ language plpgsql;&quot;</span>
        <span class="Symbol">[</span><span class="ConId">CatCreateFunction</span> <span class="ConId">FunName</span> <span class="String">&quot;test&quot;</span> <span class="Symbol">[</span><span class="VarId">typeInt</span><span class="Symbol">]</span> <span class="Symbol">(</span><span class="ConId">Pseudo</span> <span class="ConId">Void</span><span class="Symbol">)</span> <span class="ConId">False</span><span class="Symbol">]</span>
     <span class="Symbol">,</span><span class="VarId">d</span> <span class="String">&quot;create function test(a int) returns void as $$\n\
        \begin\n\
        \  null;\n\
        \end\n\
        \$$ language plpgsql;\n\
        \drop function test(int);&quot;</span>
        <span class="Symbol">[]</span>
     <span class="Symbol">,</span><span class="VarId">d</span> <span class="String">&quot;drop function test(int);&quot;</span> <span class="Comment">-- this should fail but doesn't</span>
        <span class="Symbol">[]</span>
     <span class="Symbol">,</span><span class="VarId">d</span> <span class="String">&quot;drop function if exists test(int);&quot;</span>
        <span class="Symbol">[]</span>
     <span class="Symbol">]</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode">  <span class="Symbol">,</span><span class="ConId">Group</span> <span class="String">&quot;triggers&quot;</span> <span class="Symbol">[</span>
      <span class="Comment">{-d [$here|</span>
<span class="Comment">         create table t1 (</span>
<span class="Comment">           a int,</span>
<span class="Comment">           b int,</span>
<span class="Comment">           c text</span>
<span class="Comment">         );</span>
<span class="Comment">         create table t2 (</span>
<span class="Comment">           a int,</span>
<span class="Comment">           b int,</span>
<span class="Comment">           c int</span>
<span class="Comment">         );</span>
<span class="Comment">         create function trig_fn() returns trigger as $a$</span>
<span class="Comment">         begin</span>
<span class="Comment">           if (NEW.a &gt; 100) or (OLD.b &lt; 5) then</span>
<span class="Comment">               raise exception 'no good';</span>
<span class="Comment">           end if;</span>
<span class="Comment">           return NEW;</span>
<span class="Comment">         end;</span>
<span class="Comment">         $a$ language plpgsql volatile;</span>
<span class="Comment">         create trigger trig</span>
<span class="Comment">           after update on t1</span>
<span class="Comment">           for each row</span>
<span class="Comment">           execute procedure check_relvar_update();</span>
<span class="Comment">         create trigger trig</span>
<span class="Comment">           after update on t2</span>
<span class="Comment">           for each row</span>
<span class="Comment">           execute procedure check_relvar_update();</span>
<span class="Comment">         |]</span>
<span class="Comment">      [CatCreateTable &quot;t1&quot; [(&quot;a&quot;,ScalarType &quot;int4&quot;)</span>
<span class="Comment">                           ,(&quot;b&quot;,ScalarType &quot;int4&quot;)</span>
<span class="Comment">                           ,(&quot;c&quot;,ScalarType &quot;text&quot;)]</span>
<span class="Comment">                           [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;)</span>
<span class="Comment">                           ,(&quot;cmax&quot;,ScalarType &quot;cid&quot;)</span>
<span class="Comment">                           ,(&quot;xmax&quot;,ScalarType &quot;xid&quot;)</span>
<span class="Comment">                           ,(&quot;cmin&quot;,ScalarType &quot;cid&quot;)</span>
<span class="Comment">                           ,(&quot;xmin&quot;,ScalarType &quot;xid&quot;)</span>
<span class="Comment">                           ,(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]</span>
<span class="Comment">      ,CatCreateTable &quot;t2&quot; [(&quot;a&quot;,ScalarType &quot;int4&quot;)</span>
<span class="Comment">                           ,(&quot;b&quot;,ScalarType &quot;int4&quot;)</span>
<span class="Comment">                           ,(&quot;c&quot;,ScalarType &quot;int4&quot;)]</span>
<span class="Comment">                           [(&quot;tableoid&quot;,ScalarType &quot;oid&quot;)</span>
<span class="Comment">                           ,(&quot;cmax&quot;,ScalarType &quot;cid&quot;)</span>
<span class="Comment">                           ,(&quot;xmax&quot;,ScalarType &quot;xid&quot;)</span>
<span class="Comment">                           ,(&quot;cmin&quot;,ScalarType &quot;cid&quot;)</span>
<span class="Comment">                           ,(&quot;xmin&quot;,ScalarType &quot;xid&quot;)</span>
<span class="Comment">                           ,(&quot;ctid&quot;,ScalarType &quot;tid&quot;)]</span>
<span class="Comment">      ,CatCreateFunction FunName &quot;trig_fn&quot; [] (Pseudo Trigger) False]-}</span>
     <span class="Comment">{-,s [$here|</span>
<span class="Comment">         create table t1 (</span>
<span class="Comment">           a int,</span>
<span class="Comment">           b int,</span>
<span class="Comment">           c text</span>
<span class="Comment">         );</span>
<span class="Comment">         create function trig_fn() returns trigger as $a$</span>
<span class="Comment">         begin</span>
<span class="Comment">           if NEW.d = 'bad value' then</span>
<span class="Comment">             return NEW;</span>
<span class="Comment">               raise exception 'no good';</span>
<span class="Comment">           end if;</span>
<span class="Comment">         end;</span>
<span class="Comment">         $a$ language plpgsql volatile;</span>
<span class="Comment">         create trigger trig</span>
<span class="Comment">           after update on t1</span>
<span class="Comment">           for each row</span>
<span class="Comment">           execute procedure check_relvar_update();</span>
<span class="Comment">         |]</span>
<span class="Comment">        $ Left []-}</span>
     <span class="Symbol">]</span>
  <span class="Symbol">]</span>
 <span class="Keyword">where</span>
   <span class="VarId">e</span> <span class="Symbol">=</span> <span class="ConId">Expr</span>
   <span class="VarId">s</span> <span class="Symbol">=</span> <span class="ConId">StmtType</span>
   <span class="VarId">c</span> <span class="Symbol">=</span> <span class="ConId">CatStmtType</span>
   <span class="VarId">d</span> <span class="Symbol">=</span> <span class="ConId">Ddl</span></pre></div></div></div><hr
     /><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">testExpressionType</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Either</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span> <span class="ConId">Type</span> <span class="Symbol">-&gt;</span> <span class="ConId">Test.Framework.Test</span>
<span class="Function">testExpressionType</span> <span class="VarId">src</span> <span class="VarId">et</span> <span class="Symbol">=</span> <span class="VarId">testCase</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="Symbol">$</span>
  <span class="Keyword">let</span> <span class="VarId">ast</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="VarId">parseScalarExpr</span> <span class="String">&quot;&quot;</span> <span class="VarId">src</span> <span class="Keyword">of</span>
                                     <span class="ConId">Left</span> <span class="VarId">e</span> <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="VarId">show</span> <span class="VarId">e</span>
                                     <span class="ConId">Right</span> <span class="VarId">l</span> <span class="Symbol">-&gt;</span> <span class="VarId">l</span>
      <span class="VarId">aast</span> <span class="Symbol">=</span> <span class="VarId">typeCheckScalarExpr</span> <span class="VarId">defaultTemplate1Catalog</span> <span class="VarId">ast</span>
      <span class="VarId">ty</span> <span class="Symbol">=</span> <span class="VarId">atype</span> <span class="Symbol">$</span> <span class="VarId">getAnnotation</span> <span class="VarId">aast</span>
      <span class="VarId">er</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span>
      <span class="VarId">er</span> <span class="Symbol">=</span> <span class="Symbol">[</span><span class="VarId">x</span> <span class="Symbol">|</span> <span class="VarId">x</span> <span class="Symbol">&lt;-</span> <span class="VarId">universeBi</span> <span class="VarId">aast</span><span class="Symbol">]</span>
  <span class="Keyword">in</span> <span class="Keyword">if</span> <span class="VarId">null</span> <span class="VarId">er</span>
     <span class="Keyword">then</span> <span class="VarId">assertEqual</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="ConId">Just</span> <span class="VarId">et</span><span class="Symbol">)</span> <span class="Symbol">$</span> <span class="VarId">fmap</span> <span class="ConId">Right</span> <span class="VarId">ty</span>
     <span class="Keyword">else</span> <span class="VarId">assertEqual</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="VarId">et</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="VarId">er</span>

<span class="Function">testStatementType</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="ConId">Either</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span> <span class="Symbol">[</span><span class="ConId">Maybe</span> <span class="ConId">StatementType</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">Test.Framework.Test</span>
<span class="Function">testStatementType</span> <span class="VarId">src</span> <span class="VarId">sis</span> <span class="Symbol">=</span> <span class="VarId">testCase</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="Symbol">$</span>
  <span class="Keyword">let</span> <span class="VarId">ast</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="VarId">parseStatements</span> <span class="String">&quot;&quot;</span> <span class="VarId">src</span> <span class="Keyword">of</span>
                              <span class="ConId">Left</span> <span class="VarId">e</span> <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="VarId">show</span> <span class="VarId">e</span>
                              <span class="ConId">Right</span> <span class="VarId">l</span> <span class="Symbol">-&gt;</span> <span class="VarId">l</span>
      <span class="VarId">aast</span> <span class="Symbol">=</span> <span class="VarId">snd</span> <span class="Symbol">$</span> <span class="VarId">typeCheckStatements</span> <span class="VarId">defaultTemplate1Catalog</span> <span class="VarId">ast</span>
      <span class="VarId">is</span> <span class="Symbol">=</span> <span class="VarId">map</span> <span class="Symbol">(</span><span class="VarId">stType</span> <span class="Symbol">.</span> <span class="VarId">getAnnotation</span><span class="Symbol">)</span> <span class="VarId">aast</span>
      <span class="VarId">er</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span>
      <span class="VarId">er</span> <span class="Symbol">=</span> <span class="Symbol">[</span><span class="VarId">x</span> <span class="Symbol">|</span> <span class="VarId">x</span> <span class="Symbol">&lt;-</span> <span class="VarId">universeBi</span> <span class="VarId">aast</span><span class="Symbol">]</span>
  <span class="Keyword">in</span> <span class="Keyword">case</span> <span class="Symbol">(</span><span class="VarId">length</span> <span class="VarId">er</span><span class="Symbol">,</span> <span class="VarId">length</span> <span class="VarId">is</span><span class="Symbol">)</span> <span class="Keyword">of</span>
       <span class="Symbol">(</span><span class="Number">0</span><span class="Symbol">,</span><span class="Number">0</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span> <span class="VarId">assertFailure</span> <span class="String">&quot;didn't get any infos?&quot;</span>
       <span class="Symbol">(</span><span class="Number">0</span><span class="Symbol">,</span><span class="VarId">_</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span> <span class="VarId">assertTrace</span> <span class="Symbol">(</span><span class="VarId">ppExpr</span> <span class="VarId">aast</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="VarId">sis</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">is</span>
       <span class="VarId">_</span> <span class="Symbol">-&gt;</span> <span class="VarId">assertTrace</span> <span class="Symbol">(</span><span class="VarId">ppExpr</span> <span class="VarId">aast</span><span class="Symbol">)</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="VarId">sis</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="VarId">er</span></pre></div></div></div><div class='sourceCode'><div class='literate'><div class='haskell'><pre class="sourceCode"><span class="Function">testCatUpStatementType</span> <span class="Symbol">::</span> <span class="ConId">String</span>
                       <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="ConId">CatalogUpdate</span><span class="Symbol">]</span>
                       <span class="Symbol">-&gt;</span> <span class="ConId">Either</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span> <span class="Symbol">[</span><span class="ConId">Maybe</span> <span class="ConId">StatementType</span><span class="Symbol">]</span>
                       <span class="Symbol">-&gt;</span> <span class="ConId">Test.Framework.Test</span>
<span class="Function">testCatUpStatementType</span> <span class="VarId">src</span> <span class="VarId">eu</span> <span class="VarId">sis</span> <span class="Symbol">=</span> <span class="VarId">testCase</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="Symbol">$</span>
  <span class="Keyword">let</span> <span class="VarId">ast</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="VarId">parseStatements</span> <span class="String">&quot;&quot;</span> <span class="VarId">src</span> <span class="Keyword">of</span>
                              <span class="ConId">Left</span> <span class="VarId">e</span> <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="VarId">show</span> <span class="VarId">e</span>
                              <span class="ConId">Right</span> <span class="VarId">l</span> <span class="Symbol">-&gt;</span> <span class="VarId">l</span>
      <span class="VarId">aast</span> <span class="Symbol">=</span> <span class="VarId">snd</span> <span class="Symbol">$</span> <span class="VarId">typeCheckStatements</span> <span class="VarId">makeCat</span> <span class="VarId">ast</span>
      <span class="VarId">is</span> <span class="Symbol">=</span> <span class="VarId">map</span> <span class="Symbol">(</span><span class="VarId">stType</span> <span class="Symbol">.</span> <span class="VarId">getAnnotation</span><span class="Symbol">)</span> <span class="VarId">aast</span>
      <span class="VarId">er</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span>
      <span class="VarId">er</span> <span class="Symbol">=</span> <span class="Symbol">[</span><span class="VarId">x</span> <span class="Symbol">|</span> <span class="VarId">x</span> <span class="Symbol">&lt;-</span> <span class="VarId">universeBi</span> <span class="VarId">aast</span><span class="Symbol">]</span>
  <span class="Keyword">in</span> <span class="Comment">{-trace (show aast) $-}</span> <span class="Keyword">case</span> <span class="Symbol">(</span><span class="VarId">length</span> <span class="VarId">er</span><span class="Symbol">,</span> <span class="VarId">length</span> <span class="VarId">is</span><span class="Symbol">)</span> <span class="Keyword">of</span>
       <span class="Symbol">(</span><span class="Number">0</span><span class="Symbol">,</span><span class="Number">0</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span> <span class="VarId">assertFailure</span> <span class="String">&quot;didn't get any infos?&quot;</span>
       <span class="Symbol">(</span><span class="Number">0</span><span class="Symbol">,</span><span class="VarId">_</span><span class="Symbol">)</span> <span class="Symbol">-&gt;</span> <span class="VarId">assertEqual</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="VarId">sis</span> <span class="Symbol">$</span> <span class="ConId">Right</span> <span class="VarId">is</span>
       <span class="VarId">_</span> <span class="Symbol">-&gt;</span> <span class="VarId">assertEqual</span> <span class="Symbol">(</span><span class="String">&quot;typecheck &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="VarId">sis</span> <span class="Symbol">$</span> <span class="ConId">Left</span> <span class="VarId">er</span>
  <span class="Keyword">where</span>
    <span class="VarId">makeCat</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="VarId">updateCatalog</span> <span class="VarId">defaultTemplate1Catalog</span> <span class="VarId">eu</span> <span class="Keyword">of</span>
                        <span class="ConId">Left</span> <span class="VarId">x</span> <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="VarId">show</span> <span class="VarId">x</span>
                        <span class="ConId">Right</span> <span class="VarId">e</span> <span class="Symbol">-&gt;</span> <span class="VarId">e</span>

<span class="Function">testCat</span> <span class="Symbol">::</span> <span class="ConId">String</span> <span class="Symbol">-&gt;</span> <span class="Symbol">[</span><span class="ConId">CatalogUpdate</span><span class="Symbol">]</span> <span class="Symbol">-&gt;</span> <span class="ConId">Test.Framework.Test</span>
<span class="Function">testCat</span> <span class="VarId">src</span> <span class="VarId">eu</span> <span class="Symbol">=</span> <span class="VarId">testCase</span> <span class="Symbol">(</span><span class="String">&quot;check catalog: &quot;</span> <span class="Symbol">++</span> <span class="VarId">src</span><span class="Symbol">)</span> <span class="Symbol">$</span>
  <span class="Keyword">let</span> <span class="VarId">ast</span> <span class="Symbol">=</span> <span class="Keyword">case</span> <span class="VarId">parseStatements</span> <span class="String">&quot;&quot;</span> <span class="VarId">src</span> <span class="Keyword">of</span>
                              <span class="ConId">Left</span> <span class="VarId">e</span> <span class="Symbol">-&gt;</span> <span class="VarId">error</span> <span class="Symbol">$</span> <span class="VarId">show</span> <span class="VarId">e</span>
                              <span class="ConId">Right</span> <span class="VarId">l</span> <span class="Symbol">-&gt;</span> <span class="VarId">l</span>
      <span class="Symbol">(</span><span class="VarId">ncat</span><span class="Symbol">,</span><span class="VarId">aast</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">typeCheckStatements</span> <span class="VarId">defaultTemplate1Catalog</span> <span class="VarId">ast</span>
      <span class="VarId">er</span> <span class="Symbol">::</span> <span class="Symbol">[</span><span class="ConId">TypeError</span><span class="Symbol">]</span>
      <span class="VarId">er</span> <span class="Symbol">=</span> <span class="Symbol">[</span><span class="VarId">x</span> <span class="Symbol">|</span> <span class="VarId">x</span> <span class="Symbol">&lt;-</span> <span class="VarId">universeBi</span> <span class="VarId">aast</span><span class="Symbol">]</span>
      <span class="VarId">neu</span> <span class="Symbol">=</span> <span class="VarId">deconstructCatalog</span> <span class="VarId">ncat</span> <span class="Symbol">\\</span> <span class="VarId">deconstructCatalog</span> <span class="VarId">defaultTemplate1Catalog</span>
  <span class="Keyword">in</span> <span class="Keyword">if</span> <span class="VarId">not</span> <span class="Symbol">(</span><span class="VarId">null</span> <span class="VarId">er</span><span class="Symbol">)</span>
       <span class="Keyword">then</span> <span class="VarId">assertFailure</span> <span class="Symbol">$</span> <span class="VarId">show</span> <span class="VarId">er</span>
       <span class="Keyword">else</span> <span class="VarId">assertEqual</span> <span class="String">&quot;check eus&quot;</span> <span class="VarId">eu</span> <span class="VarId">neu</span>

<span class="Function">itemToTft</span> <span class="Symbol">::</span> <span class="ConId">Item</span> <span class="Symbol">-&gt;</span> <span class="ConId">Test.Framework.Test</span>
<span class="Function">itemToTft</span> <span class="Symbol">(</span><span class="ConId">Expr</span> <span class="VarId">s</span> <span class="VarId">r</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">testExpressionType</span> <span class="VarId">s</span> <span class="VarId">r</span>
<span class="Function">itemToTft</span> <span class="Symbol">(</span><span class="ConId">StmtType</span> <span class="VarId">s</span> <span class="VarId">r</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">testStatementType</span> <span class="VarId">s</span> <span class="VarId">r</span>
<span class="Function">itemToTft</span> <span class="Symbol">(</span><span class="ConId">CatStmtType</span> <span class="VarId">s</span> <span class="VarId">c</span> <span class="VarId">r</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">testCatUpStatementType</span> <span class="VarId">s</span> <span class="VarId">c</span> <span class="VarId">r</span>
<span class="Function">itemToTft</span> <span class="Symbol">(</span><span class="ConId">Ddl</span> <span class="VarId">s</span> <span class="VarId">c</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">testCat</span> <span class="VarId">s</span> <span class="VarId">c</span>
<span class="Function">itemToTft</span> <span class="Symbol">(</span><span class="ConId">Group</span> <span class="VarId">s</span> <span class="VarId">is</span><span class="Symbol">)</span> <span class="Symbol">=</span> <span class="VarId">testGroup</span> <span class="VarId">s</span> <span class="Symbol">$</span> <span class="VarId">map</span> <span class="VarId">itemToTft</span> <span class="VarId">is</span></pre></div></div></div><br
     /><br
     /><br
     /><div class="footer"
    >generated on 01/31/11 20:00:52, hssqlppp-0.3.0</div
    ></body
  ></html
>
